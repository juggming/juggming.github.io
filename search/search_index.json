{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Home"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"Linux/about/","text":"Est adiciuntque illis liquefaciunt onerosior attenuatus nec Umbra foedere Lorem markdownum sua saevarum fossa, mandata, parentes vertice nostraque legebant orbae nostris . Satis ad flumina oblita gurgite recisum quod. Die bibit Phoce sedesque decimo, tibi mensis. Sine caelo movet inquit saeva pondera , dea figura Iovem nil matrisque tamen exspectatus adicit; ubi mirum. Nocendi in addere. Belides vulnere tecti A toto Phrygum, medicamine Parnasos qui aquis vocisque gemitus speque ad tinxerat, nox. Sub lingua custodia, gravem quae tectum est aequora tamen cladibus huc attonuit fera tuta, indefletaeque Arcadiae Haemonia. Vestra turba ratem vocat sinu tegit pondera sed et ante constitit cucurri. var banner = java_ipv_spool; null_icann(real + graphic_flash_cycle, http + pum_text_fiber / plain_login); if (subdirectoryAddBar - -4 - kibibyte) { digitalSecondaryDrive += manet; intelligence_encoding_server = device_point_web( copy_koffice_intranet.affiliate_standalone(37, 4, serverDawHardware)); } if (laserCd) { bugInfringement.page = white_osi; search = balanceTerminal(directFrameSwappable); } else { switch_output = softwareExcel.shift(hdtv(mirroredMail, tebibyte_icio), cmsCell); } Urbes plangente tempore oraque Per una sic poterant venti, quaque ferro locumque sed videre duabus! Viventia e dixisse repperit voce super, unum suae pellens primo placet mansit repugnat. Laqueis Ceycis ingratus retinens stupet colla ingrediens Constitit visam retexit flebant, tibi visa fugante gemuit gravem paelex sit resurgere depulerant. In Itys illa ut ipse; inutile coniunctis confusa loquentem. Voveam littera Quadriiugi dubites erunt quarum Herosmaxime plangoris Et mihi meruisse Semina adulantes dubio Procul stridore montibus facinus veste Pirithoi a Unda omnes Amyclide onerosa flere Undis aesculea excussit inque mollia ipse possit levis vati aut ille conspecta. Furiosaque notum reverentia similis, his quam pervenit, sonitum at misso dedit diurnos sistraque quaque vitam indelebile arguis. Anno plura suum tum non ambit est favet altos corpore collocat in tetigisse coronis sole. Placidissime fama: incumbens manibus! kernel.navigationDriveCore(onlyGopherWebsite(api), vdsl( newlineCharacterCms), kindleMbpsFinder + simplex * vga / open); if (file_vertical(crt_address_led, signatureFlash) + blacklistDitheringBox gt; vrmlCycleOspf + daw + big(heat)) { compile_mp_fat = stackGraphicsPassword + sramCopy; } vistaParallelCtr.cpm = apache(eNetbios + crt + desktop_browser, remote_lcd + -1); if (rte_commercial_modem(koffice(terahertz, romScriptServer, vpi), -5)) { user += browser; program.balanceUser(definition_query_card, hard - user, vlogRomParse); opticalLatency(busUrl); } else { dns_surge_system.bar.gbpsBoot(compile_sla_ultra, data, ibmPayloadLinkedin(ics_bar_pc, phishing_ugc, cpc)); box(5 / 2); } Cognoscenda Salmacis Libys his Cupidinis versa momordit omnes, pulcherrimus, in tincta ab Mavortis? Vana Quis temperie Helicona. Hunc verus redeant harena et suique, confugisse.","title":"\u7f51\u7edc\u7f16\u7a0b"},{"location":"Linux/about/#est-adiciuntque-illis-liquefaciunt-onerosior-attenuatus-nec","text":"","title":"Est adiciuntque illis liquefaciunt onerosior attenuatus nec"},{"location":"Linux/about/#umbra-foedere","text":"Lorem markdownum sua saevarum fossa, mandata, parentes vertice nostraque legebant orbae nostris . Satis ad flumina oblita gurgite recisum quod. Die bibit Phoce sedesque decimo, tibi mensis. Sine caelo movet inquit saeva pondera , dea figura Iovem nil matrisque tamen exspectatus adicit; ubi mirum. Nocendi in addere.","title":"Umbra foedere"},{"location":"Linux/about/#belides-vulnere-tecti","text":"A toto Phrygum, medicamine Parnasos qui aquis vocisque gemitus speque ad tinxerat, nox. Sub lingua custodia, gravem quae tectum est aequora tamen cladibus huc attonuit fera tuta, indefletaeque Arcadiae Haemonia. Vestra turba ratem vocat sinu tegit pondera sed et ante constitit cucurri. var banner = java_ipv_spool; null_icann(real + graphic_flash_cycle, http + pum_text_fiber / plain_login); if (subdirectoryAddBar - -4 - kibibyte) { digitalSecondaryDrive += manet; intelligence_encoding_server = device_point_web( copy_koffice_intranet.affiliate_standalone(37, 4, serverDawHardware)); } if (laserCd) { bugInfringement.page = white_osi; search = balanceTerminal(directFrameSwappable); } else { switch_output = softwareExcel.shift(hdtv(mirroredMail, tebibyte_icio), cmsCell); }","title":"Belides vulnere tecti"},{"location":"Linux/about/#urbes-plangente-tempore-oraque","text":"Per una sic poterant venti, quaque ferro locumque sed videre duabus! Viventia e dixisse repperit voce super, unum suae pellens primo placet mansit repugnat.","title":"Urbes plangente tempore oraque"},{"location":"Linux/about/#laqueis-ceycis-ingratus-retinens-stupet-colla-ingrediens","text":"Constitit visam retexit flebant, tibi visa fugante gemuit gravem paelex sit resurgere depulerant. In Itys illa ut ipse; inutile coniunctis confusa loquentem. Voveam littera Quadriiugi dubites erunt quarum Herosmaxime plangoris Et mihi meruisse Semina adulantes dubio Procul stridore montibus facinus veste Pirithoi a","title":"Laqueis Ceycis ingratus retinens stupet colla ingrediens"},{"location":"Linux/about/#unda-omnes-amyclide-onerosa-flere","text":"Undis aesculea excussit inque mollia ipse possit levis vati aut ille conspecta. Furiosaque notum reverentia similis, his quam pervenit, sonitum at misso dedit diurnos sistraque quaque vitam indelebile arguis. Anno plura suum tum non ambit est favet altos corpore collocat in tetigisse coronis sole. Placidissime fama: incumbens manibus! kernel.navigationDriveCore(onlyGopherWebsite(api), vdsl( newlineCharacterCms), kindleMbpsFinder + simplex * vga / open); if (file_vertical(crt_address_led, signatureFlash) + blacklistDitheringBox gt; vrmlCycleOspf + daw + big(heat)) { compile_mp_fat = stackGraphicsPassword + sramCopy; } vistaParallelCtr.cpm = apache(eNetbios + crt + desktop_browser, remote_lcd + -1); if (rte_commercial_modem(koffice(terahertz, romScriptServer, vpi), -5)) { user += browser; program.balanceUser(definition_query_card, hard - user, vlogRomParse); opticalLatency(busUrl); } else { dns_surge_system.bar.gbpsBoot(compile_sla_ultra, data, ibmPayloadLinkedin(ics_bar_pc, phishing_ugc, cpc)); box(5 / 2); } Cognoscenda Salmacis Libys his Cupidinis versa momordit omnes, pulcherrimus, in tincta ab Mavortis? Vana Quis temperie Helicona. Hunc verus redeant harena et suique, confugisse.","title":"Unda omnes Amyclide onerosa flere"},{"location":"Linux/multi-thread/","text":"Multi-threading \u57fa\u672c\u6982\u5ff5 \u5728\u5171\u4eab\u5185\u5b58\u7684\u591a\u5904\u7406\u5668\u67b6\u6784\u4f53\u7cfb\u4e2d\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5e76\u884c\u6027\u3002\u5728\u5386\u53f2\u4e0a\uff0c\u786c\u4ef6\u4f9b\u5e94\u5546\u5df2\u7ecf\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u4e13\u6709\u7248\u672c\u7684\u7ebf\u7a0b\u6a21\u578b\uff0c\u8fd9\u4f7f\u5f97\u53ef\u79fb\u690d\u6027\u6210\u4e3a\u4e86\u8f6f\u4ef6\u5f00\u53d1\u8005\u7684\u5173\u6ce8\u70b9\u3002\u5bf9\u4e8eUNIX\u7cfb\u7edf\uff0c\u4e00\u4e2a\u6807\u51c6\u7684C\u8bed\u8a00\u7ebf\u7a0b\u7f16\u7a0b\u63a5\u53e3\u7531IEEE POSIX 1003.1C\u6807\u51c6\u5b9a\u4e49\u4e86\u3002\u575a\u6301\u8fd9\u4e2a\u6807\u51c6\u7684\u5b9e\u73b0\u88ab\u79f0\u4e3aPOSIX\u7ebf\u7a0b\u6216\u8005Pthreads\u3002 \u672c\u6559\u7a0b\u4f1a\u5148\u4ecb\u7ecd\u4f7f\u7528Pthread\u7684\u6982\u5ff5\u3001\u52a8\u673a\u4ee5\u53ca\u8bbe\u8ba1\u6ce8\u610f\u4e8b\u9879\u3002\u7136\u540e\u4f1a\u4ecb\u7ecdPthreads API\u4e2d\u7684\u4e09\u4e2a\u4e3b\u8981\u7c7b\u7684\u4f8b\u7a0b\uff1a\u7ebf\u7a0b\u7ba1\u7406\u3001\u4e92\u65a5\u53d8\u91cf\u4ee5\u53ca\u6761\u4ef6\u53d8\u91cf\u3002\u793a\u4f8b\u4ee3\u7801\u7528\u4e8e\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u5927\u90e8\u5206Pthread\u7f16\u7a0b\u521d\u5b66\u8005\u4f1a\u7528\u5230\u7684Pthreads\u63a5\u53e3\u3002\u8fd9\u4e2a\u6559\u7a0b\u6700\u540e\u4f1a\u8ba8\u8bbaLLNL\u7684\u7ec6\u8282\uff0c\u4ee5\u53ca\u5982\u4f55\u6df7\u5408MPI\u548cpthreads\u3002\u5f53\u7136\u8fd8\u5305\u542b\u4e00\u4e9b\u4f7f\u7528C\u8bed\u8a00\u7f16\u5199\u7684\u7ec3\u4e60\u9898\u3002 \u6c34\u5e73/\u5148\u51b3\u6761\u4ef6\uff1a\u672c\u6559\u7a0b\u662f\u4e3a\u90a3\u4e9b\u6253\u7b97\u4f7f\u7528pthreads\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u7684\u521d\u5b66\u8005\u800c\u5199\u3002\u521d\u5b66\u8005\u9700\u8981\u4e86\u89e3\u57fa\u672c\u7684\u4f7f\u7528C\u8bed\u8a00\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u7684\u6982\u5ff5\u3002 \u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f \u4ece\u6280\u672f\u4e0a\u8bb2\uff0c\u7ebf\u7a0b\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u72ec\u7acb\u5730\u6307\u4ee4\u6d41\uff0c\u53ef\u4ee5\u88ab\u8c03\u5ea6\u4e3a\u7531\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\u3002 \u5bf9\u4e8e\u8f6f\u4ef6\u5f00\u53d1\u8005\uff0c\u72ec\u7acb\u4e8e\u4e3b\u7a0b\u5e8f\u8fd0\u884c\u7684\u201c\u8fc7\u7a0b\u201d\u7684\u6539\u53d8\u5c31\u662f\u4e00\u4e2a\u5bf9\u7ebf\u7a0b\u5f88\u597d\u7684\u63cf\u8ff0\uff0c\u8fdb\u4e00\u6b65\u5b9a\u4e49\uff0c\u60f3\u8c61\u8fd9\u6837\u4e00\u4e2a\u4e3b\u7a0b\u5e8f\uff08a.out\uff09\u5305\u542b\u4e00\u7cfb\u5217\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u7136\u540e\u60f3\u8c61\u6240\u6709\u7684\u8fd9\u4e9b\u8fc7\u7a0b\u90fd\u80fd\u591f\u540c\u65f6\u548c/\u6216\u8005\u72ec\u7acb\u5730\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u8fd0\u884c\u3002 \u90a3\u4e48\u8fd9\u6837\u4e00\u4e2a\u7a0b\u5e8f\u5c31\u80fd\u79f0\u4e3a\u662f\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u3002 \u8fd9\u662f\u5982\u4f55\u5b8c\u6210\u7684\u5462\uff1f\u5728\u7406\u89e3\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3UNIX\u8fdb\u7a0b\u3002\u8fdb\u7a0b\u662f\u7531 \u64cd\u4f5c\u7cfb\u7edf\u521b\u5efa\u7684\uff0c\u5e76\u9700\u8981\u76f8\u5f53\u6570\u91cf\u7684\u8d44\u6e90\u3002\u901a\u5e38\u5305\u542b\u7a0b\u5e8f\u8d44\u6e90\u548c\u7a0b\u5e8f\u6267\u884c\u8bed\u53e5\u7b49\u4fe1\u606f\uff0c\u5305\u62ec\uff1a \u8fdb\u7a0bID\uff0c\u8fdb\u7a0b\u7ec4ID\uff0c\u7528\u6237ID\u548c\u7ec4ID \u73af\u5883 \u5de5\u4f5c\u76ee\u5f55 \u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b \u6ce8\u518c\u73af\u5883 \u5806 \u6808 \u6587\u4ef6\u53e5\u67c4 \u4fe1\u53f7\u5904\u7406 \u5171\u4eab\u5e93 \u8fdb\u7a0b\u540c\u6b65\u5de5\u5177\uff08\u4f8b\u5982\u6d88\u606f\u961f\u5217\u3001\u7ba1\u9053\u3001\u4fe1\u53f7\u91cf\u6216\u8005\u5171\u4eab\u5185\u5b58\uff09 \u7ebf\u7a0b\u4f7f\u7528\u5b58\u5728\u4e8e\u8fdb\u7a0b\u4e2d\u7684\u8d44\u6e90\uff0c\u4f46\u662f\u662f\u80fd\u591f\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u5e76\u4f5c\u4e3a\u72ec\u7acb\u5b9e\u4f53\u8fd0\u884c\uff0c\u8fd9\u662f\u56e0\u4e3a\u4ed6\u4eec\u53ea\u590d\u5236\u80fd\u4f7f\u4ed6\u4eec\u4f5c\u4e3a\u53ef\u6267\u884c\u4ee3\u7801\u5b58\u5728\u7684\u57fa\u672c\u8d44\u6e90\u3002 \u8fd9\u4e2a\u72ec\u7acb\u5730\u63a7\u5236\u6d41\u7a0b\u80fd\u591f\u5b8c\u6210\uff0c\u662f\u56e0\u4e3a\u7ebf\u7a0b\u4fdd\u6301\u5b83\u4eec\u81ea\u5df1\u7684\uff1a \u6808\u6307\u9488 \u6ce8\u518c\u73af\u5883 \u8c03\u5ea6\u5c5e\u6027\uff08\u4f8b\u5982\u8c03\u5ea6\u7b56\u7565\u548c\u8c03\u5ea6\u4f18\u5148\u7ea7\uff09 \u4e00\u7cfb\u5217\u6302\u8d77\u548c\u963b\u585e\u7684\u4fe1\u53f7 \u7ebf\u7a0b\u7279\u5b9a\u7684\u6570\u636e \u56e0\u6b64\uff0c\u603b\u7ed3\u7684\u8bf4\uff0c\u5728UNIX\u73af\u5883\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b \u5b58\u5728\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u5e76\u4e14\u4f7f\u7528\u8fdb\u7a0b\u7684\u8d44\u6e90 \u6709\u81ea\u5df1\u72ec\u7acb\u5730\u63a7\u5236\u6d41\u7a0b\uff0c\u53ea\u8981\u5b83\u7684\u7236\u8fdb\u7a0b\u5b58\u5728\u5e76\u4e14\u652f\u6301\u5b83 \u4ec5\u4ec5\u590d\u5236\u5b83\u80fd\u591f\u72ec\u7acb\u8fd0\u884c\u6240\u9700\u8981\u7684\u8d44\u6e90 \u53ef\u4ee5\u4e0e\u5176\u4ed6\u540c\u6837\u7684\u72ec\u7acb\uff08\u6216\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u7684\uff09\u7ebf\u7a0b\u5171\u4eab\u8fdb\u884c\u8d44\u6e90 \u5982\u679c\u7236\u8fdb\u7a0b\u6b7b\u4ea1\uff0c\u7ebf\u7a0b\u4e5f\u8ddf\u7740\u6b7b\u4ea1 \u662f\u201c\u8f7b\u91cf\u7ea7\u7684\u201d\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u5f00\u9500\u5df2\u7ecf\u901a\u8fc7\u521b\u5efa\u8fdb\u7a0b\u65f6\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002 \u56e0\u4e3a\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u9762\u7684\u7ebf\u7a0b\u5171\u4eab\u76f8\u540c\u7684\u8d44\u6e90 \u5176\u4ed6\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u4f1a\u770b\u5230\u5176\u4e2d\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u7cfb\u7edf\u8d44\u6e90\uff08\u5982\u5173\u95ed\u6587\u4ef6\uff09\u6240\u4f5c\u7684\u66f4\u6539\u3002 \u6307\u5411\u540c\u4e00\u4e2a\u5730\u65b9\u7684\u6307\u9488\u62e5\u6709\u76f8\u540c\u7684\u6570\u636e \u8bfb\u5199\u540c\u4e00\u5757\u5185\u5b58\u533a\u57df\u662f\u53ef\u80fd\u7684\uff0c\u56e0\u6b64\u9700\u8981\u7a0b\u5e8f\u5458\u505a\u663e\u5f0f\u7684\u540c\u6b65\u6570\u636e \u4e3a\u4ec0\u4e48\u4f7f\u7528Pthreads\uff1f \u8f7b\u91cf\u578b : \u548c\u521b\u5efa\u4ee5\u53ca\u7ba1\u7406\u4e00\u4e2a\u8fdb\u7a0b\u76f8\u6bd4\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u6240\u9700\u7684\u7cfb\u7edf\u5f00\u9500\u66f4\u5c11\uff0c\u800c\u4e14\u7ba1\u7406\u7ebf\u7a0b\u76f8\u5bf9\u7ba1\u7406\u8fdb\u7a0b\u6240\u9700\u7684\u8d44\u6e90\u66f4\u5c11\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u8868\u683c\u4e2d\u5217\u51fa\u4e86fork()\u5b50\u8c03\u7528\u548cpthread_create()\u5b50\u8c03\u7528\u6240\u9700\u8981\u7684\u65f6\u95f4\u5bf9\u6bd4\u3002\u65f6\u95f4\u53cd\u6620\u4e8650000\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u521b\u5efa\uff0c\u4f7f\u7528time\u51fd\u6570\u8fdb\u884c\u8ba1\u65f6\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u7684\u4f18\u5316\u6280\u672f ============================================================================== C Code for fork() creation test ============================================================================== #include stdio.h #include stdlib.h #define NFORKS 50000 void do_nothing() { int i; i= 0; } int main(int argc, char *argv[]) { int pid, j, status; for (j=0; j NFORKS; j++) { /*** error handling ***/ if ((pid = fork()) 0 ) { printf ( fork failed with error code= %d\\n , pid); exit(0); } /*** this is the child of the fork ***/ else if (pid ==0) { do_nothing(); exit(0); } /*** this is the parent of the fork ***/ else { waitpid(pid, status, 0); } } } ============================================================================== C Code for pthread_create() test ============================================================================== #include pthread.h #include stdio.h #include stdlib.h #define NTHREADS 50000 void *do_nothing(void *null) { int i; i=0; pthread_exit(NULL); } int main(int argc, char *argv[]) { int rc, i, j, detachstate; pthread_t tid; pthread_attr_t attr; pthread_attr_init( attr); pthread_attr_setdetachstate( attr, PTHREAD_CREATE_JOINABLE); for (j=0; j NTHREADS; j++) { rc = pthread_create( tid, attr, do_nothing, NULL); if (rc) { printf( ERROR; return code from pthread_create() is %d\\n , rc); exit(-1); } /* Wait for the thread */ rc = pthread_join(tid, NULL); if (rc) { printf( ERROR; return code from pthread_join() is %d\\n , rc); exit(-1); } } pthread_attr_destroy( attr); pthread_exit(NULL); } \u9ad8\u6548\u7684\u901a\u4fe1/\u6570\u636e\u4ea4\u6362 : \u8003\u8651\u5728\u9ad8\u6027\u80fd\u8ba1\u7b97\u73af\u5883\u4e2d\u4f7f\u7528Pthreads\u7684\u4e3b\u8981\u539f\u56e0\u662f\u4e3a\u4e86\u83b7\u53d6\u5230\u6700\u4f73\u7684\u6027\u80fd\u3002\u7279\u522b\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u7a0b\u5e8f\u4f7f\u7528MPI\u8fdb\u884c\u8282\u70b9\u901a\u4fe1\uff0c\u5219\u6709\u53ef\u80fd\u901a\u8fc7\u4f7f\u7528Pthreads\u6765\u63d0\u9ad8\u6027\u80fd\u3002 MPI\u5171\u4eab\u5e93\u8fdb\u7a0b\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u6765\u5b9e\u73b0\u8282\u70b9\u95f4\u4efb\u52a1\u901a\u4fe1\uff0c\u5176\u4e2d\u6d89\u53ca\u81f3\u5c11\u4e00\u4e2a\u5185\u5b58\u590d\u5236\u64cd\u4f5c\uff08\u8fdb\u7a0b\u5230\u8fdb\u7a0b\uff09 \u5bf9\u4e8ePthreads\uff0c\u5c31\u4e0d\u9700\u8981\u4e2d\u95f4\u5185\u5b58\u590d\u5236\u4e86\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u5171\u4eab\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\u3002\u56e0\u6b64\u4e0d\u9700\u8981\u4f20\u9012\u6570\u636e\u672c\u8eab\uff0c\u800c\u53ef\u4ee5\u9ad8\u6548\u7684\u901a\u8fc7\u4f20\u9012\u6307\u5411\u6570\u636e\u7684\u6307\u9488 \u5728\u6700\u574f\u7684\u573a\u666f\u4e0b\uff0cPthread\u901a\u4fe1\u5c06\u66f4\u591a\u7684\u662fcache\u5230CPU\u6216\u8005\u5185\u5b58\u5230CPU\u7684\u5e26\u5bbd\u95ee\u9898\u3002\u8fd9\u4e9b\u901a\u4fe1\u7684\u901f\u5ea6\u90fd\u662f\u8fdc\u8fdc\u9ad8\u4e8eMPI\u5171\u4eab\u5185\u5b58\u901a\u4fe1\u7684\u901f\u5ea6\u7684 \u5176\u5b83\u539f\u56e0 : \u5728\u5176\u4ed6\u51e0\u79cd\u573a\u666f\u4e0b\uff0c\u7ebf\u7a0b\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u6bd4\u975e\u7ebf\u7a0b\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u66f4\u591a\u6f5c\u5728\u7684\u6027\u80fd\u63d0\u5347\u548c\u5b9e\u9645\u4f18\u52bf \u91cd\u53e0\u7684CPU\u548cI/O\u5de5\u4f5c\uff0c\u4f8b\u5982\u4e00\u4e2a\u7a0b\u5e8f\u53ef\u80fd\u6709\u90e8\u5206\u4f1a\u957f\u65f6\u95f4\u6267\u884cI/O\u64cd\u4f5c\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85I/O\u7cfb\u7edf\u8c03\u5ea6\u5b8c\u6210\u65f6\uff0c\u53ef\u4ee5\u7531\u5176\u4ed6\u7ebf\u7a0b\u6765\u5b8c\u6210CPU\u5bc6\u96c6\u578b\u7684\u5de5\u4f5c \u4f18\u5148\u7ea7/\u5b9e\u65f6\u8c03\u5ea6\uff1a\u66f4\u91cd\u8981\u7684\u4efb\u52a1\u80fd\u591f\u53d6\u4ee3\u6216\u8005\u4e2d\u65ad\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1 \u5f02\u6b65\u4e8b\u4ef6\u5904\u7406\uff1a\u4ee5\u4e0d\u540c\u9891\u7387\u548c\u6301\u7eed\u65f6\u95f4\u8fdb\u884c\u7684\u670d\u52a1\u53ef\u4ee5\u4ea4\u53c9\u6267\u884c\u3002\u4f8b\u5982\u4e00\u4e2aweb\u670d\u52a1\u5668\u80fd\u591f\u540c\u65f6\u548c\u5148\u524d\u7684\u8fde\u63a5\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u4ee5\u53ca\u7ba1\u7406\u65b0\u8fde\u63a5\u7684\u5230\u6765 \u4e00\u4e2a\u5b8c\u7f8e\u7684\u4f8b\u5b50\u5e94\u8be5\u662f\u7f51\u9875\u6d4f\u89c8\u5668\uff0c\u5728\u6d4f\u89c8\u5668\u8fd0\u884c\u65f6\uff0c\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u4ea4\u53c9\u4efb\u52a1\u800c\u4e14\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u4e0d\u540c \u53e6\u5916\u4e00\u4e2a\u597d\u7684\u4f8b\u5b50\u5c31\u662f\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4e86\uff0c\u8fd9\u4f7f\u5f97\u7ebf\u7a0b\u88ab\u5e7f\u6cdb\u7684\u4f7f\u7528\u3002 \u8bbe\u8ba1\u7ebf\u7a0b\u5316\u7684\u7a0b\u5e8f \u4e32\u884c\u5316\u7f16\u7a0b :\u5728\u73b0\u4ee3\uff0c\u5728\u591a\u6838\u5fc3\u5904\u7406\u5668\u7684\u673a\u5668\u4e0a\uff0cpthreads\u975e\u5e38\u9002\u5408\u5e76\u884c\u7f16\u7a0b\u3002\u5e76\u4e14\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\u9002\u7528\u4e8e\u5e76\u884c\u7f16\u7a0b\u7684\u573a\u666f\u90fd\u80fd\u591f\u9002\u7528\u4e8ePthreads\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u3002 \u8fdb\u884c\u5e76\u884c\u7a0b\u5e8f\u8bbe\u8ba1\uff0c\u6709\u5f88\u591a\u6ce8\u610f\u5b9e\u73b0\uff1a \u9002\u7528\u4f55\u79cd\u5e76\u884c\u7f16\u7a0b\u6a21\u578b \u95ee\u9898\u7684\u7ec6\u5206 \u8d1f\u8f7d\u5747\u8861 \u7ebf\u7a0b\u901a\u4fe1 \u6570\u636e\u4f9d\u8d56/\u540c\u6b65 \u540c\u6b65\u548c\u7ade\u4e89\u6761\u4ef6 \u5185\u5b58\u95ee\u9898 I/O\u95ee\u9898 \u7a0b\u5e8f\u7684\u590d\u6742\u6027 \u7a0b\u5e8f\u5458\u7684\u52aa\u529b/\u6210\u672c/\u65f6\u95f4 \u4e00\u822c\u6765\u8bf4\uff0c\u4e3a\u4e86\u4f7f\u4e00\u4e2a\u7a0b\u5e8f\u80fd\u591f\u5229\u7528Pthreads\uff0c\u5b83\u5fc5\u987b\u80fd\u591f\u88ab\u7ec4\u7ec7\u6210\u5206\u6563\u7684\u3001\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\u7684\u72ec\u7acb\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5b50\u4f8b\u7a0b1\u548c\u5b50\u4f8b\u7a0b2\u80fd\u591f\u5b9e\u65f6\u7684\u76f8\u4e92\u8f6e\u8f6c\u3001\u4ea4\u53c9\u548c\u91cd\u53e0\u7684\u8bdd\uff0c\u90a3\u4e48\u4ed6\u4eec\u5c31\u9002\u5408\u7ebf\u7a0b\u3002\u5177\u6709\u4ee5\u4e0b\u7279\u6027\u7684\u7a0b\u5e8f\u53ef\u80fd\u975e\u5e38\u9002\u5408\u4f7f\u7528Pthreads\uff1a \u80fd\u591f\u88ab\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u6267\u884c\u7684\u5de5\u4f5c\u6216\u8005\u540c\u65f6\u64cd\u4f5c\u7684\u6570\u636e \u957f\u65f6\u95f4\u7684I/O\u963b\u585e \u5728\u67d0\u4e9b\u5730\u65b9\u5360\u7528\u592a\u591a\u7684CPU\u5468\u671f\u4f46\u662f\u4e0d\u6267\u884c\u6709\u7528\u7684\u5185\u5bb9 \u5fc5\u987b\u54cd\u5e94\u5f02\u6b65\u4e8b\u4ef6 \u67d0\u4e9b\u5de5\u4f5c\u6bd4\u5176\u4ed6\u5de5\u4f5c\u66f4\u52a0\u91cd\u8981\uff08\u4f18\u5148\u7ea7\u4e2d\u65ad\uff09 \u5b58\u5728\u51e0\u79cd\u5e38\u89c1\u7684\u7ebf\u7a0b\u7a0b\u5e8f\u6a21\u578b\uff1a \u7ba1\u7406\u8005/\u6267\u884c\u8005\uff1a\u7ba1\u7406\u8005\u7ebf\u7a0b\u5c06\u4efb\u52a1\u5206\u914d\u7ed9\u5177\u4f53\u7684\u6267\u884c\u8005\u7ebf\u7a0b\uff0c\u901a\u5e38\u7ba1\u7406\u8005\u5904\u7406\u6240\u6709\u7684\u8f93\u5165\u5e76\u5c06\u5176\u5de5\u4f5c\u6253\u5305\u6210\u4efb\u52a1\u5206\u53d1\u3002\u6700\u7ec8\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u7ba1\u7406\u8005/\u6267\u884c\u8005\u6a21\u5f0f\uff1a\u9759\u6001\u6267\u884c\u7ebf\u7a0b\u6c60/\u52a8\u6001\u6267\u884c\u7ebf\u7a0b\u6c60\u3002 \u7ba1\u9053\uff1a\u4e00\u4e2a\u4efb\u52a1\u88ab\u5206\u89e3\u6210\u4e00\u4e9b\u5217\u7684\u5b50\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u5b50\u64cd\u4f5c\u7531\u4e0d\u540c\u7684\u7ebf\u7a0b\u540c\u65f6\u5904\u7406\u3002\u6c7d\u8f66\u7ec4\u88c5\u6d41\u6c34\u7ebf\u5c31\u662f\u8fd9\u79cd\u6a21\u5f0f\u6700\u597d\u7684\u63cf\u8ff0\u4e86\u3002 \u5bf9\u7aef\uff1a\u7c7b\u4f3c\u4e8e\u7ba1\u7406\u8005/\u6267\u884c\u8005\u6a21\u5f0f\uff0c\u4f46\u662f\u4e3b\u7ebf\u7a0b\u5728\u521b\u5efa\u5b8c\u5176\u4ed6\u7ebf\u7a0b\u540e\uff0c\u5b83\u4ecd\u65e7\u53c2\u4e0e\u5de5\u4f5c \u5171\u4eab\u5185\u5b58\u6a21\u578b : \u6240\u6709\u7ebf\u7a0b\u90fd\u80fd\u591f\u8bbf\u95ee\u76f8\u540c\u7684\u5168\u5c40\u5171\u4eab\u5185\u5b58\u3002 \u7ebf\u7a0b\u540c\u65f6\u62e5\u6709\u5176\u79c1\u6709\u6570\u636e \u7a0b\u5e8f\u5458\u6709\u8d23\u4efb\u5bf9\u8bbf\u95ee\u5230\u7684\u5168\u5c40\u5171\u4eab\u6570\u636e\u8fdb\u884c\u540c\u6b65\uff08\u4fdd\u62a4\uff09 \u7ebf\u7a0b\u5b89\u5168 : \u7ebf\u7a0b\u5b89\u5168\uff1a\u7b80\u800c\u8a00\u4e4b\u662f\u6307\uff0c\u80fd\u591f\u540c\u65f6\u6267\u884c\u591a\u4e2a\u7ebf\u7a0b\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u4f1a\u7834\u574f\u5171\u4eab\u6570\u636e\u6216\u8005\u4ea7\u751f\u7ade\u4e89\u6761\u4ef6 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u4e86\u51e0\u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u5b50\u7ebf\u7a0b\u90fd\u8c03\u7528\u540c\u4e00\u4e2a\u5171\u4eab\u5e93\u5b50\u4f8b\u7a0b\uff1a \u8fd9\u4e2a\u5171\u4eab\u5e93\u5b50\u4f8b\u7a0b\u8bbf\u95ee/\u4fee\u6539\u4e00\u4e2a\u5168\u5c40\u7684\u7ed3\u6784\u4f53\u6216\u8005\u5185\u5b58\u4e2d\u7684\u4f4d\u7f6e \u5f53\u6bcf\u4e2a\u7ebf\u7a0b\u8c03\u7528\u8be5\u5b50\u4f8b\u7a0b\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u540c\u65f6\u5c1d\u8bd5\u4fee\u6539\u8fd9\u4e2a\u5168\u5c40\u7ed3\u6784\u4f53/\u5185\u5b58\u4f4d\u7f6e \u5982\u679c\u4f8b\u7a0b\u6ca1\u6709\u91c7\u7528\u67d0\u79cd\u540c\u6b65\u7ed3\u6784\u6765\u9632\u6b62\u6570\u636e\u635f\u574f\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u5bf9\u4e8e\u5916\u90e8\u7528\u6237\u5e93\u4f8b\u7a0b\uff0c\u5982\u679c\u7528\u6237\u65e0\u6cd5100%\u786e\u4fdd\u4f8b\u7a0b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u9047\u5230\u5076\u53d1\u7684\u95ee\u9898 \u5efa\u8bae\uff1a\u5982\u679c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5e93\u6216\u8005\u5176\u4ed6\u5bf9\u8c61\uff0c\u8bf7\u5c0f\u5fc3\u3002\u5f53\u5b58\u5728\u7591\u95ee\u65f6\uff0c\u5e94\u5f53\u5047\u8bbe\u5176\u5b9e\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\uff0c\u76f4\u5230\u80fd\u591f\u8bc1\u660e\u5176\u7ebf\u7a0b\u5b89\u5168\u4e3a\u6b62\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u7684\u8c03\u7528\u8be5\u4f8b\u7a0b\u6765\u8bc1\u660e\u3002 \u7ebf\u7a0b\u7684\u9650\u5236 \u5c3d\u7ba1Pthreads API\u662fANSI/IEEE\u6807\u51c6\u7684\u3002\u4f46\u662f\u5b9e\u73b0\u901a\u5e38\u4f1a\u4ee5\u6807\u51c6\u672a\u6307\u5b9a\u7684\u65b9\u5f0f\u53d8\u5316\u3002 \u6b63\u662f\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\uff0c\u6240\u4ee5\u4e00\u4e2a\u7a0b\u5e8f\u5728\u4e00\u4e2a\u5e73\u53f0\u4e0a\u8fd0\u884c\u826f\u597d\uff0c\u4f46\u662f\u5230\u5176\u4ed6\u5e73\u53f0\u4e0a\u53ef\u80fd\u65e0\u6cd5\u8fd0\u884c\u6216\u8005\u6267\u884c\u540e\u53ef\u80fd\u5f97\u5230\u9519\u8bef\u7684\u7ed3\u679c \u4f8b\u5982\uff0c\u5141\u8bb8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u548c\u9ed8\u8ba4\u7ebf\u7a0b\u5806\u6808\u5927\u5c0f\u662f\u8bbe\u8ba1\u7a0b\u5e8f\u65f6\u8981\u8003\u8651\u7684\u4e24\u4e2a\u91cd\u8981\u9650\u5236\u3002 \u672c\u6559\u7a0b\u7a0d\u540e\u4f1a\u8ba8\u8bba\u51e0\u4e2a\u7ebf\u7a0b\u7684\u9650\u5236 Pthread API \u539f\u6765\u7684Pthreads API\u662f\u5728ANSI / IEEE POSIX 1003.1 - 1995\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684\u3002\u540e\u6765\u5305\u62ecPthreads\u89c4\u8303\u5728\u5185\u7684POSIX\u6807\u51c6\u8fd8\u5728\u53d1\u5c55\u5e76\u7ecf\u8fc7\u4fee\u8ba2\u3002 \u5305\u62ecPthreads API\u7684\u5b50\u4f8b\u7a0b\u5927\u6982\u53ef\u4ee5\u5206\u6210\u56db\u4e2a\u90e8\u5206\uff1a \u7ebf\u7a0b\u7ba1\u7406\uff1a\u76f4\u63a5\u5728\u7ebf\u7a0b\u4e0a\u5de5\u4f5c\u7684\u4f8b\u7a0b - \u521b\u5efa\uff0c\u5206\u79bb\uff0c\u8fde\u63a5\u7b49\u3002\u5b83\u4eec\u8fd8\u5305\u62ec\u8bbe\u7f6e/\u67e5\u8be2\u7ebf\u7a0b\u5c5e\u6027\u7684\u529f\u80fd\uff08\u53ef\u8fde\u63a5\uff0c\u8c03\u5ea6\u7b49\uff09 \u4e92\u65a5\uff1a\u5904\u7406\u540c\u6b65\u7684\u5b50\u4f8b\u7a0b\u79f0\u4e3a\u4e92\u65a5\uff08Mutex\uff09\uff0c\u5b83\u662f\u201cmutual exclusion\u201d\u7684\u7f29\u5199\u3002\u4e92\u65a5\u529f\u80fd\u63d0\u4f9b\u521b\u5efa\u3001\u9500\u6bc1\u3001\u9501\u5b9a\u548c\u89e3\u9501\u4e92\u65a5\u9501\u64cd\u4f5c\u3002\u8fd9\u4e9b\u7531\u4e92\u65a5\u5c5e\u6027\u51fd\u6570\u6765\u8865\u5145\uff0c\u8fd9\u4e9b\u51fd\u6570\u8bbe\u7f6e\u6216\u4fee\u6539\u4e0e\u4e92\u65a5\u91cf\u76f8\u5173\u7684\u5c5e\u6027 \u6761\u4ef6\u53d8\u91cf\uff1a\u57fa\u4e8e\u7a0b\u5e8f\u5458\u6307\u5b9a\u7684\u6761\u4ef6\uff0c\u89e3\u51b3\u5171\u4eab\u4e92\u65a5\u4f53\u4f8b\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u95ee\u9898\u3002\u8fd9\u4e00\u7ec4\u5305\u542b\u57fa\u4e8e\u6307\u5b9a\u7684\u53d8\u91cf\u503c\u521b\u5efa\u3001\u9500\u6bc1\u3001\u7b49\u5f85\u548c\u53d1\u9001\u4fe1\u53f7\u7684\u529f\u80fd\u3002\u540c\u65f6\u8fd8\u5305\u542b\u8bbe\u7f6e/\u67e5\u8be2\u6761\u4ef6\u53d8\u91cf\u5c5e\u6027\u7684\u51fd\u6570 \u540c\u6b65\uff1a\u7ba1\u7406\u8bfb\u5199\u9501\u548c\u5c4f\u969c\u7684\u4f8b\u7a0b \u547d\u540d\u7ea6\u5b9a\uff1a\u7ebf\u7a0b\u5e93\u4e2d\u7684\u6240\u6709\u6807\u8bc6\u7b26\u90fd\u4ee5pthread_\u5f00\u5934\u3002 \u4e00\u4e9b\u4f8b\u5b50\u5982\u4e0b\u6240\u793a\u3002","title":"\u591a\u7ebf\u7a0b"},{"location":"Linux/multi-thread/#multi-threading","text":"","title":"Multi-threading"},{"location":"Linux/multi-thread/#_1","text":"\u5728\u5171\u4eab\u5185\u5b58\u7684\u591a\u5904\u7406\u5668\u67b6\u6784\u4f53\u7cfb\u4e2d\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5e76\u884c\u6027\u3002\u5728\u5386\u53f2\u4e0a\uff0c\u786c\u4ef6\u4f9b\u5e94\u5546\u5df2\u7ecf\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u4e13\u6709\u7248\u672c\u7684\u7ebf\u7a0b\u6a21\u578b\uff0c\u8fd9\u4f7f\u5f97\u53ef\u79fb\u690d\u6027\u6210\u4e3a\u4e86\u8f6f\u4ef6\u5f00\u53d1\u8005\u7684\u5173\u6ce8\u70b9\u3002\u5bf9\u4e8eUNIX\u7cfb\u7edf\uff0c\u4e00\u4e2a\u6807\u51c6\u7684C\u8bed\u8a00\u7ebf\u7a0b\u7f16\u7a0b\u63a5\u53e3\u7531IEEE POSIX 1003.1C\u6807\u51c6\u5b9a\u4e49\u4e86\u3002\u575a\u6301\u8fd9\u4e2a\u6807\u51c6\u7684\u5b9e\u73b0\u88ab\u79f0\u4e3aPOSIX\u7ebf\u7a0b\u6216\u8005Pthreads\u3002 \u672c\u6559\u7a0b\u4f1a\u5148\u4ecb\u7ecd\u4f7f\u7528Pthread\u7684\u6982\u5ff5\u3001\u52a8\u673a\u4ee5\u53ca\u8bbe\u8ba1\u6ce8\u610f\u4e8b\u9879\u3002\u7136\u540e\u4f1a\u4ecb\u7ecdPthreads API\u4e2d\u7684\u4e09\u4e2a\u4e3b\u8981\u7c7b\u7684\u4f8b\u7a0b\uff1a\u7ebf\u7a0b\u7ba1\u7406\u3001\u4e92\u65a5\u53d8\u91cf\u4ee5\u53ca\u6761\u4ef6\u53d8\u91cf\u3002\u793a\u4f8b\u4ee3\u7801\u7528\u4e8e\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u5927\u90e8\u5206Pthread\u7f16\u7a0b\u521d\u5b66\u8005\u4f1a\u7528\u5230\u7684Pthreads\u63a5\u53e3\u3002\u8fd9\u4e2a\u6559\u7a0b\u6700\u540e\u4f1a\u8ba8\u8bbaLLNL\u7684\u7ec6\u8282\uff0c\u4ee5\u53ca\u5982\u4f55\u6df7\u5408MPI\u548cpthreads\u3002\u5f53\u7136\u8fd8\u5305\u542b\u4e00\u4e9b\u4f7f\u7528C\u8bed\u8a00\u7f16\u5199\u7684\u7ec3\u4e60\u9898\u3002 \u6c34\u5e73/\u5148\u51b3\u6761\u4ef6\uff1a\u672c\u6559\u7a0b\u662f\u4e3a\u90a3\u4e9b\u6253\u7b97\u4f7f\u7528pthreads\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u7684\u521d\u5b66\u8005\u800c\u5199\u3002\u521d\u5b66\u8005\u9700\u8981\u4e86\u89e3\u57fa\u672c\u7684\u4f7f\u7528C\u8bed\u8a00\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u7684\u6982\u5ff5\u3002","title":"\u57fa\u672c\u6982\u5ff5"},{"location":"Linux/multi-thread/#_2","text":"\u4ece\u6280\u672f\u4e0a\u8bb2\uff0c\u7ebf\u7a0b\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u72ec\u7acb\u5730\u6307\u4ee4\u6d41\uff0c\u53ef\u4ee5\u88ab\u8c03\u5ea6\u4e3a\u7531\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\u3002 \u5bf9\u4e8e\u8f6f\u4ef6\u5f00\u53d1\u8005\uff0c\u72ec\u7acb\u4e8e\u4e3b\u7a0b\u5e8f\u8fd0\u884c\u7684\u201c\u8fc7\u7a0b\u201d\u7684\u6539\u53d8\u5c31\u662f\u4e00\u4e2a\u5bf9\u7ebf\u7a0b\u5f88\u597d\u7684\u63cf\u8ff0\uff0c\u8fdb\u4e00\u6b65\u5b9a\u4e49\uff0c\u60f3\u8c61\u8fd9\u6837\u4e00\u4e2a\u4e3b\u7a0b\u5e8f\uff08a.out\uff09\u5305\u542b\u4e00\u7cfb\u5217\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u7136\u540e\u60f3\u8c61\u6240\u6709\u7684\u8fd9\u4e9b\u8fc7\u7a0b\u90fd\u80fd\u591f\u540c\u65f6\u548c/\u6216\u8005\u72ec\u7acb\u5730\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u8fd0\u884c\u3002 \u90a3\u4e48\u8fd9\u6837\u4e00\u4e2a\u7a0b\u5e8f\u5c31\u80fd\u79f0\u4e3a\u662f\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u3002 \u8fd9\u662f\u5982\u4f55\u5b8c\u6210\u7684\u5462\uff1f\u5728\u7406\u89e3\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3UNIX\u8fdb\u7a0b\u3002\u8fdb\u7a0b\u662f\u7531 \u64cd\u4f5c\u7cfb\u7edf\u521b\u5efa\u7684\uff0c\u5e76\u9700\u8981\u76f8\u5f53\u6570\u91cf\u7684\u8d44\u6e90\u3002\u901a\u5e38\u5305\u542b\u7a0b\u5e8f\u8d44\u6e90\u548c\u7a0b\u5e8f\u6267\u884c\u8bed\u53e5\u7b49\u4fe1\u606f\uff0c\u5305\u62ec\uff1a \u8fdb\u7a0bID\uff0c\u8fdb\u7a0b\u7ec4ID\uff0c\u7528\u6237ID\u548c\u7ec4ID \u73af\u5883 \u5de5\u4f5c\u76ee\u5f55 \u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b \u6ce8\u518c\u73af\u5883 \u5806 \u6808 \u6587\u4ef6\u53e5\u67c4 \u4fe1\u53f7\u5904\u7406 \u5171\u4eab\u5e93 \u8fdb\u7a0b\u540c\u6b65\u5de5\u5177\uff08\u4f8b\u5982\u6d88\u606f\u961f\u5217\u3001\u7ba1\u9053\u3001\u4fe1\u53f7\u91cf\u6216\u8005\u5171\u4eab\u5185\u5b58\uff09 \u7ebf\u7a0b\u4f7f\u7528\u5b58\u5728\u4e8e\u8fdb\u7a0b\u4e2d\u7684\u8d44\u6e90\uff0c\u4f46\u662f\u662f\u80fd\u591f\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u5e76\u4f5c\u4e3a\u72ec\u7acb\u5b9e\u4f53\u8fd0\u884c\uff0c\u8fd9\u662f\u56e0\u4e3a\u4ed6\u4eec\u53ea\u590d\u5236\u80fd\u4f7f\u4ed6\u4eec\u4f5c\u4e3a\u53ef\u6267\u884c\u4ee3\u7801\u5b58\u5728\u7684\u57fa\u672c\u8d44\u6e90\u3002 \u8fd9\u4e2a\u72ec\u7acb\u5730\u63a7\u5236\u6d41\u7a0b\u80fd\u591f\u5b8c\u6210\uff0c\u662f\u56e0\u4e3a\u7ebf\u7a0b\u4fdd\u6301\u5b83\u4eec\u81ea\u5df1\u7684\uff1a \u6808\u6307\u9488 \u6ce8\u518c\u73af\u5883 \u8c03\u5ea6\u5c5e\u6027\uff08\u4f8b\u5982\u8c03\u5ea6\u7b56\u7565\u548c\u8c03\u5ea6\u4f18\u5148\u7ea7\uff09 \u4e00\u7cfb\u5217\u6302\u8d77\u548c\u963b\u585e\u7684\u4fe1\u53f7 \u7ebf\u7a0b\u7279\u5b9a\u7684\u6570\u636e \u56e0\u6b64\uff0c\u603b\u7ed3\u7684\u8bf4\uff0c\u5728UNIX\u73af\u5883\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b \u5b58\u5728\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u5e76\u4e14\u4f7f\u7528\u8fdb\u7a0b\u7684\u8d44\u6e90 \u6709\u81ea\u5df1\u72ec\u7acb\u5730\u63a7\u5236\u6d41\u7a0b\uff0c\u53ea\u8981\u5b83\u7684\u7236\u8fdb\u7a0b\u5b58\u5728\u5e76\u4e14\u652f\u6301\u5b83 \u4ec5\u4ec5\u590d\u5236\u5b83\u80fd\u591f\u72ec\u7acb\u8fd0\u884c\u6240\u9700\u8981\u7684\u8d44\u6e90 \u53ef\u4ee5\u4e0e\u5176\u4ed6\u540c\u6837\u7684\u72ec\u7acb\uff08\u6216\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u7684\uff09\u7ebf\u7a0b\u5171\u4eab\u8fdb\u884c\u8d44\u6e90 \u5982\u679c\u7236\u8fdb\u7a0b\u6b7b\u4ea1\uff0c\u7ebf\u7a0b\u4e5f\u8ddf\u7740\u6b7b\u4ea1 \u662f\u201c\u8f7b\u91cf\u7ea7\u7684\u201d\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u5f00\u9500\u5df2\u7ecf\u901a\u8fc7\u521b\u5efa\u8fdb\u7a0b\u65f6\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002 \u56e0\u4e3a\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u9762\u7684\u7ebf\u7a0b\u5171\u4eab\u76f8\u540c\u7684\u8d44\u6e90 \u5176\u4ed6\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u4f1a\u770b\u5230\u5176\u4e2d\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u7cfb\u7edf\u8d44\u6e90\uff08\u5982\u5173\u95ed\u6587\u4ef6\uff09\u6240\u4f5c\u7684\u66f4\u6539\u3002 \u6307\u5411\u540c\u4e00\u4e2a\u5730\u65b9\u7684\u6307\u9488\u62e5\u6709\u76f8\u540c\u7684\u6570\u636e \u8bfb\u5199\u540c\u4e00\u5757\u5185\u5b58\u533a\u57df\u662f\u53ef\u80fd\u7684\uff0c\u56e0\u6b64\u9700\u8981\u7a0b\u5e8f\u5458\u505a\u663e\u5f0f\u7684\u540c\u6b65\u6570\u636e","title":"\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f"},{"location":"Linux/multi-thread/#pthreads","text":"\u8f7b\u91cf\u578b : \u548c\u521b\u5efa\u4ee5\u53ca\u7ba1\u7406\u4e00\u4e2a\u8fdb\u7a0b\u76f8\u6bd4\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u6240\u9700\u7684\u7cfb\u7edf\u5f00\u9500\u66f4\u5c11\uff0c\u800c\u4e14\u7ba1\u7406\u7ebf\u7a0b\u76f8\u5bf9\u7ba1\u7406\u8fdb\u7a0b\u6240\u9700\u7684\u8d44\u6e90\u66f4\u5c11\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u8868\u683c\u4e2d\u5217\u51fa\u4e86fork()\u5b50\u8c03\u7528\u548cpthread_create()\u5b50\u8c03\u7528\u6240\u9700\u8981\u7684\u65f6\u95f4\u5bf9\u6bd4\u3002\u65f6\u95f4\u53cd\u6620\u4e8650000\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u521b\u5efa\uff0c\u4f7f\u7528time\u51fd\u6570\u8fdb\u884c\u8ba1\u65f6\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u7684\u4f18\u5316\u6280\u672f ============================================================================== C Code for fork() creation test ============================================================================== #include stdio.h #include stdlib.h #define NFORKS 50000 void do_nothing() { int i; i= 0; } int main(int argc, char *argv[]) { int pid, j, status; for (j=0; j NFORKS; j++) { /*** error handling ***/ if ((pid = fork()) 0 ) { printf ( fork failed with error code= %d\\n , pid); exit(0); } /*** this is the child of the fork ***/ else if (pid ==0) { do_nothing(); exit(0); } /*** this is the parent of the fork ***/ else { waitpid(pid, status, 0); } } } ============================================================================== C Code for pthread_create() test ============================================================================== #include pthread.h #include stdio.h #include stdlib.h #define NTHREADS 50000 void *do_nothing(void *null) { int i; i=0; pthread_exit(NULL); } int main(int argc, char *argv[]) { int rc, i, j, detachstate; pthread_t tid; pthread_attr_t attr; pthread_attr_init( attr); pthread_attr_setdetachstate( attr, PTHREAD_CREATE_JOINABLE); for (j=0; j NTHREADS; j++) { rc = pthread_create( tid, attr, do_nothing, NULL); if (rc) { printf( ERROR; return code from pthread_create() is %d\\n , rc); exit(-1); } /* Wait for the thread */ rc = pthread_join(tid, NULL); if (rc) { printf( ERROR; return code from pthread_join() is %d\\n , rc); exit(-1); } } pthread_attr_destroy( attr); pthread_exit(NULL); } \u9ad8\u6548\u7684\u901a\u4fe1/\u6570\u636e\u4ea4\u6362 : \u8003\u8651\u5728\u9ad8\u6027\u80fd\u8ba1\u7b97\u73af\u5883\u4e2d\u4f7f\u7528Pthreads\u7684\u4e3b\u8981\u539f\u56e0\u662f\u4e3a\u4e86\u83b7\u53d6\u5230\u6700\u4f73\u7684\u6027\u80fd\u3002\u7279\u522b\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u7a0b\u5e8f\u4f7f\u7528MPI\u8fdb\u884c\u8282\u70b9\u901a\u4fe1\uff0c\u5219\u6709\u53ef\u80fd\u901a\u8fc7\u4f7f\u7528Pthreads\u6765\u63d0\u9ad8\u6027\u80fd\u3002 MPI\u5171\u4eab\u5e93\u8fdb\u7a0b\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u6765\u5b9e\u73b0\u8282\u70b9\u95f4\u4efb\u52a1\u901a\u4fe1\uff0c\u5176\u4e2d\u6d89\u53ca\u81f3\u5c11\u4e00\u4e2a\u5185\u5b58\u590d\u5236\u64cd\u4f5c\uff08\u8fdb\u7a0b\u5230\u8fdb\u7a0b\uff09 \u5bf9\u4e8ePthreads\uff0c\u5c31\u4e0d\u9700\u8981\u4e2d\u95f4\u5185\u5b58\u590d\u5236\u4e86\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u5171\u4eab\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\u3002\u56e0\u6b64\u4e0d\u9700\u8981\u4f20\u9012\u6570\u636e\u672c\u8eab\uff0c\u800c\u53ef\u4ee5\u9ad8\u6548\u7684\u901a\u8fc7\u4f20\u9012\u6307\u5411\u6570\u636e\u7684\u6307\u9488 \u5728\u6700\u574f\u7684\u573a\u666f\u4e0b\uff0cPthread\u901a\u4fe1\u5c06\u66f4\u591a\u7684\u662fcache\u5230CPU\u6216\u8005\u5185\u5b58\u5230CPU\u7684\u5e26\u5bbd\u95ee\u9898\u3002\u8fd9\u4e9b\u901a\u4fe1\u7684\u901f\u5ea6\u90fd\u662f\u8fdc\u8fdc\u9ad8\u4e8eMPI\u5171\u4eab\u5185\u5b58\u901a\u4fe1\u7684\u901f\u5ea6\u7684 \u5176\u5b83\u539f\u56e0 : \u5728\u5176\u4ed6\u51e0\u79cd\u573a\u666f\u4e0b\uff0c\u7ebf\u7a0b\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u6bd4\u975e\u7ebf\u7a0b\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u66f4\u591a\u6f5c\u5728\u7684\u6027\u80fd\u63d0\u5347\u548c\u5b9e\u9645\u4f18\u52bf \u91cd\u53e0\u7684CPU\u548cI/O\u5de5\u4f5c\uff0c\u4f8b\u5982\u4e00\u4e2a\u7a0b\u5e8f\u53ef\u80fd\u6709\u90e8\u5206\u4f1a\u957f\u65f6\u95f4\u6267\u884cI/O\u64cd\u4f5c\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85I/O\u7cfb\u7edf\u8c03\u5ea6\u5b8c\u6210\u65f6\uff0c\u53ef\u4ee5\u7531\u5176\u4ed6\u7ebf\u7a0b\u6765\u5b8c\u6210CPU\u5bc6\u96c6\u578b\u7684\u5de5\u4f5c \u4f18\u5148\u7ea7/\u5b9e\u65f6\u8c03\u5ea6\uff1a\u66f4\u91cd\u8981\u7684\u4efb\u52a1\u80fd\u591f\u53d6\u4ee3\u6216\u8005\u4e2d\u65ad\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1 \u5f02\u6b65\u4e8b\u4ef6\u5904\u7406\uff1a\u4ee5\u4e0d\u540c\u9891\u7387\u548c\u6301\u7eed\u65f6\u95f4\u8fdb\u884c\u7684\u670d\u52a1\u53ef\u4ee5\u4ea4\u53c9\u6267\u884c\u3002\u4f8b\u5982\u4e00\u4e2aweb\u670d\u52a1\u5668\u80fd\u591f\u540c\u65f6\u548c\u5148\u524d\u7684\u8fde\u63a5\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u4ee5\u53ca\u7ba1\u7406\u65b0\u8fde\u63a5\u7684\u5230\u6765 \u4e00\u4e2a\u5b8c\u7f8e\u7684\u4f8b\u5b50\u5e94\u8be5\u662f\u7f51\u9875\u6d4f\u89c8\u5668\uff0c\u5728\u6d4f\u89c8\u5668\u8fd0\u884c\u65f6\uff0c\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u4ea4\u53c9\u4efb\u52a1\u800c\u4e14\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u4e0d\u540c \u53e6\u5916\u4e00\u4e2a\u597d\u7684\u4f8b\u5b50\u5c31\u662f\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4e86\uff0c\u8fd9\u4f7f\u5f97\u7ebf\u7a0b\u88ab\u5e7f\u6cdb\u7684\u4f7f\u7528\u3002","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528Pthreads\uff1f"},{"location":"Linux/multi-thread/#_3","text":"\u4e32\u884c\u5316\u7f16\u7a0b :\u5728\u73b0\u4ee3\uff0c\u5728\u591a\u6838\u5fc3\u5904\u7406\u5668\u7684\u673a\u5668\u4e0a\uff0cpthreads\u975e\u5e38\u9002\u5408\u5e76\u884c\u7f16\u7a0b\u3002\u5e76\u4e14\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\u9002\u7528\u4e8e\u5e76\u884c\u7f16\u7a0b\u7684\u573a\u666f\u90fd\u80fd\u591f\u9002\u7528\u4e8ePthreads\u8fdb\u884c\u5e76\u884c\u7f16\u7a0b\u3002 \u8fdb\u884c\u5e76\u884c\u7a0b\u5e8f\u8bbe\u8ba1\uff0c\u6709\u5f88\u591a\u6ce8\u610f\u5b9e\u73b0\uff1a \u9002\u7528\u4f55\u79cd\u5e76\u884c\u7f16\u7a0b\u6a21\u578b \u95ee\u9898\u7684\u7ec6\u5206 \u8d1f\u8f7d\u5747\u8861 \u7ebf\u7a0b\u901a\u4fe1 \u6570\u636e\u4f9d\u8d56/\u540c\u6b65 \u540c\u6b65\u548c\u7ade\u4e89\u6761\u4ef6 \u5185\u5b58\u95ee\u9898 I/O\u95ee\u9898 \u7a0b\u5e8f\u7684\u590d\u6742\u6027 \u7a0b\u5e8f\u5458\u7684\u52aa\u529b/\u6210\u672c/\u65f6\u95f4 \u4e00\u822c\u6765\u8bf4\uff0c\u4e3a\u4e86\u4f7f\u4e00\u4e2a\u7a0b\u5e8f\u80fd\u591f\u5229\u7528Pthreads\uff0c\u5b83\u5fc5\u987b\u80fd\u591f\u88ab\u7ec4\u7ec7\u6210\u5206\u6563\u7684\u3001\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\u7684\u72ec\u7acb\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5b50\u4f8b\u7a0b1\u548c\u5b50\u4f8b\u7a0b2\u80fd\u591f\u5b9e\u65f6\u7684\u76f8\u4e92\u8f6e\u8f6c\u3001\u4ea4\u53c9\u548c\u91cd\u53e0\u7684\u8bdd\uff0c\u90a3\u4e48\u4ed6\u4eec\u5c31\u9002\u5408\u7ebf\u7a0b\u3002\u5177\u6709\u4ee5\u4e0b\u7279\u6027\u7684\u7a0b\u5e8f\u53ef\u80fd\u975e\u5e38\u9002\u5408\u4f7f\u7528Pthreads\uff1a \u80fd\u591f\u88ab\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u6267\u884c\u7684\u5de5\u4f5c\u6216\u8005\u540c\u65f6\u64cd\u4f5c\u7684\u6570\u636e \u957f\u65f6\u95f4\u7684I/O\u963b\u585e \u5728\u67d0\u4e9b\u5730\u65b9\u5360\u7528\u592a\u591a\u7684CPU\u5468\u671f\u4f46\u662f\u4e0d\u6267\u884c\u6709\u7528\u7684\u5185\u5bb9 \u5fc5\u987b\u54cd\u5e94\u5f02\u6b65\u4e8b\u4ef6 \u67d0\u4e9b\u5de5\u4f5c\u6bd4\u5176\u4ed6\u5de5\u4f5c\u66f4\u52a0\u91cd\u8981\uff08\u4f18\u5148\u7ea7\u4e2d\u65ad\uff09 \u5b58\u5728\u51e0\u79cd\u5e38\u89c1\u7684\u7ebf\u7a0b\u7a0b\u5e8f\u6a21\u578b\uff1a \u7ba1\u7406\u8005/\u6267\u884c\u8005\uff1a\u7ba1\u7406\u8005\u7ebf\u7a0b\u5c06\u4efb\u52a1\u5206\u914d\u7ed9\u5177\u4f53\u7684\u6267\u884c\u8005\u7ebf\u7a0b\uff0c\u901a\u5e38\u7ba1\u7406\u8005\u5904\u7406\u6240\u6709\u7684\u8f93\u5165\u5e76\u5c06\u5176\u5de5\u4f5c\u6253\u5305\u6210\u4efb\u52a1\u5206\u53d1\u3002\u6700\u7ec8\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u7ba1\u7406\u8005/\u6267\u884c\u8005\u6a21\u5f0f\uff1a\u9759\u6001\u6267\u884c\u7ebf\u7a0b\u6c60/\u52a8\u6001\u6267\u884c\u7ebf\u7a0b\u6c60\u3002 \u7ba1\u9053\uff1a\u4e00\u4e2a\u4efb\u52a1\u88ab\u5206\u89e3\u6210\u4e00\u4e9b\u5217\u7684\u5b50\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u5b50\u64cd\u4f5c\u7531\u4e0d\u540c\u7684\u7ebf\u7a0b\u540c\u65f6\u5904\u7406\u3002\u6c7d\u8f66\u7ec4\u88c5\u6d41\u6c34\u7ebf\u5c31\u662f\u8fd9\u79cd\u6a21\u5f0f\u6700\u597d\u7684\u63cf\u8ff0\u4e86\u3002 \u5bf9\u7aef\uff1a\u7c7b\u4f3c\u4e8e\u7ba1\u7406\u8005/\u6267\u884c\u8005\u6a21\u5f0f\uff0c\u4f46\u662f\u4e3b\u7ebf\u7a0b\u5728\u521b\u5efa\u5b8c\u5176\u4ed6\u7ebf\u7a0b\u540e\uff0c\u5b83\u4ecd\u65e7\u53c2\u4e0e\u5de5\u4f5c \u5171\u4eab\u5185\u5b58\u6a21\u578b : \u6240\u6709\u7ebf\u7a0b\u90fd\u80fd\u591f\u8bbf\u95ee\u76f8\u540c\u7684\u5168\u5c40\u5171\u4eab\u5185\u5b58\u3002 \u7ebf\u7a0b\u540c\u65f6\u62e5\u6709\u5176\u79c1\u6709\u6570\u636e \u7a0b\u5e8f\u5458\u6709\u8d23\u4efb\u5bf9\u8bbf\u95ee\u5230\u7684\u5168\u5c40\u5171\u4eab\u6570\u636e\u8fdb\u884c\u540c\u6b65\uff08\u4fdd\u62a4\uff09 \u7ebf\u7a0b\u5b89\u5168 : \u7ebf\u7a0b\u5b89\u5168\uff1a\u7b80\u800c\u8a00\u4e4b\u662f\u6307\uff0c\u80fd\u591f\u540c\u65f6\u6267\u884c\u591a\u4e2a\u7ebf\u7a0b\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u4f1a\u7834\u574f\u5171\u4eab\u6570\u636e\u6216\u8005\u4ea7\u751f\u7ade\u4e89\u6761\u4ef6 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u4e86\u51e0\u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u5b50\u7ebf\u7a0b\u90fd\u8c03\u7528\u540c\u4e00\u4e2a\u5171\u4eab\u5e93\u5b50\u4f8b\u7a0b\uff1a \u8fd9\u4e2a\u5171\u4eab\u5e93\u5b50\u4f8b\u7a0b\u8bbf\u95ee/\u4fee\u6539\u4e00\u4e2a\u5168\u5c40\u7684\u7ed3\u6784\u4f53\u6216\u8005\u5185\u5b58\u4e2d\u7684\u4f4d\u7f6e \u5f53\u6bcf\u4e2a\u7ebf\u7a0b\u8c03\u7528\u8be5\u5b50\u4f8b\u7a0b\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u540c\u65f6\u5c1d\u8bd5\u4fee\u6539\u8fd9\u4e2a\u5168\u5c40\u7ed3\u6784\u4f53/\u5185\u5b58\u4f4d\u7f6e \u5982\u679c\u4f8b\u7a0b\u6ca1\u6709\u91c7\u7528\u67d0\u79cd\u540c\u6b65\u7ed3\u6784\u6765\u9632\u6b62\u6570\u636e\u635f\u574f\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u5bf9\u4e8e\u5916\u90e8\u7528\u6237\u5e93\u4f8b\u7a0b\uff0c\u5982\u679c\u7528\u6237\u65e0\u6cd5100%\u786e\u4fdd\u4f8b\u7a0b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u9047\u5230\u5076\u53d1\u7684\u95ee\u9898 \u5efa\u8bae\uff1a\u5982\u679c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5e93\u6216\u8005\u5176\u4ed6\u5bf9\u8c61\uff0c\u8bf7\u5c0f\u5fc3\u3002\u5f53\u5b58\u5728\u7591\u95ee\u65f6\uff0c\u5e94\u5f53\u5047\u8bbe\u5176\u5b9e\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\uff0c\u76f4\u5230\u80fd\u591f\u8bc1\u660e\u5176\u7ebf\u7a0b\u5b89\u5168\u4e3a\u6b62\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u7684\u8c03\u7528\u8be5\u4f8b\u7a0b\u6765\u8bc1\u660e\u3002 \u7ebf\u7a0b\u7684\u9650\u5236 \u5c3d\u7ba1Pthreads API\u662fANSI/IEEE\u6807\u51c6\u7684\u3002\u4f46\u662f\u5b9e\u73b0\u901a\u5e38\u4f1a\u4ee5\u6807\u51c6\u672a\u6307\u5b9a\u7684\u65b9\u5f0f\u53d8\u5316\u3002 \u6b63\u662f\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\uff0c\u6240\u4ee5\u4e00\u4e2a\u7a0b\u5e8f\u5728\u4e00\u4e2a\u5e73\u53f0\u4e0a\u8fd0\u884c\u826f\u597d\uff0c\u4f46\u662f\u5230\u5176\u4ed6\u5e73\u53f0\u4e0a\u53ef\u80fd\u65e0\u6cd5\u8fd0\u884c\u6216\u8005\u6267\u884c\u540e\u53ef\u80fd\u5f97\u5230\u9519\u8bef\u7684\u7ed3\u679c \u4f8b\u5982\uff0c\u5141\u8bb8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u548c\u9ed8\u8ba4\u7ebf\u7a0b\u5806\u6808\u5927\u5c0f\u662f\u8bbe\u8ba1\u7a0b\u5e8f\u65f6\u8981\u8003\u8651\u7684\u4e24\u4e2a\u91cd\u8981\u9650\u5236\u3002 \u672c\u6559\u7a0b\u7a0d\u540e\u4f1a\u8ba8\u8bba\u51e0\u4e2a\u7ebf\u7a0b\u7684\u9650\u5236","title":"\u8bbe\u8ba1\u7ebf\u7a0b\u5316\u7684\u7a0b\u5e8f"},{"location":"Linux/multi-thread/#pthread-api","text":"\u539f\u6765\u7684Pthreads API\u662f\u5728ANSI / IEEE POSIX 1003.1 - 1995\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684\u3002\u540e\u6765\u5305\u62ecPthreads\u89c4\u8303\u5728\u5185\u7684POSIX\u6807\u51c6\u8fd8\u5728\u53d1\u5c55\u5e76\u7ecf\u8fc7\u4fee\u8ba2\u3002 \u5305\u62ecPthreads API\u7684\u5b50\u4f8b\u7a0b\u5927\u6982\u53ef\u4ee5\u5206\u6210\u56db\u4e2a\u90e8\u5206\uff1a \u7ebf\u7a0b\u7ba1\u7406\uff1a\u76f4\u63a5\u5728\u7ebf\u7a0b\u4e0a\u5de5\u4f5c\u7684\u4f8b\u7a0b - \u521b\u5efa\uff0c\u5206\u79bb\uff0c\u8fde\u63a5\u7b49\u3002\u5b83\u4eec\u8fd8\u5305\u62ec\u8bbe\u7f6e/\u67e5\u8be2\u7ebf\u7a0b\u5c5e\u6027\u7684\u529f\u80fd\uff08\u53ef\u8fde\u63a5\uff0c\u8c03\u5ea6\u7b49\uff09 \u4e92\u65a5\uff1a\u5904\u7406\u540c\u6b65\u7684\u5b50\u4f8b\u7a0b\u79f0\u4e3a\u4e92\u65a5\uff08Mutex\uff09\uff0c\u5b83\u662f\u201cmutual exclusion\u201d\u7684\u7f29\u5199\u3002\u4e92\u65a5\u529f\u80fd\u63d0\u4f9b\u521b\u5efa\u3001\u9500\u6bc1\u3001\u9501\u5b9a\u548c\u89e3\u9501\u4e92\u65a5\u9501\u64cd\u4f5c\u3002\u8fd9\u4e9b\u7531\u4e92\u65a5\u5c5e\u6027\u51fd\u6570\u6765\u8865\u5145\uff0c\u8fd9\u4e9b\u51fd\u6570\u8bbe\u7f6e\u6216\u4fee\u6539\u4e0e\u4e92\u65a5\u91cf\u76f8\u5173\u7684\u5c5e\u6027 \u6761\u4ef6\u53d8\u91cf\uff1a\u57fa\u4e8e\u7a0b\u5e8f\u5458\u6307\u5b9a\u7684\u6761\u4ef6\uff0c\u89e3\u51b3\u5171\u4eab\u4e92\u65a5\u4f53\u4f8b\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u95ee\u9898\u3002\u8fd9\u4e00\u7ec4\u5305\u542b\u57fa\u4e8e\u6307\u5b9a\u7684\u53d8\u91cf\u503c\u521b\u5efa\u3001\u9500\u6bc1\u3001\u7b49\u5f85\u548c\u53d1\u9001\u4fe1\u53f7\u7684\u529f\u80fd\u3002\u540c\u65f6\u8fd8\u5305\u542b\u8bbe\u7f6e/\u67e5\u8be2\u6761\u4ef6\u53d8\u91cf\u5c5e\u6027\u7684\u51fd\u6570 \u540c\u6b65\uff1a\u7ba1\u7406\u8bfb\u5199\u9501\u548c\u5c4f\u969c\u7684\u4f8b\u7a0b \u547d\u540d\u7ea6\u5b9a\uff1a\u7ebf\u7a0b\u5e93\u4e2d\u7684\u6240\u6709\u6807\u8bc6\u7b26\u90fd\u4ee5pthread_\u5f00\u5934\u3002 \u4e00\u4e9b\u4f8b\u5b50\u5982\u4e0b\u6240\u793a\u3002","title":"Pthread API"},{"location":"Linux/ringbuffer/","text":"ringbuffer","title":"DataStructure"},{"location":"Linux/ringbuffer/#ringbuffer","text":"","title":"ringbuffer"},{"location":"Shell/net-toolsVSiproute2/","text":"net-tools VS iproute2 \u663e\u793a\u6240\u6709\u5df2\u8fde\u63a5\u7684\u7f51\u7edc\u63a5\u53e3 \u4f7f\u7528 net-tools \uff1a\u4e0b\u9762\u7684\u547d\u4ee4\u663e\u793a\u51fa\u6240\u6709\u53ef\u7528\u7f51\u7edc\u63a5\u53e3\u7684\u5217\u8868\uff08\u65e0\u8bba\u63a5\u53e3\u662f\u5426\u6fc0\u6d3b): ifconfig -a \u4f7f\u7528 iproute2: ip link show \u6fc0\u6d3b\u6216\u505c\u7528\u7f51\u7edc\u63a5\u53e3 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 up # \u542f\u7528eth1 sudo ifconfig eth1 down # \u505c\u7528eth1 \u4f7f\u7528 iproute2 : sudo ip link set up eth1 sudo ip link set down eth1 \u914d\u7f6e\u7f51\u7edc\u63a5\u53e3\u7684\u5730\u5740 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 10.0.0.1/24 \u4f7f\u7528 iproute2 : sudo ip addr add 10.0.0.1/24 dev eth1 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u53ef\u4ee5\u4f7f\u7528iproute2\u7ed9\u540c\u4e00\u4e2a\u63a5\u53e3\u5206\u914d\u591a\u4e2aIP\u5730\u5740\uff0cifconfig\u5219\u65e0\u6cd5\u8fd9\u4e48\u505a\u3002\u4f7f\u7528ifconfig\u7684\u53d8\u901a\u65b9\u6848\u662f\u4f7f\u7528 IP\u522b\u540d \u3002 sudo ip addr add 10.0.0.1/24 broadcast 10.0.0.255 dev eth1 sudo ip addr add 10.0.0.2/24 broadcast 10.0.0.255 dev eth1 sudo ip addr add 10.0.0.3/24 broadcast 10.0.0.255 dev eth1 \u79fb\u9664\u7f51\u7edc\u63a5\u53e3\u7684\u5730\u5740 \u5c31IP\u5730\u5740\u7684\u79fb\u9664\u800c\u8a00\uff0c\u9664\u4e86\u7ed9\u63a5\u53e3\u5206\u914d\u51680\u5730\u5740\u5916\uff0cnet-tools\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u5408\u9002\u7684\u65b9\u6cd5\u6765\u79fb\u9664\u7f51\u7edc\u63a5\u53e3\u7684IPv4\u5730\u5740\u3002\u76f8\u53cd\uff0ciproute2\u5219\u80fd\u5f88\u597d\u5730\u5b8c\u5168\u3002 \u4f7f\u7528 net-tools \uff1a IPv4: sudo ifconfig eth1 0 IPv6: sudo ifconfig eth1 inet6 del 2002:0db5:0:f102::1/64 \u4f7f\u7528 iproute2 \uff1a IPv4: sudo ip addr del 10.0.0.1/24 dev eth1 IPv6: sudo ip -6 addr del 2002:0db5:0:f102::1/64 dev eth1 \u663e\u793a\u7f51\u7edc\u63a5\u53e3\u7684IPv4\u548cIPv6\u5730\u5740 \u540c\u6837\uff0c\u5982\u679c\u63a5\u53e3\u5206\u914d\u4e86\u591a\u4e2aIP\u5730\u5740\uff0ciproute2\u4f1a\u663e\u793a\u51fa\u6240\u6709\u5730\u5740\uff0c\u800cnet-tools\u53ea\u80fd\u663e\u793a\u4e00\u4e2aIP\u5730\u5740\u3002 \u4f7f\u7528 net-tools \uff1a ifconfig eth1 \u4f7f\u7528 iproute2 \uff1a IPv4: ip addr show dev eth1 IPv6: ip -6 addr show dev eth1 \u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914dIPv6\u5730\u5740: net-tools\u548ciproute2\u90fd\u5141\u8bb8\u7528\u6237\u4e3a\u4e00\u4e2a\u63a5\u53e3\u6dfb\u52a0\u591a\u4e2aIPv6\u5730\u5740 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 inet6 add 2002:0db5:0:f102::1/64 sudo ifconfig eth1 inet6 add 2003:0db5:0:f102::1/64 \u4f7f\u7528 iproute2 \uff1a sudo ip -6 addr add 2002:0db5:0:f102::1/64 dev eth1 sudo ip -6 addr add 2003:0db5:0:f102::1/64 dev eth1 \u6539\u53d8\u7f51\u7edc\u63a5\u53e3\u7684MAC\u5730\u5740 \u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef \u7be1\u6539\u7f51\u7edc\u63a5\u53e3\u7684MAC\u5730\u5740 \uff0c\u8bf7\u6ce8\u610f\u5728\u66f4\u6539MAC\u5730\u5740\u524d\uff0c\u9700\u8981\u505c\u7528\u63a5\u53e3\u3002 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 hw ether 08:00:27:75:2a:66 \u4f7f\u7528 iproute2 \uff1a sudo ip link set dev eth1 address 08:00:27:75:2a:67 \u67e5\u770bIP\u8def\u7531\u8868\uff1a net-tools\u4e2d\u6709\u4e24\u4e2a\u9009\u62e9\u6765\u663e\u793a\u5185\u6838\u7684IP\u8def\u7531\u8868\uff1aroute\u548cnetstat\u3002\u5728iproute2\u4e2d\uff0c\u4f7f\u7528\u547d\u4ee4ip route\u3002 \u4f7f\u7528 net-tools \uff1a route -n netstat -rn \u4f7f\u7528 iproute2 \uff1a ip route show \u6dfb\u52a0\u548c\u4fee\u6539\u9ed8\u8ba4\u8def\u7531 \u8fd9\u91cc\u7684\u547d\u4ee4\u7528\u6765\u6dfb\u52a0\u6216\u4fee\u6539\u5185\u6838IP\u8def\u7531\u8868\u4e2d\u7684\u9ed8\u8ba4\u8def\u7531\u89c4\u5219\u3002\u8bf7\u6ce8\u610f\u5728net-tools\u4e2d\u53ef\u901a\u8fc7\u6dfb\u52a0\u65b0\u7684\u9ed8\u8ba4\u8def\u7531\u3001\u5220\u9664\u65e7\u7684\u9ed8\u8ba4\u8def\u7531\u6765\u5b9e\u73b0\u4fee\u6539\u9ed8\u8ba4\u8def\u7531\u3002\u5728iproute2\u4f7f\u7528ip route\u547d\u4ee4\u6765\u4ee3\u66ff\u3002 \u4f7f\u7528 net-tools \uff1a sudo route add default gw 192.168.1.2 eth0 sudo route del default gw 192.168.1.1 eth0 \u4f7f\u7528 iproute2 : sudo ip route add default via 192.168.1.2 dev eth0 sudo ip route replace default via 192.168.1.2 dev eth0 \u6dfb\u52a0\u548c\u79fb\u9664\u9759\u6001\u8def\u7531: \u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6dfb\u52a0\u6216\u79fb\u9664\u4e00\u4e2a\u9759\u6001\u8def\u7531\u3002 \u4f7f\u7528 net-tools \uff1a sudo route add -net 172.16.32.0/24 gw 192.168.1.1 dev eth0 sudo route del -net 172.16.32.0/24 \u4f7f\u7528 iproute2 \uff1a sudo ip route add 172.16.32.0/24 via 192.168.1.1 dev eth0 sudo ip route del 172.16.32.0/24 netstat\u4e0ess\u4f7f\u7528\u5bf9\u6bd4 netstat\u7684\u4f7f\u7528\u4e0e\u53c2\u6570 netstat\u53c2\u6570\u548c\u4f7f\u7528\uff1a\u5e38\u7528\u53c2\u6570-anplt -a \u663e\u793a\u6240\u6709\u6d3b\u52a8\u7684\u8fde\u63a5\u4ee5\u53ca\u672c\u673a\u4fa6\u542c\u7684TCP\u3001UDP\u7aef\u53e3 -l \u663e\u793a\u76d1\u542c\u7684server port -n \u76f4\u63a5\u4f7f\u7528IP\u5730\u5740\uff0c\u4e0d\u901a\u8fc7\u57df\u540d\u670d\u52a1\u5668 -p \u6b63\u5728\u4f7f\u7528Socket\u7684\u7a0b\u5e8fPID\u548c\u7a0b\u5e8f\u540d\u79f0 -r \u663e\u793a\u8def\u7531\u8868 -t \u663e\u793aTCP\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5 -u \u663e\u793aUDP\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5 -w \u663e\u793aRAW\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5 ss ss\uff08socket statistics\uff09\u53c2\u6570\u548c\u4f7f\u7528\uff1a\u5e38\u7528\u53c2\u6570\u548cnetstat\u7c7b\u4f3c\uff0c\u5982-anp -a\u663e\u793a\u6240\u6709\u7684sockets -l\u663e\u793a\u6b63\u5728\u76d1\u542c\u7684 -n\u663e\u793a\u6570\u5b57IP\u548c\u7aef\u53e3\uff0c\u4e0d\u901a\u8fc7\u57df\u540d\u670d\u52a1\u5668 -p\u663e\u793a\u4f7f\u7528socket\u7684\u5bf9\u5e94\u7684\u7a0b\u5e8f -t\u53ea\u663e\u793aTCP sockets -u\u53ea\u663e\u793aUDP sockets -4 -6 \u53ea\u663e\u793av4\u6216v6V\u7248\u672c\u7684sockets -s\u6253\u5370\u51fa\u7edf\u8ba1\u4fe1\u606f\u3002\u8fd9\u4e2a\u9009\u9879\u4e0d\u89e3\u6790\u4ece\u5404\u79cd\u6e90\u83b7\u5f97\u7684socket\u3002\u5bf9\u4e8e\u89e3\u6790/proc/net/top\u5927\u91cf\u7684sockets\u8ba1\u6570\u65f6\u5f88\u6709\u6548 -0 \u663e\u793aPACKET sockets -w \u53ea\u663e\u793aRAW sockets -x\u53ea\u663e\u793aUNIX\u57dfsockets -r\u5c1d\u8bd5\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff0c\u5730\u5740/\u7aef\u53e3 \u7edf\u8ba1\u4fe1\u606f\uff1a ss\u8fd8\u53ef\u4ee5\u4f7f\u7528IP\u5730\u5740\u7b5b\u9009\u5982ss src xxxxIP:port\uff0c\u4ee5\u53ca\u4f7f\u7528\u7aef\u53e3\u7b5b\u9009ss dport OP PORT\uff0cOP\u652f\u6301\u7684\u8fd0\u7b97\u7b26\u6709le ge eq ne lt gt\u3002 \u539f\u7406\u5bf9\u6bd4 ss\u6bd4netstat\u5feb\u7684\u4e3b\u8981\u539f\u56e0\u662f\uff0cnetstat\u662f\u904d\u5386/proc\u4e0b\u9762\u6bcf\u4e2aPID\u76ee\u5f55\uff0css\u76f4\u63a5\u8bfb/proc/net\u4e0b\u9762\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u6240\u4ee5ss\u6267\u884c\u7684\u65f6\u5019\u6d88\u8017\u8d44\u6e90\u4ee5\u53ca\u6d88\u8017\u7684\u65f6\u95f4\u90fd\u6bd4netstat\u5c11\u5f88\u591a\u3002 \u5f53\u670d\u52a1\u5668\u7684socket\u8fde\u63a5\u6570\u91cf\u975e\u5e38\u5927\u65f6\uff08\u5982\u4e0a\u4e07\u4e2a\uff09\uff0c\u65e0\u8bba\u662f\u4f7f\u7528netstat\u547d\u4ee4\u8fd8\u662f\u76f4\u63a5cat /proc/net/tcp\u6267\u884c\u901f\u5ea6\u90fd\u4f1a\u5f88\u6162\uff0c\u76f8\u6bd4\u4e4b\u4e0bss\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u65f6\u95f4\u3002ss\u5feb\u7684\u79d8\u8bc0\u5728\u4e8e\uff0c\u5b83\u5229\u7528\u4e86TCP\u534f\u8bae\u6808\u4e2dtcp_diag\uff0c\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u5206\u6790\u7edf\u8ba1\u7684\u6a21\u5757\uff0c\u53ef\u4ee5\u83b7\u5f97Linux\u5185\u6838\u4e2d\u7684\u7b2c\u4e00\u624b\u4fe1\u606f\u3002\u5982\u679c\u7cfb\u7edf\u4e2d\u6ca1\u6709tcp_diag\uff0css\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u53ea\u662f\u6548\u7387\u4f1a\u53d8\u5f97\u7a0d\u5fae\u6162\u4f46\u4ecd\u7136\u6bd4netstat\u8981\u5feb\u3002 \u540c\u6837\u7684\u5927\u91cfsocket\u8fde\u63a5\u60c5\u51b5\u4e0b\uff0cnetstat\u548css\u83b7\u53d6\u540c\u6837\u7684\u7edf\u8ba1\u6570\u636e\u65f6\u7684\u8017\u65f6\uff0css\u660e\u663e\u6bd4netstat\u5c11\u5f88\u591a\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u7b80\u5355\u6d4b\u8bd5\u4e00\u4e0b\u5728\u5c11\u6570socket\u60c5\u51b5\u4e0b\uff08\u57fa\u672c\u65e0\u5dee\u522b\uff09\uff1a time netstat -atn\u4ee5\u53catime ss -atn\u5bf9\u6bd4 netstat\u5c5e\u4e8enet-tools\u5de5\u5177\u96c6\uff0css\u5c5e\u4e8eipoute\u5de5\u5177\u96c6\u3002\u66ff\u6362\u65b9\u6848\u5982\u4e0b\uff1a ARP\u64cd\u4f5c \u67e5\u770bARP \u4f7f\u7528 net-tools : arp -an \u4f7f\u7528 iproute2 : ip neigh \u6dfb\u52a0\u6216\u5220\u9664\u9759\u6001ARP\u9879 \u4f7f\u7528 net-tools \uff1a sudo arp -s 192.168.1.100 00:0c:29:c0:5a:ef sudo arp -d 192.168.1.100 \u4f7f\u7528 iproute2 \uff1a sudo ip neigh add 192.168.1.100 lladdr 00:0c:29:c0:5a:ef dev eth0 sudo ip neigh del 192.168.1.100 dev eth0 \u200b \u6dfb\u52a0\u3001\u5220\u9664\u6216\u67e5\u770b\u591a\u64ad\u5730\u5740 \u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u914d\u7f6e\u6216\u67e5\u770b\u7f51\u7edc\u63a5\u53e3\u4e0a\u7684\u591a\u64ad\u5730\u5740\u3002 \u4f7f\u7528 net-tools : sudo ipmaddr add 33:44:00:00:00:01 dev eth0 sudo ipmaddr del 33:44:00:00:00:01 dev eth0 ipmaddr show dev eth0 netstat -g \u4f7f\u7528 iproute2 \uff1a sudo ip maddr add 33:44:00:00:00:01 dev eth0 sudo ip maddr del 33:44:00:00:00:01 dev eth0$ ip maddr list dev eth0 \u200b","title":"iproute2"},{"location":"Shell/net-toolsVSiproute2/#net-tools-vs-iproute2","text":"\u663e\u793a\u6240\u6709\u5df2\u8fde\u63a5\u7684\u7f51\u7edc\u63a5\u53e3 \u4f7f\u7528 net-tools \uff1a\u4e0b\u9762\u7684\u547d\u4ee4\u663e\u793a\u51fa\u6240\u6709\u53ef\u7528\u7f51\u7edc\u63a5\u53e3\u7684\u5217\u8868\uff08\u65e0\u8bba\u63a5\u53e3\u662f\u5426\u6fc0\u6d3b): ifconfig -a \u4f7f\u7528 iproute2: ip link show \u6fc0\u6d3b\u6216\u505c\u7528\u7f51\u7edc\u63a5\u53e3 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 up # \u542f\u7528eth1 sudo ifconfig eth1 down # \u505c\u7528eth1 \u4f7f\u7528 iproute2 : sudo ip link set up eth1 sudo ip link set down eth1 \u914d\u7f6e\u7f51\u7edc\u63a5\u53e3\u7684\u5730\u5740 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 10.0.0.1/24 \u4f7f\u7528 iproute2 : sudo ip addr add 10.0.0.1/24 dev eth1 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u53ef\u4ee5\u4f7f\u7528iproute2\u7ed9\u540c\u4e00\u4e2a\u63a5\u53e3\u5206\u914d\u591a\u4e2aIP\u5730\u5740\uff0cifconfig\u5219\u65e0\u6cd5\u8fd9\u4e48\u505a\u3002\u4f7f\u7528ifconfig\u7684\u53d8\u901a\u65b9\u6848\u662f\u4f7f\u7528 IP\u522b\u540d \u3002 sudo ip addr add 10.0.0.1/24 broadcast 10.0.0.255 dev eth1 sudo ip addr add 10.0.0.2/24 broadcast 10.0.0.255 dev eth1 sudo ip addr add 10.0.0.3/24 broadcast 10.0.0.255 dev eth1 \u79fb\u9664\u7f51\u7edc\u63a5\u53e3\u7684\u5730\u5740 \u5c31IP\u5730\u5740\u7684\u79fb\u9664\u800c\u8a00\uff0c\u9664\u4e86\u7ed9\u63a5\u53e3\u5206\u914d\u51680\u5730\u5740\u5916\uff0cnet-tools\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u5408\u9002\u7684\u65b9\u6cd5\u6765\u79fb\u9664\u7f51\u7edc\u63a5\u53e3\u7684IPv4\u5730\u5740\u3002\u76f8\u53cd\uff0ciproute2\u5219\u80fd\u5f88\u597d\u5730\u5b8c\u5168\u3002 \u4f7f\u7528 net-tools \uff1a IPv4: sudo ifconfig eth1 0 IPv6: sudo ifconfig eth1 inet6 del 2002:0db5:0:f102::1/64 \u4f7f\u7528 iproute2 \uff1a IPv4: sudo ip addr del 10.0.0.1/24 dev eth1 IPv6: sudo ip -6 addr del 2002:0db5:0:f102::1/64 dev eth1 \u663e\u793a\u7f51\u7edc\u63a5\u53e3\u7684IPv4\u548cIPv6\u5730\u5740 \u540c\u6837\uff0c\u5982\u679c\u63a5\u53e3\u5206\u914d\u4e86\u591a\u4e2aIP\u5730\u5740\uff0ciproute2\u4f1a\u663e\u793a\u51fa\u6240\u6709\u5730\u5740\uff0c\u800cnet-tools\u53ea\u80fd\u663e\u793a\u4e00\u4e2aIP\u5730\u5740\u3002 \u4f7f\u7528 net-tools \uff1a ifconfig eth1 \u4f7f\u7528 iproute2 \uff1a IPv4: ip addr show dev eth1 IPv6: ip -6 addr show dev eth1 \u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914dIPv6\u5730\u5740: net-tools\u548ciproute2\u90fd\u5141\u8bb8\u7528\u6237\u4e3a\u4e00\u4e2a\u63a5\u53e3\u6dfb\u52a0\u591a\u4e2aIPv6\u5730\u5740 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 inet6 add 2002:0db5:0:f102::1/64 sudo ifconfig eth1 inet6 add 2003:0db5:0:f102::1/64 \u4f7f\u7528 iproute2 \uff1a sudo ip -6 addr add 2002:0db5:0:f102::1/64 dev eth1 sudo ip -6 addr add 2003:0db5:0:f102::1/64 dev eth1 \u6539\u53d8\u7f51\u7edc\u63a5\u53e3\u7684MAC\u5730\u5740 \u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef \u7be1\u6539\u7f51\u7edc\u63a5\u53e3\u7684MAC\u5730\u5740 \uff0c\u8bf7\u6ce8\u610f\u5728\u66f4\u6539MAC\u5730\u5740\u524d\uff0c\u9700\u8981\u505c\u7528\u63a5\u53e3\u3002 \u4f7f\u7528 net-tools \uff1a sudo ifconfig eth1 hw ether 08:00:27:75:2a:66 \u4f7f\u7528 iproute2 \uff1a sudo ip link set dev eth1 address 08:00:27:75:2a:67 \u67e5\u770bIP\u8def\u7531\u8868\uff1a net-tools\u4e2d\u6709\u4e24\u4e2a\u9009\u62e9\u6765\u663e\u793a\u5185\u6838\u7684IP\u8def\u7531\u8868\uff1aroute\u548cnetstat\u3002\u5728iproute2\u4e2d\uff0c\u4f7f\u7528\u547d\u4ee4ip route\u3002 \u4f7f\u7528 net-tools \uff1a route -n netstat -rn \u4f7f\u7528 iproute2 \uff1a ip route show \u6dfb\u52a0\u548c\u4fee\u6539\u9ed8\u8ba4\u8def\u7531 \u8fd9\u91cc\u7684\u547d\u4ee4\u7528\u6765\u6dfb\u52a0\u6216\u4fee\u6539\u5185\u6838IP\u8def\u7531\u8868\u4e2d\u7684\u9ed8\u8ba4\u8def\u7531\u89c4\u5219\u3002\u8bf7\u6ce8\u610f\u5728net-tools\u4e2d\u53ef\u901a\u8fc7\u6dfb\u52a0\u65b0\u7684\u9ed8\u8ba4\u8def\u7531\u3001\u5220\u9664\u65e7\u7684\u9ed8\u8ba4\u8def\u7531\u6765\u5b9e\u73b0\u4fee\u6539\u9ed8\u8ba4\u8def\u7531\u3002\u5728iproute2\u4f7f\u7528ip route\u547d\u4ee4\u6765\u4ee3\u66ff\u3002 \u4f7f\u7528 net-tools \uff1a sudo route add default gw 192.168.1.2 eth0 sudo route del default gw 192.168.1.1 eth0 \u4f7f\u7528 iproute2 : sudo ip route add default via 192.168.1.2 dev eth0 sudo ip route replace default via 192.168.1.2 dev eth0 \u6dfb\u52a0\u548c\u79fb\u9664\u9759\u6001\u8def\u7531: \u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6dfb\u52a0\u6216\u79fb\u9664\u4e00\u4e2a\u9759\u6001\u8def\u7531\u3002 \u4f7f\u7528 net-tools \uff1a sudo route add -net 172.16.32.0/24 gw 192.168.1.1 dev eth0 sudo route del -net 172.16.32.0/24 \u4f7f\u7528 iproute2 \uff1a sudo ip route add 172.16.32.0/24 via 192.168.1.1 dev eth0 sudo ip route del 172.16.32.0/24","title":"net-tools VS iproute2"},{"location":"Shell/net-toolsVSiproute2/#netstatss","text":"","title":"netstat\u4e0ess\u4f7f\u7528\u5bf9\u6bd4"},{"location":"Shell/net-toolsVSiproute2/#netstat","text":"netstat\u53c2\u6570\u548c\u4f7f\u7528\uff1a\u5e38\u7528\u53c2\u6570-anplt -a \u663e\u793a\u6240\u6709\u6d3b\u52a8\u7684\u8fde\u63a5\u4ee5\u53ca\u672c\u673a\u4fa6\u542c\u7684TCP\u3001UDP\u7aef\u53e3 -l \u663e\u793a\u76d1\u542c\u7684server port -n \u76f4\u63a5\u4f7f\u7528IP\u5730\u5740\uff0c\u4e0d\u901a\u8fc7\u57df\u540d\u670d\u52a1\u5668 -p \u6b63\u5728\u4f7f\u7528Socket\u7684\u7a0b\u5e8fPID\u548c\u7a0b\u5e8f\u540d\u79f0 -r \u663e\u793a\u8def\u7531\u8868 -t \u663e\u793aTCP\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5 -u \u663e\u793aUDP\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5 -w \u663e\u793aRAW\u4f20\u8f93\u534f\u8bae\u7684\u8fde\u7ebf\u72b6\u51b5","title":"netstat\u7684\u4f7f\u7528\u4e0e\u53c2\u6570"},{"location":"Shell/net-toolsVSiproute2/#ss","text":"ss\uff08socket statistics\uff09\u53c2\u6570\u548c\u4f7f\u7528\uff1a\u5e38\u7528\u53c2\u6570\u548cnetstat\u7c7b\u4f3c\uff0c\u5982-anp -a\u663e\u793a\u6240\u6709\u7684sockets -l\u663e\u793a\u6b63\u5728\u76d1\u542c\u7684 -n\u663e\u793a\u6570\u5b57IP\u548c\u7aef\u53e3\uff0c\u4e0d\u901a\u8fc7\u57df\u540d\u670d\u52a1\u5668 -p\u663e\u793a\u4f7f\u7528socket\u7684\u5bf9\u5e94\u7684\u7a0b\u5e8f -t\u53ea\u663e\u793aTCP sockets -u\u53ea\u663e\u793aUDP sockets -4 -6 \u53ea\u663e\u793av4\u6216v6V\u7248\u672c\u7684sockets -s\u6253\u5370\u51fa\u7edf\u8ba1\u4fe1\u606f\u3002\u8fd9\u4e2a\u9009\u9879\u4e0d\u89e3\u6790\u4ece\u5404\u79cd\u6e90\u83b7\u5f97\u7684socket\u3002\u5bf9\u4e8e\u89e3\u6790/proc/net/top\u5927\u91cf\u7684sockets\u8ba1\u6570\u65f6\u5f88\u6709\u6548 -0 \u663e\u793aPACKET sockets -w \u53ea\u663e\u793aRAW sockets -x\u53ea\u663e\u793aUNIX\u57dfsockets -r\u5c1d\u8bd5\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff0c\u5730\u5740/\u7aef\u53e3 \u7edf\u8ba1\u4fe1\u606f\uff1a ss\u8fd8\u53ef\u4ee5\u4f7f\u7528IP\u5730\u5740\u7b5b\u9009\u5982ss src xxxxIP:port\uff0c\u4ee5\u53ca\u4f7f\u7528\u7aef\u53e3\u7b5b\u9009ss dport OP PORT\uff0cOP\u652f\u6301\u7684\u8fd0\u7b97\u7b26\u6709le ge eq ne lt gt\u3002","title":"ss"},{"location":"Shell/net-toolsVSiproute2/#_1","text":"ss\u6bd4netstat\u5feb\u7684\u4e3b\u8981\u539f\u56e0\u662f\uff0cnetstat\u662f\u904d\u5386/proc\u4e0b\u9762\u6bcf\u4e2aPID\u76ee\u5f55\uff0css\u76f4\u63a5\u8bfb/proc/net\u4e0b\u9762\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u6240\u4ee5ss\u6267\u884c\u7684\u65f6\u5019\u6d88\u8017\u8d44\u6e90\u4ee5\u53ca\u6d88\u8017\u7684\u65f6\u95f4\u90fd\u6bd4netstat\u5c11\u5f88\u591a\u3002 \u5f53\u670d\u52a1\u5668\u7684socket\u8fde\u63a5\u6570\u91cf\u975e\u5e38\u5927\u65f6\uff08\u5982\u4e0a\u4e07\u4e2a\uff09\uff0c\u65e0\u8bba\u662f\u4f7f\u7528netstat\u547d\u4ee4\u8fd8\u662f\u76f4\u63a5cat /proc/net/tcp\u6267\u884c\u901f\u5ea6\u90fd\u4f1a\u5f88\u6162\uff0c\u76f8\u6bd4\u4e4b\u4e0bss\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u65f6\u95f4\u3002ss\u5feb\u7684\u79d8\u8bc0\u5728\u4e8e\uff0c\u5b83\u5229\u7528\u4e86TCP\u534f\u8bae\u6808\u4e2dtcp_diag\uff0c\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u5206\u6790\u7edf\u8ba1\u7684\u6a21\u5757\uff0c\u53ef\u4ee5\u83b7\u5f97Linux\u5185\u6838\u4e2d\u7684\u7b2c\u4e00\u624b\u4fe1\u606f\u3002\u5982\u679c\u7cfb\u7edf\u4e2d\u6ca1\u6709tcp_diag\uff0css\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u53ea\u662f\u6548\u7387\u4f1a\u53d8\u5f97\u7a0d\u5fae\u6162\u4f46\u4ecd\u7136\u6bd4netstat\u8981\u5feb\u3002 \u540c\u6837\u7684\u5927\u91cfsocket\u8fde\u63a5\u60c5\u51b5\u4e0b\uff0cnetstat\u548css\u83b7\u53d6\u540c\u6837\u7684\u7edf\u8ba1\u6570\u636e\u65f6\u7684\u8017\u65f6\uff0css\u660e\u663e\u6bd4netstat\u5c11\u5f88\u591a\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u7b80\u5355\u6d4b\u8bd5\u4e00\u4e0b\u5728\u5c11\u6570socket\u60c5\u51b5\u4e0b\uff08\u57fa\u672c\u65e0\u5dee\u522b\uff09\uff1a time netstat -atn\u4ee5\u53catime ss -atn\u5bf9\u6bd4 netstat\u5c5e\u4e8enet-tools\u5de5\u5177\u96c6\uff0css\u5c5e\u4e8eipoute\u5de5\u5177\u96c6\u3002\u66ff\u6362\u65b9\u6848\u5982\u4e0b\uff1a","title":"\u539f\u7406\u5bf9\u6bd4"},{"location":"Shell/net-toolsVSiproute2/#arp","text":"\u67e5\u770bARP \u4f7f\u7528 net-tools : arp -an \u4f7f\u7528 iproute2 : ip neigh \u6dfb\u52a0\u6216\u5220\u9664\u9759\u6001ARP\u9879 \u4f7f\u7528 net-tools \uff1a sudo arp -s 192.168.1.100 00:0c:29:c0:5a:ef sudo arp -d 192.168.1.100 \u4f7f\u7528 iproute2 \uff1a sudo ip neigh add 192.168.1.100 lladdr 00:0c:29:c0:5a:ef dev eth0 sudo ip neigh del 192.168.1.100 dev eth0 \u200b","title":"ARP\u64cd\u4f5c"},{"location":"Shell/net-toolsVSiproute2/#_2","text":"\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u914d\u7f6e\u6216\u67e5\u770b\u7f51\u7edc\u63a5\u53e3\u4e0a\u7684\u591a\u64ad\u5730\u5740\u3002 \u4f7f\u7528 net-tools : sudo ipmaddr add 33:44:00:00:00:01 dev eth0 sudo ipmaddr del 33:44:00:00:00:01 dev eth0 ipmaddr show dev eth0 netstat -g \u4f7f\u7528 iproute2 \uff1a sudo ip maddr add 33:44:00:00:00:01 dev eth0 sudo ip maddr del 33:44:00:00:00:01 dev eth0$ ip maddr list dev eth0 \u200b","title":"\u6dfb\u52a0\u3001\u5220\u9664\u6216\u67e5\u770b\u591a\u64ad\u5730\u5740"},{"location":"kernel/LinuxProcess/","text":"1 \u8fdb\u7a0b\u56db\u8981\u7d20 \u53ef\u6267\u884c\u7a0b\u5e8f \u8fdb\u7a0b\u4e13\u7528\u7684\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808 task_struct\u7ed3\u6784 \u72ec\u7acb\u7684\u7528\u6237\u7a7a\u95f4\uff1a mm_struct \u7ed3\u6784 2 \u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e0ecurrent \u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2atask_struct\u7ed3\u6784\u4e0e\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff0c\u8fd9\u4e8c\u8005\u7f3a\u4e00\u4e0d\u53ef\uff0c\u5e76\u4e14\u5177\u6709\u7d27\u5bc6\u7684\u8054\u7cfb\uff0c\u6240\u4ee5\u7269\u7406\u5b58\u50a8\u7a7a\u95f4\u4e5f\u8fde\u5728\u4e00\u8d77\u3002\u5185\u6838\u5728\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u4e00\u4e2atask_struct\u7ed3\u6784\u5206\u914d\u7a7a\u95f4\u65f6\uff0c\u5b9e\u9645\u4e0a\u5206\u914d\u4e86\u4e24\u4e2a\u8fde\u7eed\u7684\u7269\u7406\u9875\u9762\uff08\u51718192\u5b57\u8282\uff09\u3002\u8fd9\u4e24\u4e2a\u9875\u9762\u7684\u5e95\u90e8\u7528\u4f5c\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\uff0c\u7ed3\u6784\u4e4b\u4e0a\u7684\u7a7a\u95f4\u5c31\u7528\u4f5c\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff0c\u5982\u4e0b\u56fe\uff1a \u6ce8\u610f\uff1a\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e0d\u50cf\u7528\u6237\u7a7a\u95f4\u5806\u6808\u90a3\u6837\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u6269\u5c55\uff0c\u800c\u662f\u9759\u6001\u5730\u786e\u5b9a\u4e86\u7684\u3002\u6240\u4ee5\uff0c\u5728\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u3001\u5185\u6838\u8f6f\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u4ee5\u53ca\u5176\u4ed6\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u4e2d\uff0c\u4e0d\u80fd\u8ba9\u51fd\u6570\u5d4c\u5957\u592a\u6df1\uff0c\u4e5f\u4e0d\u80fd\u4f7f\u7528\u592a\u591a\u3001\u592a\u5927\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u9632\u6b62\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u88ab\u8017\u5c3d\u3002 task_struct\u4e0e\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u7684\u8fd9\u79cd\u7279\u6b8a\u5b89\u6392\uff0c\u51b3\u5b9a\u4e86\u5185\u6838\u4e2d\u4e00\u4e9b\u5b8f\u64cd\u4f5c\u7684\u5b9a\u4e49\u3002 \u9996\u5148\u662f\u4e3a\u8fdb\u7a0b\u5206\u914d\u548c\u91ca\u653etask_struct\u7ed3\u6784\u7684\u64cd\u4f5c\uff1a include/asm/processor.h #define THREAD_SIZE (2*PAGE_SIZE) #define alloc_task_struct() ((struct task_struct *) _get_free_pages(GFP_KERNEL,1)) #define free_task_struct(p) free_pages((unsigned long) (p), 1) THREAD_SIZE\u88ab\u5b9a\u4e49\u6210\u4e24\u4e2apage\u7684\u5927\u5c0f\u3002 alloc_task_struct()\u5206\u914d\u4e86\u4e24\u4e2a\u8fde\u7eed\u9875\u9762\uff0c\u5e76\u5728\u4e24\u4e2a\u9875\u9762\u7684\u8d77\u59cb\u5730\u5740\u5904\uff0c\u5b89\u653etask_struct\u7ed3\u6784\u3002\u6ce8\u610f\uff0c_get_free_pages\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u53c2\u65701\u8868\u793a\u5206\u914d2^1\u5373\u4e24\u4e2a\u9875\u9762\u3002 \u5176\u6b21\uff0c\u5f53\u8fdb\u7a0b\u5728\u7cfb\u7edf\u7a7a\u95f4\u8fd0\u884c\u65f6\uff0c\u5e38\u5e38\u9700\u8981\u8bbf\u95ee\u5f53\u524d\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\uff0c\u4e3a\u6b64\u76ee\u7684\uff0c\u5185\u6838\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b8fcurrent\u3002\u5b9a\u4e49\u5982\u4e0b\uff1a include/asm/current.h static inline struct task_struct * get_current(void) { struct task_struct *current; __asm__( andl %%esp,%0; : =r (current) : 0 (~8191UL)); return current; } #define current get_current() current\u6700\u7ec8\u8c03\u7528get_current()\u51fd\u6570\uff0c\u540e\u8005\u4f7f\u7528\u4e86\u5d4c\u5165\u5f0f\u6c47\u7f16\u4ee3\u7801\uff0c\u76f8\u4fe1\u5927\u5bb6\u73b0\u5728\u8bfb\u6765\u5df2\u7ecf\u4e0d\u662f\u4ec0\u4e48\u96be\u4e8b\u4e86\u3002\u8fd9\u91cc\u7684\u8f93\u5165\u90e8\u662f\u4e00\u4e2a\u7acb\u5373\u6570\uff08~8191UL\uff09\u53738191\u53d6\u53cd\uff08\u53d6\u53cd\u4e4b\u540e\u4e3a0xfffffe00\uff09\uff0c\u8f93\u51fa\u90e8\u4e3a\u5c40\u90e8\u53d8\u91cfcurrent\uff0c\u8f93\u5165\u90e8\u4e0e\u8f93\u51fa\u90e8\u5171\u7528\u540c\u4e00\u4e2a\u5bc4\u5b58\u5668\u3002\u6307\u4ee4\u90e8\u4e2d\uff0c\u5c06\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u6808\u9876\u6307\u9488esp\u4e0e0xfffffe000\u4f4d\u4e0e\u3002\u56e0\u4e3atask_struct\u7684\u5730\u5740\u4e0e8K\uff08\u4e24\u4e2a\u9875\u9762\u7684\u5927\u5c0f\uff09\u7684\u8fb9\u754c\u5bf9\u9f50\uff0c\u800c\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u6808\u9876\u6307\u9488esp\u57288K\u7a7a\u95f4\u4e4b\u5185\uff0c0xfffffe00\u4e3a8K\u51cf1\u518d\u6c42\u53cd\uff0c\u7528\u4f5c\u63a9\u7801\uff0cesp\u4e0e\u8be5\u63a9\u7801\u4f4d\u4e0e\u5373\u53ef\u5f97\u5230esp\u6240\u57288K\u7a7a\u95f4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u5373task_struct\u7ed3\u6784\u7684\u5730\u5740\u3002 \u4e0e\u6b64\u7c7b\u4f3c\uff0c\u5728\u8fdb\u5165\u4e2d\u65ad\u548c\u7cfb\u7edf\u8c03\u7528\u65f6\u6240\u5f15\u7528\u7684\u5b8f\u64cd\u4f5cGET_CURRENT\uff0c\u5728 \u4e2d\u5b9a\u4e49\uff1a #define GET_CURRENT \\ movl %esp, %ebx\\n\\t \\ andl $-8192, %ebx\\n\\t 3 task_struct task_struct\u7ed3\u6784\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a struct task_struct { volatile long state; unsigned long flags; int sigpending; mm_segment_t addr_limit; struct exec_domain *exec_domain; volatile long need_resched; unsigned long ptrace; int lock_depth; long counter; long nice; unsigned long policy; struct mm_struct *mm; int has_cpu, processor; unsigned long cpus_allowed; struct list_head run_list; unsigned long sleep_time; struct task_struct *next_task, *prev_task; struct mm_struct *active_mm; struct linux_binfmt *binfmt; int exit_code, exit_signal; int pdeath_signal; unsigned long personality; int dumpable:1; int did_exec:1; pid_t pid; pid_t pgrp; pid_t tty_old_pgrp; pid_t session; pid_t tgid; int leader; struct task_struct *p_opptr, *p_pptr, *p_cptr, *p_ysptr, *p_osptr; struct list_head thread_group; struct task_struct *pidhash_next; struct task_struct **pidhash_pprev; wait_queue_head_t wait_chldexit; struct semaphore *vfork_sem; unsigned long rt_priority; unsigned long it_real_value, it_prof_value, it_virt_value; unsigned long it_real_incr, it_prof_incr, it_virt_incr; struct timer_list real_timer; struct tms times; unsigned long start_time; long per_cpu_utime[NR_CPUS], per_cpu_stime[NR_CPUS]; unsigned long min_flt, maj_flt, nswap, cmin_flt, cmaj_flt, cnswap; int swappable:1; uid_t uid,euid,suid,fsuid; gid_t gid,egid,sgid,fsgid; int ngroups; gid_t groups[NGROUPS]; kernel_cap_t cap_effective, cap_inheritable, cap_permitted; int keep_capabilities:1; struct user_struct *user; struct rlimit rlim[RLIM_NLIMITS]; unsigned short used_math; char comm[16]; int link_count; struct tty_struct *tty; unsigned int locks; struct sem_undo *semundo; struct sem_queue *semsleeping; struct thread_struct thread; struct fs_struct *fs; struct files_struct *files; spinlock_t sigmask_lock; struct signal_struct *sig; sigset_t blocked; struct sigpending pending; unsigned long sas_ss_sp; size_t sas_ss_size; int (*notifier)(void *priv); void *notifier_data; sigset_t *notifier_mask; u32 parent_exec_id; u32 self_exec_id; spinlock_t alloc_lock; }; state: \u8868\u793a\u8fdb\u7a0b\u7684\u5f53\u524d\u8fd0\u884c\u72b6\u6001\uff0c\u8fdb\u7a0b\u7684\u6240\u6709\u53ef\u80fd\u72b6\u6001\u5b9a\u4e49\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff1a #define TASK_RUNNING 0 #define TASK_INTERRUPTIBLE 1 #define TASK_UNINTERRUPTIBLE 2 #define TASK_ZOMBIE 4 #define TASK_STOPPED 8 TASK_RUNNING \u72b6\u6001\u5e76\u4e0d\u662f\u8868\u793a\u4e00\u4e2a\u8fdb\u7a0b\u6b63\u5728\u8fd0\u884c\uff0c\u6216\u8005\u662f\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u662f\u201c\u5f53\u524d\u8fdb\u7a0b\u201d\uff0c\u800c\u662f\u8868\u793a\u8fd9\u4e2a\u8fdb\u7a0b\u53ef\u88ab\u8c03\u5ea6\u6267\u884c\u800c\u6210\u4e3a\u5f53\u524d\u8fdb\u7a0b\uff0c\u662f\u8fdb\u7a0b\u8868\u8fbe\u4e86\u5e0c\u671b\u88ab\u8c03\u5ea6\u8fd0\u884c\u7684\u610f\u613f\u3002\u5f53\u8fdb\u7a0b\u5904\u4e8e\u6b64\u72b6\u6001\u65f6\uff0c\u8868\u793a\u8fdb\u7a0b\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\u6216\u8005\u53ef\u4ee5\u88ab\u6267\u884c\u4e86\uff0c\u5185\u6838\u4f1a\u5c06\u8be5\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\u901a\u8fc7\u5176\u961f\u5217\u5934run_list\u94fe\u5165\u4e00\u4e2a\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\uff0c\u81f3\u4e8e\u6700\u7ec8\u8c03\u5ea6\u8fd0\u884c\u8c01\uff0c\u5185\u6838\u4f1a\u6839\u636e\u8c03\u5ea6\u7b56\u7565\u4ece\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\u4e2d\u6311\u9009\u4e00\u4e2a\u8fdb\u7a0b\u6765\u8c03\u5ea6\u8fd0\u884c\u3002 TASK_INTERRUPTIBLE \u548c TASK_UNINTERRUPTIBLE \u90fd\u8868\u793a\u8fdb\u7a0b\u5904\u4e8e\u7761\u7720\u72b6\u6001\u3002\u4e0d\u8fc7\u524d\u8005\u8868\u793a\u6d45\u5ea6\u7761\u7720\uff0c\u53ef\u4ee5\u88ab\u4fe1\u53f7\uff08\u4e5f\u6210\u4e3a\u8f6f\u4e2d\u65ad\uff09\u5524\u9192\uff1b\u540e\u8005\u8868\u793a\u6df1\u5ea6\u7761\u7720\u800c\u4e0d\u53d7\u4fe1\u53f7\u7684\u6253\u6270\u3002\u8fd9\u91cc\u7684INTERRUPTIBLE\u6216UNINTERRUPTIBLE\u4e0e\u201c\u4e2d\u65ad\u201d\u6beb\u65e0\u5173\u7cfb\uff0c\u800c\u53ea\u662f\u8bf4\u7761\u7720\u80fd\u5426\u56e0\u5176\u4ed6\u65f6\u95f4\u800c\u4e2d\u65ad\u3002\u5185\u6838\u4e2d\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u51fd\u6570\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u5165\u4e0d\u540c\u7a0b\u5ea6\u7684\u7761\u7720\u6216\u5c06\u8fdb\u7a0b\u4ece\u7761\u7720\u4e2d\u5524\u9192\u3002\u5177\u4f53\u6765\u8bf4\uff0csleep_on\u548cwake_up\u7528\u4e8e\u6df1\u5ea6\u7761\u7720\uff1b\u800cinterruptible_sleep_on\u548cinterruptible_wake_up\u5219\u7528\u4e8e\u6d45\u5ea6\u7761\u7720\u3002 TASK_ZOMBIE \u72b6\u6001\u8868\u793a\u8fdb\u7a0b\u5df2\u7ecf\u53bb\u4e16\uff08exit\uff09\u800c\u6237\u53e3\uff08task_struct\uff09\u5c1a\u672a\u6ce8\u9500\u3002 TASK_STOPPED \u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002\u8fdb\u7a0b\u63a5\u6536\u5230\u4e00\u4e2aSIGSTOP\u4fe1\u53f7\u540e\u5c31\u5c06\u8fd0\u884c\u72b6\u6001\u6539\u6210TASK_STOPPED\u800c\u8fdb\u5165\u6302\u8d77\u72b6\u6001\uff0c\u7136\u540e\u5728\u63a5\u6536\u5230\u4e00\u4e2aSIGCONT\u4fe1\u53f7\u65f6\u53c8\u6062\u590d\u7ee7\u7eed\u8fd0\u884c\u3002 flag\uff1a \u4e0e\u8fdb\u7a0b\u7ba1\u7406\u6709\u5173\u7684\u4fe1\u606f\uff0c\u5bf9\u5e94\u7684\u6807\u5fd7\u4f4d\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5b9a\u4e49\uff1a /* * Per process flags */ #define PF_ALIGNWARN 0x00000001 /* Print alignment warning msgs */ /* Not implemented yet, only for 486*/ #define PF_STARTING 0x00000002 /* being created */ #define PF_EXITING 0x00000004 /* getting shut down */ #define PF_FORKNOEXEC 0x00000040 /* forked but didn't exec */ #define PF_SUPERPRIV 0x00000100 /* used super-user privileges */ #define PF_DUMPCORE 0x00000200 /* dumped core */ #define PF_SIGNALED 0x00000400 /* killed by a signal */ #define PF_MEMALLOC 0x00000800 /* Allocating memory */ #define PF_VFORK 0x00001000 /* Wake up parent in mm_release */ #define PF_USEDFPU 0x00100000 /* task used FPU this quantum (SMP) */ PF_MEMALLOC \u6211\u4eec\u5df2\u7ecf\u5728\u5185\u5b58\u9875\u9762\u5206\u914d\u65f6\u89c1\u8fc7\u4e86\uff0c\u5176\u4ed6\u7684\u6807\u5fd7\u4f4d\u8bf7\u53c2\u8003\u6ce8\u91ca\u3002 sigpending\uff1a \u8868\u793a\u8fdb\u7a0b\u6536\u5230\u4e86\u4fe1\u53f7\u4f46\u5c1a\u672a\u5904\u7406\uff0c\u4e0e\u8fd9\u4e2a\u6807\u5fd7\u76f8\u8054\u7cfb\u7684\u662f\u4e0e\u4fe1\u53f7\u961f\u5217\u6709\u5173\u7684sigqueue\u3001sigqueue_tail\u3001sig\u7b49\u6307\u9488\u4ee5\u53casigmask_lock\u3001signal\u3001blocked\u7b49\u6210\u5206\u3002 counter\uff1a \u4e0e\u8c03\u5ea6\u6709\u5173\u3002 need_resched\uff1a \u4e0e\u8c03\u5ea6\u6709\u5173\uff0c\u8868\u793aCPU\u4ece\u7cfb\u7edf\u7a7a\u95f4\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u524d\u5915\u8981\u8fdb\u884c\u4e00\u6b21\u8c03\u5ea6\u3002 \u4e0a\u8ff0\u5b57\u6bb5\u53cd\u5e94\u4e86\u8fdb\u7a0b\u7684\u52a8\u6001\u7279\u5f81\uff0c\u4e0b\u9762\u8fd9\u4e9b\u5b57\u6bb5\u5219\u53cd\u5e94\u4e86\u8fdb\u7a0b\u7684\u9759\u6001\u7279\u5f81\u3002 addr_limit\uff1a \u865a\u5b58\u5730\u5740\u7684\u7a7a\u95f4\u4e0a\u9650\u3002\u5bf9\u8fdb\u7a0b\u800c\u8a00\u5c31\u662f\u5176\u7528\u6237\u7a7a\u95f4\u7684\u4e0a\u9650\uff0c\u6240\u4ee5\u4e3a0xbfffffff\uff1b\u5bf9\u5185\u6838\u8fdb\u7a0b\u800c\u8a00\u5219\u662f\u7cfb\u7edf\u7a7a\u95f4\u7684\u4e0a\u9650\u4e3a0xffffffff\u3002 personality\uff1a \u770b\u8fc7APUE\u7684\u90fd\u77e5\u9053\uff0cUnix\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u7248\u672c\u548c\u53d8\u79cd\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e5f\u5c31\u6709\u5404\u81ea\u7684\u9002\u7528\u8303\u56f4\u3002\u6bd4\u5982Unix SVR4\u7684\u5e94\u7528\u7a0b\u5e8f\u672a\u5fc5\u4e0e\u4e3alinux\u5f00\u53d1\u7684\u5176\u4ed6\u8f6f\u4ef6\u5b8c\u5168\u517c\u5bb9\u3002\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u5176\u4e0e\u751f\u4ff1\u6765\u7684\u201c\u4e2a\u6027\u201c\u3002\u6587\u4ef6 \u5b9a\u4e49\u4e86\u76f8\u5173\u7684\u5e38\u6570\u3002 exec_domain: \u9664\u4e86personality\u5916\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7248\u672c\u95f4\u7684\u5dee\u5f02\uff0c\u4ece\u800c\u5f62\u6210\u4e86\u4e0d\u540c\u7684\u201c\u6267\u884c\u57df\u201d\u3002\u8fd9\u4e2a\u6307\u9488\u5c31\u6307\u5411\u63cf\u8ff0\u672c\u8fdb\u7a0b\u6240\u5c5e\u6267\u884c\u57df\u7684\u6570\u636e\u7ed3\u6784\u3002 binfmt\uff1a \u5e94\u7528\u7a0b\u5e8f\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u5982a.out\u3001elf\u7b49\u3002 exit_code\uff1a \u9000\u51fa\u7801\uff0c\u4e0e\u4e4b\u76f8\u5173\u7684exit_signal\u3001pdeath_signal\u8be6\u89c1\u300a\u7cfb\u7edf\u8c03\u7528exit\u4e0ewait4\u300b\u3002 pid\uff1a \u8fdb\u7a0b\u53f7\u3002 pgrp\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u9664\u4e86\u6709\u4e00\u4e2a\u8fdb\u7a0b\u53f7\u4ee5\u5916\uff0c\u8fd8\u5c5e\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u7ec4\u3002pgrp\u6307\u5411\u8fdb\u7a0b\u6240\u5c5e\u7684\u8fdb\u7a0b\u7ec4ID\u3002 session\uff1a \u4f1a\u8bdd\u3002\u5f53\u4e00\u4e2a\u7528\u6237\u767b\u5f55\u5230\u7cfb\u7edf\u540e\uff0c\u5c31\u5f00\u59cb\u4e86\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u4f1a\u8bdd\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u7ec4\u7684\u96c6\u5408\u3002 leader\uff1a \u6bcf\u4e2a\u4f1a\u8bdd\u90fd\u4e00\u4e2a\u4f1a\u8bdd\u9996\u8fdb\u7a0b\uff08session leader\uff09\u3002 priority\u3001rt_priority\uff1a \u4f18\u5148\u7ea7\u522b\u4ee5\u53ca\u201c\u5b9e\u65f6\u201d\u4f18\u5148\u7ea7\u522b\u3002 policy\uff1a \u672c\u8fdb\u7a0b\u7684\u8c03\u5ea6\u7b56\u7565\u3002 parent_exec_id\u3001self_exec_id\uff1a \u4e0e\u4f1a\u8bdd\uff08session\uff09\u6709\u5173\u3002 uid\u3001euid\u3001suid\u3001fsuid\u3001gid\u3001egid\u3001sgid\u3001fsgid\uff1a \u8fdb\u7a0b\u6240\u5c5e\u7684\u7528\u6237ID\u3001\u6709\u6548\u7528\u6237ID\u3001\u4fdd\u5b58\u7684\u8bbe\u7f6e\u7528\u6237ID\u3001\u7528\u4e8e\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u68c0\u67e5\u7684\u7528\u6237ID\uff0c\u7ec4ID\u3001\u6709\u6548\u7ec4ID\u3001\u4fdd\u5b58\u7684\u8bbe\u7f6e\u7ec4ID\uff0c\u7528\u4e8e\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u68c0\u67e5\u7684\u7ec4ID\u3002\u53c2\u8003\u540e\u9762\u7684\u5185\u5bb9\uff08\u4e5f\u53ef\u4ee5\u53c2\u8003APUE\u7b2c\u4e8c\u7248\u7684\u7b2c8\u7ae0\uff09\u3002 cap_effective\u3001cap_inheritable\u3001cap_permitted\uff1a \u4e00\u822c\u8fdb\u7a0b\u90fd\u4e0d\u80fd\u4e3a\u6240\u6b32\u4e3a\uff0c\u800c\u662f\u5404\u81ea\u88ab\u8d4b\u4e88\u4e86\u5404\u79cd\u4e0d\u540c\u7684\u6743\u9650\u3002\u5c06\u6743\u5229\u7ec6\u5206\uff0c\u800c\u4e0d\u662f\u7b3c\u7edf\u7684\u53d6\u51b3\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u662f\u5426\u662f\u201c\u7279\u6743\u8fdb\u7a0b\u201d\uff0c\u8fd9\u4e5f\u662flinux\u5b89\u5168\u673a\u5236\u7684\u57fa\u7840\u4e4b\u4e00\uff08\u53e6\u4e00\u4e2a\u662f\u6587\u4ef6\u8bbf\u95ee\u6743\u9650\u7684\u8bbe\u7f6e\uff09\u3002 \u5b9a\u4e49\u4e86\u8bb8\u591a\u8fd9\u6837\u7684\u6743\u9650\u3002\u540c\u65f6\u5185\u6838\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5185\u8054\u51fd\u6570capable\uff0c\u7528\u6765\u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u5177\u6709\u67d0\u79cd\u6743\u9650\u3002 user\uff1a \u6307\u5411\u4e00\u4e2auser_struct\u7ed3\u6784\uff0c\u8be5\u6570\u636e\u7ed3\u6784\u4ee3\u8868\u7740\u8fdb\u7a0b\u6240\u5c5e\u7684\u7528\u6237\u3002 rlim\uff1a \u8fd9\u662f\u4e00\u4e2a\u7ed3\u6784\u6570\u7ec4\uff0c\u8868\u660e\u8fdb\u7a0b\u5bf9\u5404\u79cd\u8d44\u6e90\u7684\u4f7f\u7528\u6570\u91cf\u6240\u53d7\u7684\u9650\u5236\u3002\u6211\u4eec\u5728\u7b2c\u4e8c\u7ae0\u7528\u6237\u5806\u6808\u7684\u6269\u5c55\u4e2d\u5df2\u7ecf\u770b\u5230\u4e86\u5bf9\u8fd9\u79cd\u9650\u5236\u7684\u5e94\u7528\uff08\u9700\u8981\u83b7\u53d6\u7528\u6237\u7a7a\u95f4\u5806\u6808\u5927\u5c0f\u7684\u9650\u5236\u7b49\uff09\u3002\u6570\u636e\u7ed3\u6784rlimit\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a struct rlimit { unsigned long rlim_cur; unsigned long rlim_max; }; rlim_cur \u4e3a\u201csoft limit\u201d\uff0c\u662f\u5f53\u524d\u7684\u9650\u5236\uff0c rlim_max \u4e3a\u201chard limit\u201d\uff0c\u8868\u793a\u6700\u5927\u9650\u5236\u3002rlim_cur\u7684\u53d6\u503c\u4e0d\u80fd\u6bd4rlim_max\u5927\u3002 4 \u4e0e\u8fdb\u7a0b\u76f8\u5173\u7684\u201c\u7ec4\u7ec7\u201d \u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u4e0d\u662f\u5b64\u7acb\u7684\u5b58\u5728\u4e8e\u7cfb\u7edf\u4e2d\uff0c\u800c\u603b\u662f\u6839\u636e\u4e0d\u540c\u7684\u76ee\u7684\u3001\u5173\u7cfb\u548c\u9700\u8981\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u76f8\u8054\u7cfb\u3002\u4ece\u5185\u6838\u7684\u89d2\u5ea6\u770b\uff0c\u5219\u662f\u8981\u6839\u636e\u4e0d\u540c\u7684\u76ee\u7684\u548c\u6027\u8d28\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u7eb3\u5165\u5404\u79cd\u7ec4\u7ec7\u3002 \u7b2c\u4e00\u4e2a\u7ec4\u7ec7\u5c31\u662f\u8fdb\u7a0b\u7684\u201c\u5bb6\u8c31\u201d \u3002\u8fd9\u662f\u4e00\u79cd\u6811\u5f62\u7ec4\u7ec7\uff0c\u901a\u8fc7p_opptr\u3001p_pptr\u3001p_cptr\u3001p_ysptr\u548cp_osptr\u6784\u6210\u3002\u5176\u4e2dp_opptr\uff08original parent\uff0c\u751f\u7236\uff09\u4e0ep_pptr\uff08\u517b\u7236\uff09\u6307\u5411\u7236\u8fdb\u7a0b\uff0cp_cptr\uff08c\u4ee3\u8868child\uff09\u6307\u5411\u6700\u201c\u5e74\u8f7b\u201d\uff08\u6700\u8fd1\u521b\u5efa\u7684\uff09\u7684\u5b50\u8fdb\u7a0b\uff0c\u800cp_ysptr\uff08youngest sibling\uff09\u548cp_osptr\uff08oldest sibling\uff09\u5219\u5206\u522b\u6307\u5411\u5176\u201c\u5f1f\u5f1f\u201d\u548c\u201c\u54e5\u54e5\u201d\u3002\u8fd9\u79cd\u201c\u5bb6\u8c31\u201d\u7ec4\u7ec7\u793a\u610f\u5982\u4e0b\uff1a \u6839\u636ep_cptr\u987a\u85e4\u6478\u74dc\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u627e\u5230\u5b83\u6240\u6709\u7684\u5b50\u8fdb\u7a0b\u3002\u4f46\u662f\u60f3\u8981\u6839\u636e\u8fdb\u7a0b\u53f7pid\u627e\u5230\u5bf9\u5e94\u7684task_struct\u8fd8\u662f\u5f88\u96be\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u7b2c\u4e8c\u4e2a\u7ec4\u7ec7\u3002 \u7b2c\u4e8c\u4e2a\u7ec4\u7ec7\u5c31\u662f\u6309\u7167\u8fdb\u7a0b\u53f7pid\u6784\u6210\u7684\u54c8\u5e0c\u961f\u5217\u3002 \u7ed9\u5b9apid\uff0c\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u5c31\u53ef\u4ee5\u5f97\u5230\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\u5728\u54c8\u5e0c\u961f\u5217\u4e2d\u7684\u4e0b\u6807\uff0c\u8fdb\u800c\u627e\u5230\u8fdb\u7a0b\u5bf9\u5e94\u7684task_struct\u7ed3\u6784\u3002\u54c8\u5e0c\u8868pidhash\u5b9a\u4e49\u5728 \u4e2d\uff1a struct task_struct *pidhash[PIDHASH_SZ]; \u800cPIDHASH_SZ\u5b9a\u4e49\u5728 \u4e2d\uff1a #define PIDHASH_SZ (4096 2) \u53ef\u89c1\uff0c\u54c8\u5e0c\u8868pidhash\u5171\u67091024\u4e2a\u5143\u7d20\uff0c\u7cfb\u7edf\u540c\u65f6\u5b58\u5728\u7684\u8fdb\u7a0b\u6570\u76ee\u4e0d\u80fd\u8d85\u8fc71024\u4e2a\u3002\u540c\u65f6\uff0c\u7531\u4e8e\u4e00\u4e2a\u6307\u9488\u53604\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u6574\u4e2a\u54c8\u5e0c\u8868\u5360\u75284K\u5373\u4e00\u4e2a\u9875\u9762\u7684\u5927\u5c0f\u3002 \u5f53\u5185\u6838\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u65f6\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u7528\u5230\u7b2c\u4e09\u4e2a\u7ec4\u7ec7\u3002 \u7b2c\u4e09\u4e2a\u7ec4\u7ec7\u662f\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u94fe\u8d77\u6765\u7684\u7ebf\u6027\u961f\u5217\u3002 \u7cfb\u7edf\u521b\u5efa\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u4e3ainit_task\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u662f\u6240\u6709\u8fdb\u7a0b\u7684\u603b\u6839\uff0c\u6240\u4ee5\u5b83\u5c31\u662f\u8fd9\u4e2a\u7ebf\u6027\u961f\u5217\u7684\u8d77\u70b9\u3002\u540e\u7eed\u6bcf\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5c31\u901a\u8fc7\u5176task_struct\u7ed3\u6784\u4e2d\u7684next_task\u548cprev_task\u4e24\u4e2a\u6307\u9488\u94fe\u5165\u8fd9\u4e2a\u961f\u5217\u3002 \u6bcf\u4e2a\u8fdb\u7a0b\u5fc5\u7136\u540c\u65f6\u8eab\u5904\u8fd9\u4e09\u4e2a\u7ec4\u7ec7\u4e4b\u4e2d\uff0c\u76f4\u5230\u8fdb\u7a0b\u6d88\u4ea1\u65f6\u624d\u4ece\u8fd9\u4e09\u4e2a\u961f\u5217\u4e2d\u6458\u9664\u3002 \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u968f\u65f6\u53ef\u80fd\u94fe\u5165\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\u4e2d\u63a5\u53d7\u7cfb\u7edf\u8c03\u5ea6\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ea\u6709\u5728\u201c\u53ef\u6267\u884c\u961f\u5217\u201c\u4e2d\u624d\u6709\u53ef\u80fd\u53d7\u5230\u8c03\u5ea6\u800c\u6295\u5165\u8fd0\u884c\u3002\u8fd9\u5c31\u662f\u7b2c\u56db\u4e2a\u7ec4\u7ec7\u3002\u8fdb\u7a0b\u901a\u8fc7task_struct\u7ed3\u6784\u4e2drun_list\u94fe\u5165\u53ef\u6267\u884c\u961f\u5217\u3002","title":"\u8fdb\u7a0b\u7684\u57fa\u672c\u6982\u5ff5"},{"location":"kernel/LinuxProcess/#1","text":"\u53ef\u6267\u884c\u7a0b\u5e8f \u8fdb\u7a0b\u4e13\u7528\u7684\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808 task_struct\u7ed3\u6784 \u72ec\u7acb\u7684\u7528\u6237\u7a7a\u95f4\uff1a mm_struct \u7ed3\u6784","title":"1 \u8fdb\u7a0b\u56db\u8981\u7d20"},{"location":"kernel/LinuxProcess/#2-current","text":"\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2atask_struct\u7ed3\u6784\u4e0e\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff0c\u8fd9\u4e8c\u8005\u7f3a\u4e00\u4e0d\u53ef\uff0c\u5e76\u4e14\u5177\u6709\u7d27\u5bc6\u7684\u8054\u7cfb\uff0c\u6240\u4ee5\u7269\u7406\u5b58\u50a8\u7a7a\u95f4\u4e5f\u8fde\u5728\u4e00\u8d77\u3002\u5185\u6838\u5728\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u4e00\u4e2atask_struct\u7ed3\u6784\u5206\u914d\u7a7a\u95f4\u65f6\uff0c\u5b9e\u9645\u4e0a\u5206\u914d\u4e86\u4e24\u4e2a\u8fde\u7eed\u7684\u7269\u7406\u9875\u9762\uff08\u51718192\u5b57\u8282\uff09\u3002\u8fd9\u4e24\u4e2a\u9875\u9762\u7684\u5e95\u90e8\u7528\u4f5c\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\uff0c\u7ed3\u6784\u4e4b\u4e0a\u7684\u7a7a\u95f4\u5c31\u7528\u4f5c\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff0c\u5982\u4e0b\u56fe\uff1a \u6ce8\u610f\uff1a\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e0d\u50cf\u7528\u6237\u7a7a\u95f4\u5806\u6808\u90a3\u6837\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u6269\u5c55\uff0c\u800c\u662f\u9759\u6001\u5730\u786e\u5b9a\u4e86\u7684\u3002\u6240\u4ee5\uff0c\u5728\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u3001\u5185\u6838\u8f6f\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u4ee5\u53ca\u5176\u4ed6\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u4e2d\uff0c\u4e0d\u80fd\u8ba9\u51fd\u6570\u5d4c\u5957\u592a\u6df1\uff0c\u4e5f\u4e0d\u80fd\u4f7f\u7528\u592a\u591a\u3001\u592a\u5927\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u9632\u6b62\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u88ab\u8017\u5c3d\u3002 task_struct\u4e0e\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u7684\u8fd9\u79cd\u7279\u6b8a\u5b89\u6392\uff0c\u51b3\u5b9a\u4e86\u5185\u6838\u4e2d\u4e00\u4e9b\u5b8f\u64cd\u4f5c\u7684\u5b9a\u4e49\u3002 \u9996\u5148\u662f\u4e3a\u8fdb\u7a0b\u5206\u914d\u548c\u91ca\u653etask_struct\u7ed3\u6784\u7684\u64cd\u4f5c\uff1a include/asm/processor.h #define THREAD_SIZE (2*PAGE_SIZE) #define alloc_task_struct() ((struct task_struct *) _get_free_pages(GFP_KERNEL,1)) #define free_task_struct(p) free_pages((unsigned long) (p), 1) THREAD_SIZE\u88ab\u5b9a\u4e49\u6210\u4e24\u4e2apage\u7684\u5927\u5c0f\u3002 alloc_task_struct()\u5206\u914d\u4e86\u4e24\u4e2a\u8fde\u7eed\u9875\u9762\uff0c\u5e76\u5728\u4e24\u4e2a\u9875\u9762\u7684\u8d77\u59cb\u5730\u5740\u5904\uff0c\u5b89\u653etask_struct\u7ed3\u6784\u3002\u6ce8\u610f\uff0c_get_free_pages\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u53c2\u65701\u8868\u793a\u5206\u914d2^1\u5373\u4e24\u4e2a\u9875\u9762\u3002 \u5176\u6b21\uff0c\u5f53\u8fdb\u7a0b\u5728\u7cfb\u7edf\u7a7a\u95f4\u8fd0\u884c\u65f6\uff0c\u5e38\u5e38\u9700\u8981\u8bbf\u95ee\u5f53\u524d\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\uff0c\u4e3a\u6b64\u76ee\u7684\uff0c\u5185\u6838\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b8fcurrent\u3002\u5b9a\u4e49\u5982\u4e0b\uff1a include/asm/current.h static inline struct task_struct * get_current(void) { struct task_struct *current; __asm__( andl %%esp,%0; : =r (current) : 0 (~8191UL)); return current; } #define current get_current() current\u6700\u7ec8\u8c03\u7528get_current()\u51fd\u6570\uff0c\u540e\u8005\u4f7f\u7528\u4e86\u5d4c\u5165\u5f0f\u6c47\u7f16\u4ee3\u7801\uff0c\u76f8\u4fe1\u5927\u5bb6\u73b0\u5728\u8bfb\u6765\u5df2\u7ecf\u4e0d\u662f\u4ec0\u4e48\u96be\u4e8b\u4e86\u3002\u8fd9\u91cc\u7684\u8f93\u5165\u90e8\u662f\u4e00\u4e2a\u7acb\u5373\u6570\uff08~8191UL\uff09\u53738191\u53d6\u53cd\uff08\u53d6\u53cd\u4e4b\u540e\u4e3a0xfffffe00\uff09\uff0c\u8f93\u51fa\u90e8\u4e3a\u5c40\u90e8\u53d8\u91cfcurrent\uff0c\u8f93\u5165\u90e8\u4e0e\u8f93\u51fa\u90e8\u5171\u7528\u540c\u4e00\u4e2a\u5bc4\u5b58\u5668\u3002\u6307\u4ee4\u90e8\u4e2d\uff0c\u5c06\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u6808\u9876\u6307\u9488esp\u4e0e0xfffffe000\u4f4d\u4e0e\u3002\u56e0\u4e3atask_struct\u7684\u5730\u5740\u4e0e8K\uff08\u4e24\u4e2a\u9875\u9762\u7684\u5927\u5c0f\uff09\u7684\u8fb9\u754c\u5bf9\u9f50\uff0c\u800c\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u6808\u9876\u6307\u9488esp\u57288K\u7a7a\u95f4\u4e4b\u5185\uff0c0xfffffe00\u4e3a8K\u51cf1\u518d\u6c42\u53cd\uff0c\u7528\u4f5c\u63a9\u7801\uff0cesp\u4e0e\u8be5\u63a9\u7801\u4f4d\u4e0e\u5373\u53ef\u5f97\u5230esp\u6240\u57288K\u7a7a\u95f4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u5373task_struct\u7ed3\u6784\u7684\u5730\u5740\u3002 \u4e0e\u6b64\u7c7b\u4f3c\uff0c\u5728\u8fdb\u5165\u4e2d\u65ad\u548c\u7cfb\u7edf\u8c03\u7528\u65f6\u6240\u5f15\u7528\u7684\u5b8f\u64cd\u4f5cGET_CURRENT\uff0c\u5728 \u4e2d\u5b9a\u4e49\uff1a #define GET_CURRENT \\ movl %esp, %ebx\\n\\t \\ andl $-8192, %ebx\\n\\t","title":"2 \u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e0ecurrent"},{"location":"kernel/LinuxProcess/#3-task_struct","text":"task_struct\u7ed3\u6784\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a struct task_struct { volatile long state; unsigned long flags; int sigpending; mm_segment_t addr_limit; struct exec_domain *exec_domain; volatile long need_resched; unsigned long ptrace; int lock_depth; long counter; long nice; unsigned long policy; struct mm_struct *mm; int has_cpu, processor; unsigned long cpus_allowed; struct list_head run_list; unsigned long sleep_time; struct task_struct *next_task, *prev_task; struct mm_struct *active_mm; struct linux_binfmt *binfmt; int exit_code, exit_signal; int pdeath_signal; unsigned long personality; int dumpable:1; int did_exec:1; pid_t pid; pid_t pgrp; pid_t tty_old_pgrp; pid_t session; pid_t tgid; int leader; struct task_struct *p_opptr, *p_pptr, *p_cptr, *p_ysptr, *p_osptr; struct list_head thread_group; struct task_struct *pidhash_next; struct task_struct **pidhash_pprev; wait_queue_head_t wait_chldexit; struct semaphore *vfork_sem; unsigned long rt_priority; unsigned long it_real_value, it_prof_value, it_virt_value; unsigned long it_real_incr, it_prof_incr, it_virt_incr; struct timer_list real_timer; struct tms times; unsigned long start_time; long per_cpu_utime[NR_CPUS], per_cpu_stime[NR_CPUS]; unsigned long min_flt, maj_flt, nswap, cmin_flt, cmaj_flt, cnswap; int swappable:1; uid_t uid,euid,suid,fsuid; gid_t gid,egid,sgid,fsgid; int ngroups; gid_t groups[NGROUPS]; kernel_cap_t cap_effective, cap_inheritable, cap_permitted; int keep_capabilities:1; struct user_struct *user; struct rlimit rlim[RLIM_NLIMITS]; unsigned short used_math; char comm[16]; int link_count; struct tty_struct *tty; unsigned int locks; struct sem_undo *semundo; struct sem_queue *semsleeping; struct thread_struct thread; struct fs_struct *fs; struct files_struct *files; spinlock_t sigmask_lock; struct signal_struct *sig; sigset_t blocked; struct sigpending pending; unsigned long sas_ss_sp; size_t sas_ss_size; int (*notifier)(void *priv); void *notifier_data; sigset_t *notifier_mask; u32 parent_exec_id; u32 self_exec_id; spinlock_t alloc_lock; }; state: \u8868\u793a\u8fdb\u7a0b\u7684\u5f53\u524d\u8fd0\u884c\u72b6\u6001\uff0c\u8fdb\u7a0b\u7684\u6240\u6709\u53ef\u80fd\u72b6\u6001\u5b9a\u4e49\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff1a #define TASK_RUNNING 0 #define TASK_INTERRUPTIBLE 1 #define TASK_UNINTERRUPTIBLE 2 #define TASK_ZOMBIE 4 #define TASK_STOPPED 8 TASK_RUNNING \u72b6\u6001\u5e76\u4e0d\u662f\u8868\u793a\u4e00\u4e2a\u8fdb\u7a0b\u6b63\u5728\u8fd0\u884c\uff0c\u6216\u8005\u662f\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u662f\u201c\u5f53\u524d\u8fdb\u7a0b\u201d\uff0c\u800c\u662f\u8868\u793a\u8fd9\u4e2a\u8fdb\u7a0b\u53ef\u88ab\u8c03\u5ea6\u6267\u884c\u800c\u6210\u4e3a\u5f53\u524d\u8fdb\u7a0b\uff0c\u662f\u8fdb\u7a0b\u8868\u8fbe\u4e86\u5e0c\u671b\u88ab\u8c03\u5ea6\u8fd0\u884c\u7684\u610f\u613f\u3002\u5f53\u8fdb\u7a0b\u5904\u4e8e\u6b64\u72b6\u6001\u65f6\uff0c\u8868\u793a\u8fdb\u7a0b\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\u6216\u8005\u53ef\u4ee5\u88ab\u6267\u884c\u4e86\uff0c\u5185\u6838\u4f1a\u5c06\u8be5\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\u901a\u8fc7\u5176\u961f\u5217\u5934run_list\u94fe\u5165\u4e00\u4e2a\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\uff0c\u81f3\u4e8e\u6700\u7ec8\u8c03\u5ea6\u8fd0\u884c\u8c01\uff0c\u5185\u6838\u4f1a\u6839\u636e\u8c03\u5ea6\u7b56\u7565\u4ece\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\u4e2d\u6311\u9009\u4e00\u4e2a\u8fdb\u7a0b\u6765\u8c03\u5ea6\u8fd0\u884c\u3002 TASK_INTERRUPTIBLE \u548c TASK_UNINTERRUPTIBLE \u90fd\u8868\u793a\u8fdb\u7a0b\u5904\u4e8e\u7761\u7720\u72b6\u6001\u3002\u4e0d\u8fc7\u524d\u8005\u8868\u793a\u6d45\u5ea6\u7761\u7720\uff0c\u53ef\u4ee5\u88ab\u4fe1\u53f7\uff08\u4e5f\u6210\u4e3a\u8f6f\u4e2d\u65ad\uff09\u5524\u9192\uff1b\u540e\u8005\u8868\u793a\u6df1\u5ea6\u7761\u7720\u800c\u4e0d\u53d7\u4fe1\u53f7\u7684\u6253\u6270\u3002\u8fd9\u91cc\u7684INTERRUPTIBLE\u6216UNINTERRUPTIBLE\u4e0e\u201c\u4e2d\u65ad\u201d\u6beb\u65e0\u5173\u7cfb\uff0c\u800c\u53ea\u662f\u8bf4\u7761\u7720\u80fd\u5426\u56e0\u5176\u4ed6\u65f6\u95f4\u800c\u4e2d\u65ad\u3002\u5185\u6838\u4e2d\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u51fd\u6570\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u5165\u4e0d\u540c\u7a0b\u5ea6\u7684\u7761\u7720\u6216\u5c06\u8fdb\u7a0b\u4ece\u7761\u7720\u4e2d\u5524\u9192\u3002\u5177\u4f53\u6765\u8bf4\uff0csleep_on\u548cwake_up\u7528\u4e8e\u6df1\u5ea6\u7761\u7720\uff1b\u800cinterruptible_sleep_on\u548cinterruptible_wake_up\u5219\u7528\u4e8e\u6d45\u5ea6\u7761\u7720\u3002 TASK_ZOMBIE \u72b6\u6001\u8868\u793a\u8fdb\u7a0b\u5df2\u7ecf\u53bb\u4e16\uff08exit\uff09\u800c\u6237\u53e3\uff08task_struct\uff09\u5c1a\u672a\u6ce8\u9500\u3002 TASK_STOPPED \u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002\u8fdb\u7a0b\u63a5\u6536\u5230\u4e00\u4e2aSIGSTOP\u4fe1\u53f7\u540e\u5c31\u5c06\u8fd0\u884c\u72b6\u6001\u6539\u6210TASK_STOPPED\u800c\u8fdb\u5165\u6302\u8d77\u72b6\u6001\uff0c\u7136\u540e\u5728\u63a5\u6536\u5230\u4e00\u4e2aSIGCONT\u4fe1\u53f7\u65f6\u53c8\u6062\u590d\u7ee7\u7eed\u8fd0\u884c\u3002 flag\uff1a \u4e0e\u8fdb\u7a0b\u7ba1\u7406\u6709\u5173\u7684\u4fe1\u606f\uff0c\u5bf9\u5e94\u7684\u6807\u5fd7\u4f4d\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5b9a\u4e49\uff1a /* * Per process flags */ #define PF_ALIGNWARN 0x00000001 /* Print alignment warning msgs */ /* Not implemented yet, only for 486*/ #define PF_STARTING 0x00000002 /* being created */ #define PF_EXITING 0x00000004 /* getting shut down */ #define PF_FORKNOEXEC 0x00000040 /* forked but didn't exec */ #define PF_SUPERPRIV 0x00000100 /* used super-user privileges */ #define PF_DUMPCORE 0x00000200 /* dumped core */ #define PF_SIGNALED 0x00000400 /* killed by a signal */ #define PF_MEMALLOC 0x00000800 /* Allocating memory */ #define PF_VFORK 0x00001000 /* Wake up parent in mm_release */ #define PF_USEDFPU 0x00100000 /* task used FPU this quantum (SMP) */ PF_MEMALLOC \u6211\u4eec\u5df2\u7ecf\u5728\u5185\u5b58\u9875\u9762\u5206\u914d\u65f6\u89c1\u8fc7\u4e86\uff0c\u5176\u4ed6\u7684\u6807\u5fd7\u4f4d\u8bf7\u53c2\u8003\u6ce8\u91ca\u3002 sigpending\uff1a \u8868\u793a\u8fdb\u7a0b\u6536\u5230\u4e86\u4fe1\u53f7\u4f46\u5c1a\u672a\u5904\u7406\uff0c\u4e0e\u8fd9\u4e2a\u6807\u5fd7\u76f8\u8054\u7cfb\u7684\u662f\u4e0e\u4fe1\u53f7\u961f\u5217\u6709\u5173\u7684sigqueue\u3001sigqueue_tail\u3001sig\u7b49\u6307\u9488\u4ee5\u53casigmask_lock\u3001signal\u3001blocked\u7b49\u6210\u5206\u3002 counter\uff1a \u4e0e\u8c03\u5ea6\u6709\u5173\u3002 need_resched\uff1a \u4e0e\u8c03\u5ea6\u6709\u5173\uff0c\u8868\u793aCPU\u4ece\u7cfb\u7edf\u7a7a\u95f4\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u524d\u5915\u8981\u8fdb\u884c\u4e00\u6b21\u8c03\u5ea6\u3002 \u4e0a\u8ff0\u5b57\u6bb5\u53cd\u5e94\u4e86\u8fdb\u7a0b\u7684\u52a8\u6001\u7279\u5f81\uff0c\u4e0b\u9762\u8fd9\u4e9b\u5b57\u6bb5\u5219\u53cd\u5e94\u4e86\u8fdb\u7a0b\u7684\u9759\u6001\u7279\u5f81\u3002 addr_limit\uff1a \u865a\u5b58\u5730\u5740\u7684\u7a7a\u95f4\u4e0a\u9650\u3002\u5bf9\u8fdb\u7a0b\u800c\u8a00\u5c31\u662f\u5176\u7528\u6237\u7a7a\u95f4\u7684\u4e0a\u9650\uff0c\u6240\u4ee5\u4e3a0xbfffffff\uff1b\u5bf9\u5185\u6838\u8fdb\u7a0b\u800c\u8a00\u5219\u662f\u7cfb\u7edf\u7a7a\u95f4\u7684\u4e0a\u9650\u4e3a0xffffffff\u3002 personality\uff1a \u770b\u8fc7APUE\u7684\u90fd\u77e5\u9053\uff0cUnix\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u7248\u672c\u548c\u53d8\u79cd\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e5f\u5c31\u6709\u5404\u81ea\u7684\u9002\u7528\u8303\u56f4\u3002\u6bd4\u5982Unix SVR4\u7684\u5e94\u7528\u7a0b\u5e8f\u672a\u5fc5\u4e0e\u4e3alinux\u5f00\u53d1\u7684\u5176\u4ed6\u8f6f\u4ef6\u5b8c\u5168\u517c\u5bb9\u3002\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u5176\u4e0e\u751f\u4ff1\u6765\u7684\u201c\u4e2a\u6027\u201c\u3002\u6587\u4ef6 \u5b9a\u4e49\u4e86\u76f8\u5173\u7684\u5e38\u6570\u3002 exec_domain: \u9664\u4e86personality\u5916\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7248\u672c\u95f4\u7684\u5dee\u5f02\uff0c\u4ece\u800c\u5f62\u6210\u4e86\u4e0d\u540c\u7684\u201c\u6267\u884c\u57df\u201d\u3002\u8fd9\u4e2a\u6307\u9488\u5c31\u6307\u5411\u63cf\u8ff0\u672c\u8fdb\u7a0b\u6240\u5c5e\u6267\u884c\u57df\u7684\u6570\u636e\u7ed3\u6784\u3002 binfmt\uff1a \u5e94\u7528\u7a0b\u5e8f\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u5982a.out\u3001elf\u7b49\u3002 exit_code\uff1a \u9000\u51fa\u7801\uff0c\u4e0e\u4e4b\u76f8\u5173\u7684exit_signal\u3001pdeath_signal\u8be6\u89c1\u300a\u7cfb\u7edf\u8c03\u7528exit\u4e0ewait4\u300b\u3002 pid\uff1a \u8fdb\u7a0b\u53f7\u3002 pgrp\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u9664\u4e86\u6709\u4e00\u4e2a\u8fdb\u7a0b\u53f7\u4ee5\u5916\uff0c\u8fd8\u5c5e\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u7ec4\u3002pgrp\u6307\u5411\u8fdb\u7a0b\u6240\u5c5e\u7684\u8fdb\u7a0b\u7ec4ID\u3002 session\uff1a \u4f1a\u8bdd\u3002\u5f53\u4e00\u4e2a\u7528\u6237\u767b\u5f55\u5230\u7cfb\u7edf\u540e\uff0c\u5c31\u5f00\u59cb\u4e86\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u4f1a\u8bdd\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u7ec4\u7684\u96c6\u5408\u3002 leader\uff1a \u6bcf\u4e2a\u4f1a\u8bdd\u90fd\u4e00\u4e2a\u4f1a\u8bdd\u9996\u8fdb\u7a0b\uff08session leader\uff09\u3002 priority\u3001rt_priority\uff1a \u4f18\u5148\u7ea7\u522b\u4ee5\u53ca\u201c\u5b9e\u65f6\u201d\u4f18\u5148\u7ea7\u522b\u3002 policy\uff1a \u672c\u8fdb\u7a0b\u7684\u8c03\u5ea6\u7b56\u7565\u3002 parent_exec_id\u3001self_exec_id\uff1a \u4e0e\u4f1a\u8bdd\uff08session\uff09\u6709\u5173\u3002 uid\u3001euid\u3001suid\u3001fsuid\u3001gid\u3001egid\u3001sgid\u3001fsgid\uff1a \u8fdb\u7a0b\u6240\u5c5e\u7684\u7528\u6237ID\u3001\u6709\u6548\u7528\u6237ID\u3001\u4fdd\u5b58\u7684\u8bbe\u7f6e\u7528\u6237ID\u3001\u7528\u4e8e\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u68c0\u67e5\u7684\u7528\u6237ID\uff0c\u7ec4ID\u3001\u6709\u6548\u7ec4ID\u3001\u4fdd\u5b58\u7684\u8bbe\u7f6e\u7ec4ID\uff0c\u7528\u4e8e\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u68c0\u67e5\u7684\u7ec4ID\u3002\u53c2\u8003\u540e\u9762\u7684\u5185\u5bb9\uff08\u4e5f\u53ef\u4ee5\u53c2\u8003APUE\u7b2c\u4e8c\u7248\u7684\u7b2c8\u7ae0\uff09\u3002 cap_effective\u3001cap_inheritable\u3001cap_permitted\uff1a \u4e00\u822c\u8fdb\u7a0b\u90fd\u4e0d\u80fd\u4e3a\u6240\u6b32\u4e3a\uff0c\u800c\u662f\u5404\u81ea\u88ab\u8d4b\u4e88\u4e86\u5404\u79cd\u4e0d\u540c\u7684\u6743\u9650\u3002\u5c06\u6743\u5229\u7ec6\u5206\uff0c\u800c\u4e0d\u662f\u7b3c\u7edf\u7684\u53d6\u51b3\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u662f\u5426\u662f\u201c\u7279\u6743\u8fdb\u7a0b\u201d\uff0c\u8fd9\u4e5f\u662flinux\u5b89\u5168\u673a\u5236\u7684\u57fa\u7840\u4e4b\u4e00\uff08\u53e6\u4e00\u4e2a\u662f\u6587\u4ef6\u8bbf\u95ee\u6743\u9650\u7684\u8bbe\u7f6e\uff09\u3002 \u5b9a\u4e49\u4e86\u8bb8\u591a\u8fd9\u6837\u7684\u6743\u9650\u3002\u540c\u65f6\u5185\u6838\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5185\u8054\u51fd\u6570capable\uff0c\u7528\u6765\u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u5177\u6709\u67d0\u79cd\u6743\u9650\u3002 user\uff1a \u6307\u5411\u4e00\u4e2auser_struct\u7ed3\u6784\uff0c\u8be5\u6570\u636e\u7ed3\u6784\u4ee3\u8868\u7740\u8fdb\u7a0b\u6240\u5c5e\u7684\u7528\u6237\u3002 rlim\uff1a \u8fd9\u662f\u4e00\u4e2a\u7ed3\u6784\u6570\u7ec4\uff0c\u8868\u660e\u8fdb\u7a0b\u5bf9\u5404\u79cd\u8d44\u6e90\u7684\u4f7f\u7528\u6570\u91cf\u6240\u53d7\u7684\u9650\u5236\u3002\u6211\u4eec\u5728\u7b2c\u4e8c\u7ae0\u7528\u6237\u5806\u6808\u7684\u6269\u5c55\u4e2d\u5df2\u7ecf\u770b\u5230\u4e86\u5bf9\u8fd9\u79cd\u9650\u5236\u7684\u5e94\u7528\uff08\u9700\u8981\u83b7\u53d6\u7528\u6237\u7a7a\u95f4\u5806\u6808\u5927\u5c0f\u7684\u9650\u5236\u7b49\uff09\u3002\u6570\u636e\u7ed3\u6784rlimit\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a struct rlimit { unsigned long rlim_cur; unsigned long rlim_max; }; rlim_cur \u4e3a\u201csoft limit\u201d\uff0c\u662f\u5f53\u524d\u7684\u9650\u5236\uff0c rlim_max \u4e3a\u201chard limit\u201d\uff0c\u8868\u793a\u6700\u5927\u9650\u5236\u3002rlim_cur\u7684\u53d6\u503c\u4e0d\u80fd\u6bd4rlim_max\u5927\u3002","title":"3 task_struct"},{"location":"kernel/LinuxProcess/#4","text":"\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u4e0d\u662f\u5b64\u7acb\u7684\u5b58\u5728\u4e8e\u7cfb\u7edf\u4e2d\uff0c\u800c\u603b\u662f\u6839\u636e\u4e0d\u540c\u7684\u76ee\u7684\u3001\u5173\u7cfb\u548c\u9700\u8981\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u76f8\u8054\u7cfb\u3002\u4ece\u5185\u6838\u7684\u89d2\u5ea6\u770b\uff0c\u5219\u662f\u8981\u6839\u636e\u4e0d\u540c\u7684\u76ee\u7684\u548c\u6027\u8d28\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u7eb3\u5165\u5404\u79cd\u7ec4\u7ec7\u3002 \u7b2c\u4e00\u4e2a\u7ec4\u7ec7\u5c31\u662f\u8fdb\u7a0b\u7684\u201c\u5bb6\u8c31\u201d \u3002\u8fd9\u662f\u4e00\u79cd\u6811\u5f62\u7ec4\u7ec7\uff0c\u901a\u8fc7p_opptr\u3001p_pptr\u3001p_cptr\u3001p_ysptr\u548cp_osptr\u6784\u6210\u3002\u5176\u4e2dp_opptr\uff08original parent\uff0c\u751f\u7236\uff09\u4e0ep_pptr\uff08\u517b\u7236\uff09\u6307\u5411\u7236\u8fdb\u7a0b\uff0cp_cptr\uff08c\u4ee3\u8868child\uff09\u6307\u5411\u6700\u201c\u5e74\u8f7b\u201d\uff08\u6700\u8fd1\u521b\u5efa\u7684\uff09\u7684\u5b50\u8fdb\u7a0b\uff0c\u800cp_ysptr\uff08youngest sibling\uff09\u548cp_osptr\uff08oldest sibling\uff09\u5219\u5206\u522b\u6307\u5411\u5176\u201c\u5f1f\u5f1f\u201d\u548c\u201c\u54e5\u54e5\u201d\u3002\u8fd9\u79cd\u201c\u5bb6\u8c31\u201d\u7ec4\u7ec7\u793a\u610f\u5982\u4e0b\uff1a \u6839\u636ep_cptr\u987a\u85e4\u6478\u74dc\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u627e\u5230\u5b83\u6240\u6709\u7684\u5b50\u8fdb\u7a0b\u3002\u4f46\u662f\u60f3\u8981\u6839\u636e\u8fdb\u7a0b\u53f7pid\u627e\u5230\u5bf9\u5e94\u7684task_struct\u8fd8\u662f\u5f88\u96be\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u7b2c\u4e8c\u4e2a\u7ec4\u7ec7\u3002 \u7b2c\u4e8c\u4e2a\u7ec4\u7ec7\u5c31\u662f\u6309\u7167\u8fdb\u7a0b\u53f7pid\u6784\u6210\u7684\u54c8\u5e0c\u961f\u5217\u3002 \u7ed9\u5b9apid\uff0c\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u5c31\u53ef\u4ee5\u5f97\u5230\u8fdb\u7a0b\u7684task_struct\u7ed3\u6784\u5728\u54c8\u5e0c\u961f\u5217\u4e2d\u7684\u4e0b\u6807\uff0c\u8fdb\u800c\u627e\u5230\u8fdb\u7a0b\u5bf9\u5e94\u7684task_struct\u7ed3\u6784\u3002\u54c8\u5e0c\u8868pidhash\u5b9a\u4e49\u5728 \u4e2d\uff1a struct task_struct *pidhash[PIDHASH_SZ]; \u800cPIDHASH_SZ\u5b9a\u4e49\u5728 \u4e2d\uff1a #define PIDHASH_SZ (4096 2) \u53ef\u89c1\uff0c\u54c8\u5e0c\u8868pidhash\u5171\u67091024\u4e2a\u5143\u7d20\uff0c\u7cfb\u7edf\u540c\u65f6\u5b58\u5728\u7684\u8fdb\u7a0b\u6570\u76ee\u4e0d\u80fd\u8d85\u8fc71024\u4e2a\u3002\u540c\u65f6\uff0c\u7531\u4e8e\u4e00\u4e2a\u6307\u9488\u53604\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u6574\u4e2a\u54c8\u5e0c\u8868\u5360\u75284K\u5373\u4e00\u4e2a\u9875\u9762\u7684\u5927\u5c0f\u3002 \u5f53\u5185\u6838\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u65f6\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u7528\u5230\u7b2c\u4e09\u4e2a\u7ec4\u7ec7\u3002 \u7b2c\u4e09\u4e2a\u7ec4\u7ec7\u662f\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u94fe\u8d77\u6765\u7684\u7ebf\u6027\u961f\u5217\u3002 \u7cfb\u7edf\u521b\u5efa\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u4e3ainit_task\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u662f\u6240\u6709\u8fdb\u7a0b\u7684\u603b\u6839\uff0c\u6240\u4ee5\u5b83\u5c31\u662f\u8fd9\u4e2a\u7ebf\u6027\u961f\u5217\u7684\u8d77\u70b9\u3002\u540e\u7eed\u6bcf\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5c31\u901a\u8fc7\u5176task_struct\u7ed3\u6784\u4e2d\u7684next_task\u548cprev_task\u4e24\u4e2a\u6307\u9488\u94fe\u5165\u8fd9\u4e2a\u961f\u5217\u3002 \u6bcf\u4e2a\u8fdb\u7a0b\u5fc5\u7136\u540c\u65f6\u8eab\u5904\u8fd9\u4e09\u4e2a\u7ec4\u7ec7\u4e4b\u4e2d\uff0c\u76f4\u5230\u8fdb\u7a0b\u6d88\u4ea1\u65f6\u624d\u4ece\u8fd9\u4e09\u4e2a\u961f\u5217\u4e2d\u6458\u9664\u3002 \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u968f\u65f6\u53ef\u80fd\u94fe\u5165\u201c\u53ef\u6267\u884c\u961f\u5217\u201d\u4e2d\u63a5\u53d7\u7cfb\u7edf\u8c03\u5ea6\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ea\u6709\u5728\u201c\u53ef\u6267\u884c\u961f\u5217\u201c\u4e2d\u624d\u6709\u53ef\u80fd\u53d7\u5230\u8c03\u5ea6\u800c\u6295\u5165\u8fd0\u884c\u3002\u8fd9\u5c31\u662f\u7b2c\u56db\u4e2a\u7ec4\u7ec7\u3002\u8fdb\u7a0b\u901a\u8fc7task_struct\u7ed3\u6784\u4e2drun_list\u94fe\u5165\u53ef\u6267\u884c\u961f\u5217\u3002","title":"4 \u4e0e\u8fdb\u7a0b\u76f8\u5173\u7684\u201c\u7ec4\u7ec7\u201d"},{"location":"kernel/PSCreateExecExit/","text":"\u5728linux\u7cfb\u7edf\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\uff08init\u8fdb\u7a0b\uff09\u662f\u4e0e\u751f\u4ff1\u6765\u7684\uff0c\u662f\u5185\u6838\u8bbe\u8ba1\u8005\u523b\u610f\u5b89\u6392\u7684\u3002\u9664\u6b64\u4ee5\u5916\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5fc5\u987b\u4ece\u5f53\u524d\u5df2\u7ecf\u5b58\u5728\u7684\u67d0\u4e2a\u8fdb\u7a0b\u201c\u590d\u5236\u201d\u51fa\u6765\uff0c\u800c\u4e0d\u80fd\u51ed\u7a7a\u201c\u521b\u9020\u201d\u51fa\u6765\u3002 linux\u5c06\u8fdb\u7a0b\u7684\u521b\u5efa\u4e0e\u76ee\u6807\u7a0b\u5e8f\u7684\u6267\u884c\u5206\u4e24\u6b65\u8d70\u3002 \u8fdb\u7a0b\u521b\u5efa \u6b64\u65f6\uff0c\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684task_struct\u7ed3\u6784\u4e0e\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff08\u5373\u8fdb\u7a0b\u56db\u8981\u7d20\u4e2d\u7684\u7b2c2\u548c\u7b2c3\u4e2a\u8981\u7d20\uff09\uff0c\u4f46\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\u6240\u6709\u5176\u4ed6\u8d44\u6e90\uff0c\u6bd4\u5982\u6253\u5f00\u7684\u6587\u4ef6\uff0c\u800c\u4e14\u8fd9\u4e9b\u6587\u4ef6\u7684\u5f53\u524d\u8bfb\u5199\u6307\u9488\u4e5f\u505c\u7559\u5728\u76f8\u540c\u7684\u5730\u65b9(\u7236\u5b50\u8fdb\u7a0b\u6bcf\u4e2a\u76f8\u540c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5171\u7528\u540c\u4e00\u4e2a\u6587\u4ef6\u8868\u9879)\u3002\u6240\u4ee5\u8fd9\u4e00\u6b65\u6240\u505a\u7684\u5de5\u4f5c\u662f\u201c\u590d\u5236\u201d\u3002\u4e3a\u6b64\uff0clinux\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c fork \u548c clone \u3002\u533a\u522b\u5728\u4e8e fork \u662f\u5168\u90e8\u590d\u5236\uff0c\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\u901a\u8fc7\u7ed3\u6784\u4f53\u7684\u590d\u5236\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u201c\u6df1\u62f7\u8d1d\u201d\uff09\u201c\u9057\u4f20\u201d\u7ed9\u5b50\u8fdb\u7a0b\u3002\u800c clone \u5219\u662f\u6709\u9009\u62e9\u6027\u7684\u590d\u5236\uff0c\u800c\u6ca1\u6709\u590d\u5236\u7684\u6570\u636e\u7ed3\u6784\u5219\u901a\u8fc7\u6307\u9488\u7684\u62f7\u8d1d\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u201c\u6d45\u62f7\u8d1d\u201d\uff09\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\u3002\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5 clone \u51fa\u4e00\u4e2a\u7ebf\u7a0b\u3002\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a vfork \u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u4e0d\u5e26\u53c2\u6570\uff0c\u9664\u4e86 task_struct \u7ed3\u6784\u548c\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u5916\uff0c\u6240\u6709\u7684\u8d44\u6e90\u90fd\u662f\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\uff0c\u6240\u4ee5 vfork \u590d\u5236\u51fa\u6765\u7684\u662f\u7ebf\u7a0b\u800c\u4e0d\u662f\u8fdb\u7a0b\u3002 \u4e3a\u4ec0\u4e48\u8981\u6709\u590d\u5236\u8fd9\u4e00\u6b65\uff1f\u6240\u8c13\u590d\u5236\uff08\u201c\u6df1\u62f7\u8d1d\u201d\uff09\u53ea\u662f\u8fdb\u7a0b\u57fa\u672c\u8d44\u6e90\u7684\u590d\u5236\uff0c\u5982 task_struct \u7ed3\u6784\u3001\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u3001\u9875\u9762\u8868\u7b49\u7b49\uff1b\u9664\u6b64\u4ee5\u5916\uff0c\u5176\u4ed6\u7684\u8d44\u6e90\u6bd4\u5982\u7236\u8fdb\u7a0b\u7684\u4ee3\u7801\u53ca\u5168\u5c40\u53d8\u91cf\u5e76\u4e0d\u9700\u8981\u590d\u5236\uff0c\u800c\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u5171\u4eab\uff0c\u4ec5\u5728\u9700\u8981\u5199\u65f6\u624d\u901a\u8fc7 copy on write \u624b\u6bb5\u4e3a\u6240\u6d89\u53ca\u7684\u9875\u9762\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u526f\u672c\uff08\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5f53\u5b50\u8fdb\u7a0b\u6539\u53d8\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u8be5\u5168\u5c40\u53d8\u91cf\u5728\u7236\u8fdb\u7a0b\u4e2d\u7684\u503c\uff0c\u56e0\u4e3a\u5b50\u8fdb\u7a0b\u4fee\u6539\u7684\u662f\u5c5e\u4e8e\u5b83\u7684\u526f\u672c\uff09\u3002\u6240\u4ee5\u590d\u5236\u7684\u4ee3\u4ef7\u662f\u5f88\u4f4e\u7684\uff0c\u4f46\u662f\u901a\u8fc7\u590d\u5236\u7ee7\u627f\u4e0b\u6765\u7684\u8d44\u6e90\u5f80\u5f80\u5bf9\u5b50\u8fdb\u7a0b\u5f88\u6709\u7528\u3002\u6bd4\u5982\u5728client/server\u7cfb\u7edf\u4e2d\u7684server\u4e00\u65b9\u7684\u5b9e\u73b0\u4e2d\uff0c fork \u6216 clone \u5e38\u5e38\u662f\u6700\u81ea\u7136\u3001\u6700\u6709\u6548\u7684\u624b\u6bb5\u3002 \u76ee\u6807\u7a0b\u5e8f\u7684\u6267\u884c \u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u590d\u5236\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u540e\u6709\u65b0\u7684\u76ee\u6807\u7a0b\u5e8f\u7b49\u5f85\u5b50\u8fdb\u7a0b\u53bb\u6267\u884c\uff08\u4f46\u4e5f\u4e0d\u4e00\u5b9a\uff0c\u6bd4\u5982\u5b50\u8fdb\u7a0b\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\uff09\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u590d\u5236\u5b8c\u6210\u4ee5\u540e\uff0c\u5b50\u8fdb\u7a0b\u4e00\u822c\u8981\u4e0e\u7236\u8fdb\u7a0b\u5206\u9053\u626c\u9573\u8d70\u81ea\u5df1\u7684\u8def\u4e86\u3002\u4e3a\u6b64\uff0clinux\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528 execve \uff0c\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u4e00\u4e2a\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u5728\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u6620\u50cf\u3002\u65e2\u7136\u5b50\u8fdb\u7a0b\u8981\u8d70\u81ea\u5df1\u7684\u8def\uff0c\u90a3\u5c31\u4e0d\u8981\u56de\u5934\u4e86\uff0c\u6240\u4ee5\u7cfb\u7edf\u8c03\u7528execve\u4e0d\u4f1a\u8fd4\u56de\uff0c\u800c\u662f\u201c\u58ee\u58eb\u4e00\u53bb\u516e\u4e0d\u590d\u8fd4\u201d\u3002 \u90a3\u4e48\u8fd9\u79cd\u5206\u4e24\u6b65\u8d70\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u9996\u5148\uff0c\u5f88\u591a\u573a\u666f\u53ea\u9700\u5355\u72ec\u4f7f\u7528 fork \uff0c\u5176\u540e\u5e76\u4e0d\u8ddf execve \uff1b\u5176\u6b21\uff0c\u5206\u4e24\u6b65\u8d70\u662f\u7684\u5b50\u8fdb\u7a0b\u5728\u6267\u884cexceve\u4e4b\u524d\u6709\u673a\u4f1a\u4fee\u6539\u81ea\u5df1\u7684\u5c5e\u6027\uff08\u6bd4\u5982IO\u91cd\u5b9a\u5411\u3001\u7528\u6237ID\uff0c\u4fe1\u53f7\u5b89\u6392\u7b49\uff09\u3002 \u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u540e\uff0c\u7236\u8fdb\u7a0b\u8be5\u4f55\u53bb\u4f55\u4ece\uff1f\u4e00\u822c\u6709\u4e09\u4e2a\u9009\u62e9\u3002\u7b2c\u4e00\u662f\u7ee7\u7eed\u8d70\u81ea\u5df1\u7684\u8def\uff0c\u4e0e\u5b50\u8fdb\u7a0b\u5206\u9053\u626c\u9573\u3002\u53ea\u662f\u5982\u679c\u5b50\u8fdb\u7a0b\u5148\u4e8e\u7236\u8fdb\u7a0b\u53bb\u4e16\uff0c\u5219\u7531\u5185\u6838\u7ed9\u7236\u8fdb\u7a0b\u53d1\u4e00\u4e2a\u62a5\u4e27\u7684\u4fe1\u53f7\uff08SIGCHILD\uff09\u3002\u7b2c\u4e8c\u4e2a\u662f\u505c\u4e0b\u4e86\uff0c\u4e5f\u5c31\u662f\u8fdb\u5165\u7761\u7720\u72b6\u6001\uff0c\u7b49\u5f85\u5b50\u8fdb\u7a0b\u5b8c\u6210\u81ea\u5df1\u7684\u4f7f\u547d\u800c\u6700\u7ec8\u53bb\u4e16\uff0c\u7136\u540e\u7236\u8fdb\u7a0b\u518d\u8fd0\u884c\u3002linux\u4e3a\u6b64\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0cwait4\uff08\u7b49\u5f85\u67d0\u4e2a\u7279\u5b9a\u7684\u5b50\u8fdb\u7a0b\u53bb\u4e16\uff09\u548cwait3\uff08\u7b49\u5f85\u4efb\u4f55\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u53bb\u4e16\uff09\u3002\u7b2c\u4e09\u4e2a\u9009\u62e9\u662f\u201c\u81ea\u884c\u9000\u51fa\u5386\u53f2\u821e\u53f0\u201d\uff0c\u7ed3\u675f\u81ea\u5df1\u7684\u751f\u547d\u3002linux\u4e3a\u6b64\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528exit\uff0c(\u4e0d\u8fc7\u4ee3\u7801\u4e2d\u4e00\u822c\u5f88\u5c11\u76f4\u63a5\u8c03\u7528exit\uff0c\u800c\u662f\u901a\u8fc7return\u8bed\u53e5\u4ecemain\u51fd\u6570\u4e2d\u8fd4\u56de\uff0cgcc\u5728\u7f16\u8bd1\u548c\u94fe\u63a5\u65f6\u4f1a\u81ea\u52a8\u52a0\u4e0aexit\uff0c\u8be6\u89c1APUE\u7b2c7\u7ae0)\u3002 \u9700\u8981\u8bf4\u660e\u4e00\u70b9\uff1a\u7236\u8fdb\u7a0b\u901a\u8fc7fork\u7cfb\u7edf\u8c03\u7528\u590d\u5236\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u540e\uff0c\u7531\u4e8e\u5b50\u8fdb\u7a0b\u6709\u4e86\u81ea\u5df1\u7684task_struct\u7ed3\u6784\uff0c\u6240\u4ee5\u5b50\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u8c03\u5ea6\u5668\u770b\u5230\u5e76\u53ef\u80fd\u88ab\u8c03\u5ea6\u6267\u884c\uff0c\u4e14\u4e0e\u7236\u8fdb\u7a0b\u5177\u6709\u76f8\u540c\u7684\u8fd4\u56de\u5730\u5740\uff08\u5373\u8fd4\u56de\u5230\u8c03\u7528fork\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff09\uff0c\u6240\u4ee5\u5f53\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u53d7\u8c03\u5ea6\u7ee7\u7eed\u8fd0\u884c\u800c\u4ece\u5185\u6838\u7a7a\u95f4\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u65f6\u90fd\u8fd4\u56de\u5230\u540c\u4e00\u70b9\u4e0a\uff0c\u4f46\u4e8c\u8005\u7684\u8fd4\u56de\u503c\u4e0d\u4e00\u6837\uff0c\u7236\u8fdb\u7a0b\u7684\u8fd4\u56de\u503c\u4e3a\u5b50\u8fdb\u7a0b\u7684pid\uff0c\u800c\u5b50\u8fdb\u7a0b\u7684\u8fd4\u56de\u503c\u4e3a0\u3002\u56e0\u6b64\uff0c\u4ee3\u7801\u4e2d\u53ef\u4ee5\u6839\u636e\u8fd4\u56de\u503c\u6765\u5224\u65ad\u7236\u5b50\u8fdb\u7a0b\u3002","title":"\u521b\u5efa\u3001\u6267\u884c\u4e0e\u6d88\u4ea1"},{"location":"kernel/PSCreateExecExit/#_1","text":"\u6b64\u65f6\uff0c\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684task_struct\u7ed3\u6784\u4e0e\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\uff08\u5373\u8fdb\u7a0b\u56db\u8981\u7d20\u4e2d\u7684\u7b2c2\u548c\u7b2c3\u4e2a\u8981\u7d20\uff09\uff0c\u4f46\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\u6240\u6709\u5176\u4ed6\u8d44\u6e90\uff0c\u6bd4\u5982\u6253\u5f00\u7684\u6587\u4ef6\uff0c\u800c\u4e14\u8fd9\u4e9b\u6587\u4ef6\u7684\u5f53\u524d\u8bfb\u5199\u6307\u9488\u4e5f\u505c\u7559\u5728\u76f8\u540c\u7684\u5730\u65b9(\u7236\u5b50\u8fdb\u7a0b\u6bcf\u4e2a\u76f8\u540c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5171\u7528\u540c\u4e00\u4e2a\u6587\u4ef6\u8868\u9879)\u3002\u6240\u4ee5\u8fd9\u4e00\u6b65\u6240\u505a\u7684\u5de5\u4f5c\u662f\u201c\u590d\u5236\u201d\u3002\u4e3a\u6b64\uff0clinux\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c fork \u548c clone \u3002\u533a\u522b\u5728\u4e8e fork \u662f\u5168\u90e8\u590d\u5236\uff0c\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\u901a\u8fc7\u7ed3\u6784\u4f53\u7684\u590d\u5236\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u201c\u6df1\u62f7\u8d1d\u201d\uff09\u201c\u9057\u4f20\u201d\u7ed9\u5b50\u8fdb\u7a0b\u3002\u800c clone \u5219\u662f\u6709\u9009\u62e9\u6027\u7684\u590d\u5236\uff0c\u800c\u6ca1\u6709\u590d\u5236\u7684\u6570\u636e\u7ed3\u6784\u5219\u901a\u8fc7\u6307\u9488\u7684\u62f7\u8d1d\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u201c\u6d45\u62f7\u8d1d\u201d\uff09\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\u3002\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5 clone \u51fa\u4e00\u4e2a\u7ebf\u7a0b\u3002\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a vfork \u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u4e0d\u5e26\u53c2\u6570\uff0c\u9664\u4e86 task_struct \u7ed3\u6784\u548c\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u5916\uff0c\u6240\u6709\u7684\u8d44\u6e90\u90fd\u662f\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\uff0c\u6240\u4ee5 vfork \u590d\u5236\u51fa\u6765\u7684\u662f\u7ebf\u7a0b\u800c\u4e0d\u662f\u8fdb\u7a0b\u3002 \u4e3a\u4ec0\u4e48\u8981\u6709\u590d\u5236\u8fd9\u4e00\u6b65\uff1f\u6240\u8c13\u590d\u5236\uff08\u201c\u6df1\u62f7\u8d1d\u201d\uff09\u53ea\u662f\u8fdb\u7a0b\u57fa\u672c\u8d44\u6e90\u7684\u590d\u5236\uff0c\u5982 task_struct \u7ed3\u6784\u3001\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u3001\u9875\u9762\u8868\u7b49\u7b49\uff1b\u9664\u6b64\u4ee5\u5916\uff0c\u5176\u4ed6\u7684\u8d44\u6e90\u6bd4\u5982\u7236\u8fdb\u7a0b\u7684\u4ee3\u7801\u53ca\u5168\u5c40\u53d8\u91cf\u5e76\u4e0d\u9700\u8981\u590d\u5236\uff0c\u800c\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u5171\u4eab\uff0c\u4ec5\u5728\u9700\u8981\u5199\u65f6\u624d\u901a\u8fc7 copy on write \u624b\u6bb5\u4e3a\u6240\u6d89\u53ca\u7684\u9875\u9762\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u526f\u672c\uff08\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5f53\u5b50\u8fdb\u7a0b\u6539\u53d8\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u8be5\u5168\u5c40\u53d8\u91cf\u5728\u7236\u8fdb\u7a0b\u4e2d\u7684\u503c\uff0c\u56e0\u4e3a\u5b50\u8fdb\u7a0b\u4fee\u6539\u7684\u662f\u5c5e\u4e8e\u5b83\u7684\u526f\u672c\uff09\u3002\u6240\u4ee5\u590d\u5236\u7684\u4ee3\u4ef7\u662f\u5f88\u4f4e\u7684\uff0c\u4f46\u662f\u901a\u8fc7\u590d\u5236\u7ee7\u627f\u4e0b\u6765\u7684\u8d44\u6e90\u5f80\u5f80\u5bf9\u5b50\u8fdb\u7a0b\u5f88\u6709\u7528\u3002\u6bd4\u5982\u5728client/server\u7cfb\u7edf\u4e2d\u7684server\u4e00\u65b9\u7684\u5b9e\u73b0\u4e2d\uff0c fork \u6216 clone \u5e38\u5e38\u662f\u6700\u81ea\u7136\u3001\u6700\u6709\u6548\u7684\u624b\u6bb5\u3002","title":"\u8fdb\u7a0b\u521b\u5efa"},{"location":"kernel/PSCreateExecExit/#_2","text":"\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u590d\u5236\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u540e\u6709\u65b0\u7684\u76ee\u6807\u7a0b\u5e8f\u7b49\u5f85\u5b50\u8fdb\u7a0b\u53bb\u6267\u884c\uff08\u4f46\u4e5f\u4e0d\u4e00\u5b9a\uff0c\u6bd4\u5982\u5b50\u8fdb\u7a0b\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\uff09\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u590d\u5236\u5b8c\u6210\u4ee5\u540e\uff0c\u5b50\u8fdb\u7a0b\u4e00\u822c\u8981\u4e0e\u7236\u8fdb\u7a0b\u5206\u9053\u626c\u9573\u8d70\u81ea\u5df1\u7684\u8def\u4e86\u3002\u4e3a\u6b64\uff0clinux\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528 execve \uff0c\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u4e00\u4e2a\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u5728\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u6620\u50cf\u3002\u65e2\u7136\u5b50\u8fdb\u7a0b\u8981\u8d70\u81ea\u5df1\u7684\u8def\uff0c\u90a3\u5c31\u4e0d\u8981\u56de\u5934\u4e86\uff0c\u6240\u4ee5\u7cfb\u7edf\u8c03\u7528execve\u4e0d\u4f1a\u8fd4\u56de\uff0c\u800c\u662f\u201c\u58ee\u58eb\u4e00\u53bb\u516e\u4e0d\u590d\u8fd4\u201d\u3002 \u90a3\u4e48\u8fd9\u79cd\u5206\u4e24\u6b65\u8d70\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u9996\u5148\uff0c\u5f88\u591a\u573a\u666f\u53ea\u9700\u5355\u72ec\u4f7f\u7528 fork \uff0c\u5176\u540e\u5e76\u4e0d\u8ddf execve \uff1b\u5176\u6b21\uff0c\u5206\u4e24\u6b65\u8d70\u662f\u7684\u5b50\u8fdb\u7a0b\u5728\u6267\u884cexceve\u4e4b\u524d\u6709\u673a\u4f1a\u4fee\u6539\u81ea\u5df1\u7684\u5c5e\u6027\uff08\u6bd4\u5982IO\u91cd\u5b9a\u5411\u3001\u7528\u6237ID\uff0c\u4fe1\u53f7\u5b89\u6392\u7b49\uff09\u3002 \u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u540e\uff0c\u7236\u8fdb\u7a0b\u8be5\u4f55\u53bb\u4f55\u4ece\uff1f\u4e00\u822c\u6709\u4e09\u4e2a\u9009\u62e9\u3002\u7b2c\u4e00\u662f\u7ee7\u7eed\u8d70\u81ea\u5df1\u7684\u8def\uff0c\u4e0e\u5b50\u8fdb\u7a0b\u5206\u9053\u626c\u9573\u3002\u53ea\u662f\u5982\u679c\u5b50\u8fdb\u7a0b\u5148\u4e8e\u7236\u8fdb\u7a0b\u53bb\u4e16\uff0c\u5219\u7531\u5185\u6838\u7ed9\u7236\u8fdb\u7a0b\u53d1\u4e00\u4e2a\u62a5\u4e27\u7684\u4fe1\u53f7\uff08SIGCHILD\uff09\u3002\u7b2c\u4e8c\u4e2a\u662f\u505c\u4e0b\u4e86\uff0c\u4e5f\u5c31\u662f\u8fdb\u5165\u7761\u7720\u72b6\u6001\uff0c\u7b49\u5f85\u5b50\u8fdb\u7a0b\u5b8c\u6210\u81ea\u5df1\u7684\u4f7f\u547d\u800c\u6700\u7ec8\u53bb\u4e16\uff0c\u7136\u540e\u7236\u8fdb\u7a0b\u518d\u8fd0\u884c\u3002linux\u4e3a\u6b64\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0cwait4\uff08\u7b49\u5f85\u67d0\u4e2a\u7279\u5b9a\u7684\u5b50\u8fdb\u7a0b\u53bb\u4e16\uff09\u548cwait3\uff08\u7b49\u5f85\u4efb\u4f55\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u53bb\u4e16\uff09\u3002\u7b2c\u4e09\u4e2a\u9009\u62e9\u662f\u201c\u81ea\u884c\u9000\u51fa\u5386\u53f2\u821e\u53f0\u201d\uff0c\u7ed3\u675f\u81ea\u5df1\u7684\u751f\u547d\u3002linux\u4e3a\u6b64\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528exit\uff0c(\u4e0d\u8fc7\u4ee3\u7801\u4e2d\u4e00\u822c\u5f88\u5c11\u76f4\u63a5\u8c03\u7528exit\uff0c\u800c\u662f\u901a\u8fc7return\u8bed\u53e5\u4ecemain\u51fd\u6570\u4e2d\u8fd4\u56de\uff0cgcc\u5728\u7f16\u8bd1\u548c\u94fe\u63a5\u65f6\u4f1a\u81ea\u52a8\u52a0\u4e0aexit\uff0c\u8be6\u89c1APUE\u7b2c7\u7ae0)\u3002 \u9700\u8981\u8bf4\u660e\u4e00\u70b9\uff1a\u7236\u8fdb\u7a0b\u901a\u8fc7fork\u7cfb\u7edf\u8c03\u7528\u590d\u5236\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u540e\uff0c\u7531\u4e8e\u5b50\u8fdb\u7a0b\u6709\u4e86\u81ea\u5df1\u7684task_struct\u7ed3\u6784\uff0c\u6240\u4ee5\u5b50\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u8c03\u5ea6\u5668\u770b\u5230\u5e76\u53ef\u80fd\u88ab\u8c03\u5ea6\u6267\u884c\uff0c\u4e14\u4e0e\u7236\u8fdb\u7a0b\u5177\u6709\u76f8\u540c\u7684\u8fd4\u56de\u5730\u5740\uff08\u5373\u8fd4\u56de\u5230\u8c03\u7528fork\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff09\uff0c\u6240\u4ee5\u5f53\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u53d7\u8c03\u5ea6\u7ee7\u7eed\u8fd0\u884c\u800c\u4ece\u5185\u6838\u7a7a\u95f4\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u65f6\u90fd\u8fd4\u56de\u5230\u540c\u4e00\u70b9\u4e0a\uff0c\u4f46\u4e8c\u8005\u7684\u8fd4\u56de\u503c\u4e0d\u4e00\u6837\uff0c\u7236\u8fdb\u7a0b\u7684\u8fd4\u56de\u503c\u4e3a\u5b50\u8fdb\u7a0b\u7684pid\uff0c\u800c\u5b50\u8fdb\u7a0b\u7684\u8fd4\u56de\u503c\u4e3a0\u3002\u56e0\u6b64\uff0c\u4ee3\u7801\u4e2d\u53ef\u4ee5\u6839\u636e\u8fd4\u56de\u503c\u6765\u5224\u65ad\u7236\u5b50\u8fdb\u7a0b\u3002","title":"\u76ee\u6807\u7a0b\u5e8f\u7684\u6267\u884c"},{"location":"kernel/PSfork-vfork-clone/","text":"1 \u539f\u578b \u524d\u6587\u5df2\u5927\u81f4\u8bb2\u8fc7fork\u3001vfork\u4e0eclone\u7684\u533a\u522b\uff0c\u5148\u6765\u770b\u770b\u5b83\u4eec\u7684\u539f\u578b\uff1a pid_t fork(void); pid_t vfork(void); int clone(int (*fn)(void *), void *child_stack, int flags, void* arg, ...); fork\u662f\u5168\u9762\u7684\u590d\u5236\u3002 vfork\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u4e3b\u8981\u7528\u4f5c\u521b\u5efa\u8fdb\u7a0b\u7684\u4e2d\u95f4\u6b65\u9aa4\u3002\u65e2\u7136\u65b0\u7684\u8fdb\u7a0b\u6700\u7ec8\u8981\u8c03\u7528execve\u6267\u884c\u65b0\u7684\u76ee\u6807\u7a0b\u5e8f\uff0c\u5e76\u4e0e\u7236\u8fdb\u7a0b\u5206\u9053\u626c\u9573\uff0c\u90a3\u4e48\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\u5b8c\u5168\u662f\u591a\u4f59\u7684\uff0c\u4e8e\u662fvfork\u4fbf\u5e94\u8fd0\u800c\u751f\uff0c\u5176\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5e76\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff08\u8fd9\u4e9b\u8d44\u6e90\u4f1a\u5728execve\u4e2d\u88ab\u66ff\u6362\uff09\u3002 vfork\u4e0efork\u7684\u53e6\u4e00\u4e2a\u4e0d\u540c\u662f\uff0cvfork\u4f1a\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u5728\u5b50\u8fdb\u7a0b\u6267\u884cexecve\u6216\u8005exit\u4e4b\u540e\uff0c\u7236\u8fdb\u7a0b\u624d\u53ef\u80fd\u88ab\u8c03\u5ea6\u8fd0\u884c\u3002 clone\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5e76\u53ef\u4ee5\u6307\u5b9a\u5b50\u7ebf\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u5806\u6808\u7684\u8d77\u59cb\u4f4d\u7f6e\uff08child_stack\u53c2\u6570\uff09\u4ee5\u53ca\u81ea\u7ebf\u7a0b\u7684\u5165\u53e3\uff08\u53c2\u6570fn\uff09\u3002\u540c\u65f6clone\u4e5f\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u6709\u9009\u62e9\u6027\u7684\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff08\u7531\u53c2\u6570flag\u6765\u6307\u5b9a\uff09\u3002 \u8fd9\u51e0\u4e2a\u7cfb\u7edf\u8c03\u7528\u5728\u5185\u6838\u4e2d\u7684\u5b9e\u73b0\u5982\u4e0b\uff082.4.0\u5185\u6838\uff09 arch/kernel/process.c asmlinkage int sys_fork(struct pt_regs regs) { return do_fork(SIGCHLD, regs.esp, regs, 0); } asmlinkage int sys_clone(struct pt_regs regs) { unsigned long clone_flags; unsigned long newsp; clone_flags = regs.ebx; newsp = regs.ecx; if (!newsp) newsp = regs.esp; return do_fork(clone_flags, newsp, regs, 0); } asmlinkage int sys_vfork(struct pt_regs regs) { return do_fork(CLONE_VFORK | CLONE_VM | SIGCHLD, regs.esp, regs, 0); } \u53ef\u89c1\u8fd9\u51e0\u4e2a\u7cfb\u7edf\u8c03\u7528\u6700\u7ec8\u90fd\u662f\u4ee5\u4e0d\u540c\u7684\u53c2\u6570\u8c03\u7528do_fork\u3002\u8fd9\u4e09\u4e2a\u51fd\u6570\u53c2\u6570\u4e2d\u7684pt_regs\u7ed3\u6784\u662f\u7cfb\u7edf\u8c03\u7528\u9677\u5165\u5185\u6838\u7a7a\u95f4\u540e\uff0c\u5bf9\u7528\u6237\u7a7a\u95f4\u4e2dCPU\u5404\u901a\u7528\u5bc4\u5b58\u5668\u7684\u5907\u4efd\u3002\u5bf9sys_clone\u6765\u8bf4\uff0cregs.ebx\u4fdd\u5b58\u7684\u662fclone\u7684\u53c2\u6570flag(flag\u662f\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u4e0d\u662f\u5e94\u8be5\u4fdd\u5b58\u5728edx\u4e2d\u5417\uff1f)\uff0cregs.ecx\u4fdd\u5b58\u7684\u5c31\u662fclone\u7684\u53c2\u6570child_task\u3002 do_fork\u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a int do_fork(unsigned long clone_flags, unsigned long stack_start, struct pt_regs *regs, unsigned long stack_size); \u7b2c\u4e00\u4e2a\u53c2\u6570clone_flags\u5305\u542b\u4e24\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\u4e3a\u5176\u6700\u4f4e\u7684\u5b57\u8282\uff088bit\uff09\u8868\u793a\u4fe1\u53f7\u7c7b\u578b\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\u53bb\u4e16\u65f6\u5185\u6838\u5e94\u8be5\u7ed9\u5176\u7236\u8fdb\u7a0b\u53d1\u4ec0\u4e48\u4fe1\u53f7\u3002fork\u548cvfork\u8bbe\u7f6e\u7684\u4fe1\u53f7\u4e3aSIGCHILD\uff0c\u800cclone\u5219\u7531\u8c03\u7528\u8005\u51b3\u5b9a\u53d1\u4ec0\u4e48\u4fe1\u53f7\u3002 \u7b2c\u4e8c\u90e8\u5206\u662f\u4e00\u4e9b\u8868\u793a\u8d44\u6e90\u6216\u8005\u7279\u6027\u7684\u6807\u5fd7\u4f4d\uff0c\u8fd9\u4e9b\u6807\u5fd7\u4f4d\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a /* * cloning flags: */ #define CSIGNAL 0x000000ff /* signal mask to be sent at exit */ #define CLONE_VM 0x00000100 /* set if VM shared between processes */ #define CLONE_FS 0x00000200 /* set if fs info shared between processes */ #define CLONE_FILES 0x00000400 /* set if open files shared between processes */ #define CLONE_SIGHAND 0x00000800 /* set if signal handlers and blocked signals shared */ #define CLONE_PID 0x00001000 /* set if pid shared */ #define CLONE_PTRACE 0x00002000 /* set if we want to let tracing continue on the child too */ #define CLONE_VFORK 0x00004000 /* set if the parent wants the child to wake it up on mm_release */ #define CLONE_PARENT 0x00008000 /* set if we want to have the same parent as the cloner */ #define CLONE_THREAD 0x00010000 /* Same thread group? */ #define CLONE_SIGNAL (CLONE_SIGHAND | CLONE_THREAD) \u8fd9\u91cc\u7684\u6807\u5fd7\u4f4d\u5982\u679c\u4e3a1\u5219\u8868\u793a\u5bf9\u5e94\u7684\u8d44\u6e90\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\uff08\u201c\u6d45\u62f7\u8d1d\u201d\uff09\u7684\u65b9\u5f0f\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\uff0c\u53cd\u4e4b\u5982\u679c\u4e3a0\u5219\u8981\u8fdb\u884c\u6df1\u5ea6\u62f7\u8d1d\u4e86\u3002\u5176\u4e2dCLONE_PID\u6709\u7279\u6b8a\u7684\u7528\u9014\uff0c\u5b83\u8868\u793a\u7236\u5b50\u8fdb\u7a0b\u5171\u7528\u540c\u4e00\u8fdb\u7a0b\u53f7PID\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b50\u8fdb\u7a0b\u867d\u7136\u6709\u5176\u81ea\u5df1\u7684task_struct\u7ed3\u6784\uff0c\u5374\u4f7f\u7528\u7236\u8fdb\u7a0b\u7684PID\uff0c\u4f46\u662f\u53ea\u67090\u53f7\u8fdb\u7a0b\uff080\u53f7\u8fdb\u7a0b\u4e0d\u662finit\u8fdb\u7a0b\uff0cinit\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u53f7\u4e3a1\uff0c0\u53f7\u8fdb\u7a0b\u7a7a\u8f6c\u8fdb\u7a0b\u5373idle\u8fdb\u7a0b\uff09\u88ab\u5141\u8bb8\u5982\u6b64\u8c03\u7528clone\u3002 \u5bf9\u4e8efork\uff0c\u8fd9\u90e8\u5206\u5168\u4e3a0\uff0c\u8868\u793a\u6240\u6709\u7684\u8d44\u6e90\u90fd\u8981\u590d\u5236\uff08\u201c\u6df1\u62f7\u8d1d\u201d\uff09\uff1b\u800c\u5bf9vfork\uff0c\u5176\u8bbe\u7f6e\u4e86CLONE_VFORK\u548cCLONE_VM\u6807\u5fd7\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\uff08\u7ebf\u7a0b\uff09\u5171\u7528\u7236\u8fdb\u7a0b\uff08\u7528\u6237\u7a7a\u95f4\u7684\uff09\u865a\u5b58\u7a7a\u95f4\uff0c\u5e76\u4e14\u5f53\u5b50\u8fdb\u7a0b\u91ca\u653e\u5176\u865a\u5b58\u533a\u95f4\u65f6\uff0c\u8981\u901a\u77e5\u7236\u8fdb\u7a0b\uff1b\u81f3\u4e8eclone\uff0c\u8fd9\u4e00\u90e8\u5206\u4e5f\u7531\u8c03\u7528\u8005\u8bbe\u5b9a\u3002 \u4e0b\u9762\u5206\u6790\u4e0bdo_fork\u7684\u6d41\u7a0b\uff0c\u5982\u679c\u8bfb\u8005\u7406\u89e3\u6d45\u62f7\u8d1d\u548c\u6df1\u62f7\u8d1d\uff0c\u90a3\u4e48\u590d\u5236\u7684\u8fc7\u7a0b\u5f88\u597d\u7406\u89e3\u3002 2 do_fork\u6d41\u7a0b 2.1 \u603b\u4f53\u6d41\u7a0b\u56fe \u4e0b\u9762\u5bf9\u6d41\u7a0b\u4e2d\u7684\u91cd\u70b9\u51fd\u6570\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002 2.2 get_pid \u4e00\u822c\u6765\u8bb2\uff0c\u5c06\u4e0a\u4e00\u4e2a\u8fdb\u7a0b\u7684PID\u52a01\u5373\u53ef\u5f97\u5230\u65b0\u8fdb\u7a0b\u7684PID\uff0c\u4f46\u7cfb\u7edf\u4e2d\u89c4\u5b9aPID\u4e0d\u80fd\u2265PID_MAX\uff08PID_MAX \u5b9a\u4e49\u4e3a0x8000\uff0c\u53ef\u89c1\u6700\u5927\u7684PID\u53f7\u4e3a0x7fff\u537332767\uff09\u3002\u5982\u679cPID\u2265PID_MAX\uff0c\u5219\u8981\u56de\u8fc7\u5934\u53bb\u201c\u6361\u6f0f\u201d\uff1a\u67d0\u4e9b\u8fdb\u7a0b\u5df2\u7ecf\u53bb\u4e16\u4e86\uff0c\u4e4b\u524d\u5206\u914d\u7ed9\u4ed6\u4eec\u7684PID\u53ef\u4ee5\u91cd\u65b0\u5229\u7528\u4e86\u3002\u6ce8\u610f\u6361\u6f0f\u8981\u4ecePID\u4e3a300\u5f00\u59cb\u626b\u63cf\uff0c\u56e0\u4e3a300\u4ee5\u5185\uff080~299\uff09\u7684PID\u4fdd\u7559\u7ed9\u7cfb\u7edf\u8fdb\u7a0b\u4f7f\u7528\uff08\u5305\u62ec\u5185\u6838\u7ebf\u7a0b\u548c\u5404\u201c\u5b88\u62a4\u795e\u201d\u8fdb\u7a0b\uff09\u3002\u5982\u679c\u626b\u63cf\u53ea\u4e3a\u627e\u5230\u4e00\u4e2a\u53ef\u7528\u7684PID\uff0c\u663e\u7136\u4e0d\u5212\u7b97\uff0c\u6700\u597d\u662f\u80fd\u627e\u5230\u4e00\u4e2a\u53ef\u7528PID\u7684\u533a\u95f4\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u627e\u5230\u7b2c\u4e00\u4e2a\u53ef\u7528\u7684PID\uff09\u3002\u8fd9\u6837\u4e0b\u4e00\u6b21\u518d\u521b\u5efa\u8fdb\u7a0b\u65f6\uff0c\u76f4\u63a5\u4ece\u53ef\u7528PID\u533a\u95f4\u4e2d\u53d6\u4e0b\u4e00\u4e2aPID\u5373\u53ef\u3002 2.3 copy_files task_struct\u7ed3\u6784\u6709\u4e00\u4e2afiles\u6210\u5458\uff0c\u5176\u4e3astruct files_struct\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u5411\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u7684\u4fe1\u606f\uff0ccopy_files\u51fd\u6570\u5b8c\u6210\u8be5\u6307\u9488\u7684\u6df1\u5ea6\u62f7\u8d1d\u3002files_struct\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a /* * Open file table structure */ struct files_struct { atomic_t count; rwlock_t file_lock; int max_fds; int max_fdset; int next_fd; struct file ** fd; /* current fd array */ fd_set *close_on_exec; fd_set *open_fds; fd_set close_on_exec_init; fd_set open_fds_init; struct file * fd_array[NR_OPEN_DEFAULT]; }; files_struct\u7ed3\u6784\u4e3b\u8981\u6709\u4e09\u4e2a\u90e8\u4ef6\uff1a\u5176\u4e00\u662f\u4e2a\u4f4d\u56fe\uff08\u6307\u9488\uff09close_on_exec\uff0c\u8868\u793a\u5728\u8fdb\u7a0b\u6267\u884cexce\u65f6\u9700\u8981close\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u4e2a\u6210\u5458close_on_exec_init\u7684\u5730\u5740\uff1b\u5176\u4e8c\u4e5f\u662f\u4e00\u4e2a\u4f4d\u56fe\uff08\u6307\u9488\uff09open_fds\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u6210\u5458open_fds_init\u7684\u5730\u5740\uff1b\u5176\u4e09\u4e3a\u6307\u5411\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u6307\u9488\u6570\u7ec4\u7684\u6307\u9488fd\uff0c\u6307\u5411\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u8868\u9879\u6570\u7ec4\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u6210\u5458fd_array\u7684\u5730\u5740\u3002\u7531\u4e8e\u4f4d\u56fe\uff08fd_set\uff09\u80fd\u591f\u8868\u793a\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a1024\uff08fd_set\u5171\u67091024\u4e2abit\uff09\uff0c\u800cfd_array\u6570\u7ec4\u7684\u5927\u5c0f\u56fa\u5b9a\u4e3aNR_OPEN_DEFAULT\uff0c\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u6570\u53ef\u80fd\u8d85\u8fc7NR_OPEN_DEFAULT\uff0c\u6216\u8005fd_set(1024\u4e2abit)\u5df2\u7ecf\u65e0\u6cd5\u5bb9\u7eb3\u6700\u5927\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u5bf9\u8fd9\u4e2a\u4e09\u4e2a\u90e8\u4ef6\u8fdb\u884c\u6269\u5c55\uff0c\u800c\u8fd9\u4e09\u4e2a\u6307\u9488\u5219\u6307\u5411\u7ed3\u6784\u4f53\u5916\u7684\u67d0\u4e2a\u5730\u5740\u3002 \u5982\u6709\u9700\u8981\uff08clone_flag\u4e2d\u5bf9\u5e94\u7684\u6807\u5fd7\u4f4d\u4e3a0\uff0c\u4e0b\u540c\uff09\uff0ccopy_files\u5c06\u6267\u884c\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\uff0c\u8fd9\u91cc\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u4e3b\u8981\u662f\u8fd9\u4e09\u4e2a\u90e8\u4ef6\u7684\u62f7\u8d1d\uff0c\u5728\u62f7\u8d1d\u65f6\u8981\u5224\u65ad\u7236\u8fdb\u7a0b\u7684\u4e09\u4e2a\u90e8\u4ef6\u662f\u5426\u5df2\u8fdb\u884c\u8fc7\u6269\u5c55\uff0c\u5982\u679c\u662f\u5219\u5b50\u8fdb\u7a0b\u7684\u4e09\u4e2a\u90e8\u4ef6\u4e5f\u8981\u8fdb\u884c\u6269\u5c55\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u6240\u8c13\u7684\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u53ea\u662f\u4e2d\u95f4\u5c42\u6b21\u7684\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u3002\u4ee5fd\u4e3a\u4f8b\uff0cfd\u4e3a\u6307\u5411\u6307\u9488\u6570\u7ec4\u7684\u6307\u9488\uff0c\u62f7\u8d1d\u4e4b\u540e\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u4e00\u5757\u5b58\u50a8\u7a7a\u95f4\uff0c\u7528\u6765\u5b58\u653e\u6240\u6709\u7684\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u7684\u6307\u9488\uff0c\u4f46\u662f\u5e76\u672a\u6267\u884c\u66f4\u6df1\u5c42\u6b21\u7684\u62f7\u8d1d\uff0c\u5e76\u6ca1\u6709\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u8868\u9879\u6307\u9488\u6240\u6307\u5411\u7684\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u8fdb\u884c\u62f7\u8d1d\u3002\u7236\u5b50\u8fdb\u7a0b\u6bcf\u4e2a\u76f8\u540c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5171\u4eab\u540c\u4e00\u4e2a\u6587\u4ef6\u8868\u9879 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u53ef\u89c1\uff0cfork\u4e4b\u540e\uff0c\u5f53\u5b50\u8fdb\u7a0b\u901a\u8fc7lseek\u79fb\u52a8\u67d0\u4e2a\u6587\u4ef6\u7684\u201c\u5f53\u524d\u6587\u4ef6\u504f\u79fb\u91cf\u201d\u65f6\uff0c\u7531\u4e8e\u8fd9\u4e2a\u504f\u79fb\u91cf\u8bb0\u5f55\u5728\u6587\u4ef6\u8868\u9879file\u4e2d\uff0c\u7236\u8fdb\u7a0b\u4e2d\u5bf9\u5e94\u6587\u4ef6\u7684\u201c\u5f53\u524d\u6587\u4ef6\u504f\u79fb\u91cf\u201d\u4e5f\u4f1a\u88ab\u66f4\u65b0\uff0c\u8fd9\u5c31\u662f\u5728\u7236\u5b50\u8fdb\u7a0b\u4e2d\u540c\u65f6\u5f80\u6807\u51c6\u8f93\u51fa\u4e2d\u6253\u5370\u4fe1\u606f\u65f6\u4e0d\u4f1a\u91cd\u53e0\u7684\u539f\u56e0\u3002\u7f55\u89c1\u7684\uff0c\u300a\u60c5\u666f\u5206\u6790\u300b\u5173\u4e8e\u8fd9\u4e00\u70b9\u7684\u63cf\u8ff0\u6709\u8bef\u3002 2.4 copy_sighand task_struct\u7ed3\u6784\u4e2d\u6709\u4e00sig\u6210\u5458\uff0c\u5176\u4e3astruct signal_struct\u7c7b\u578b\uff0c\u540e\u8005\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a struct signal_struct { atomic_t count; struct k_sigaction action[_NSIG]; spinlock_t siglock; }; \u5176\u6838\u5fc3\u6210\u5458action\u4e3a\u4e00\u6570\u7ec4\uff0c\u6307\u5b9a\u4e86\u5404\u4e2a\u4fe1\u53f7\u7684\u5904\u7406\u65b9\u5f0f\u3002_NSIG\u5373\u4e3a\u4fe1\u53f7\u7684\u6700\u5927\u503c64\u3002copy_sighand\u6240\u6267\u884c\u7684\u6df1\u5ea6\u62f7\u8d1d\u5c31\u662f\u5c06action\u6570\u7ec4\u62f7\u8d1d\u4e00\u4efd\u5230\u5b50\u8fdb\u7a0b\u3002 2.5 copy_mm task_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2a\u6307\u9488mm\uff0c\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u5f88\u719f\u6089\u4e86\uff0c\u5176\u4e3amm_struct\u7ed3\u6784\u7c7b\u578b\uff0c\u4ee3\u8868\u4e86\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u3002mm_struct\u4e2d\u7528\u4e24\u4e2a\u91cd\u8981\u7684\u6210\u5458\uff0c\u5176\u4e00\u4e3avm_area_struct\u7c7b\u578b\u7684\u6307\u9488mmap\uff0c\u4ee3\u8868\u7740\u7528\u6237\u7a7a\u95f4\u7684\u6240\u6709\u201c\u865a\u5b58\u7a7a\u95f4\u201d\uff1b\u5176\u4e8c\u4e3apgd\uff0c\u9886\u8854\u7740\u201c\u865a\u5b58\u533a\u95f4\u201d\u7684\u9875\u9762\u6620\u5c04\u3002\u76f8\u5e94\u7684\uff0ccopy_mm\u6240\u6267\u884c\u7684\u6df1\u5ea6\u62f7\u8d1d\u4e5f\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u201c\u865a\u5b58\u533a\u95f4\u201d\u7684\u62f7\u8d1d\u548c\u9875\u9762\u8868\u7684\u62f7\u8d1d\u3002 \u6ce8\u610f\uff0c\u5728\u62f7\u8d1d\u9875\u8868\u65f6\uff0c\u53ea\u662f\u4e3a\u5b50\u8fdb\u7a0b\u7684\u9875\u8868\u5206\u914d\u4e86\u5b58\u50a8\u7a7a\u95f4\uff0c\u9875\u9762\u8868\u9879\uff08pte_t\uff09\u7684\u5185\u5bb9\u4e0e\u7236\u8fdb\u7a0b\u4e00\u81f4\u3002\u8fd9\u610f\u5473\u7740\u9488\u5bf9\u6bcf\u4e00\u4e2a\u9875\u9762\u8868\u9879\uff0c\u5b50\u8fdb\u7a0b\u5e76\u6ca1\u6709\u50cf\u6211\u4eec\u60f3\u8c61\u7684\u90a3\u6837\uff0c\u91cd\u65b0\u7533\u8bf7\u4e00\u4e2apage\uff0c\u4ece\u7236\u8fdb\u7a0b\u90a3\u91cc\u62f7\u8d1d\u4e00\u4e2apage\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5c06\u65b0page\u7684\u5730\u5740\u548c\u4fdd\u62a4\u5c5e\u6027\u5199\u5165\u9875\u9762\u8868\u9879\u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u505a\u6cd5\u662f\uff1a\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\u4ecd\u7136\u6307\u5411\u7236\u8fdb\u7a0b\u4e2d\u7684page\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2apage\u7684\u4fdd\u62a4\u5c5e\u6027\u8bbe\u7f6e\u6210\u201c\u53ea\u8bfb\u201d\uff0c\u5e76\u5c06\u4fdd\u62a4\u5c5e\u6027\u540c\u65f6\u8bbe\u7f6e\u8fdb\u7236\u3001\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\u4e2d\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5f53\u4e0d\u7ba1\u7236\u8fdb\u7a0b\u8fd8\u662f\u5b50\u8fdb\u7a0b\u4f01\u56fe\u5199\u5165\u8fd9\u4e2a\u9875\u9762\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1\u5f02\u5e38\u9875\u9762\u5f02\u5e38\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9875\u9762\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u4f1a\u91cd\u65b0\u5206\u914d\u4e00\u4e2apage\uff0c\u5e76\u628a\u5185\u5bb9\u590d\u5236\u8fc7\u6765\uff0c\u5e76\u66f4\u65b0\u7236\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\uff08\u5c06\u4fdd\u62a4\u5c5e\u6027\u8bbe\u7f6e\u6210\u53ef\u5199\uff09\uff0c\u8ba9\u7236\u5b50\u8fdb\u7a0b\u62e5\u6709\u5404\u81ea\u7684\u7269\u7406page\u3002\u8fd9\u5c31\u662fcopy_on_write\u6280\u672f\u3002linux\u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u7684\u590d\u5236\u51fa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b8c\u5168\u5f52\u529f\u4e8ecopy on write\u6280\u672f\uff08\u5426\u5219\u7684\u8bdd\uff0c\u5728fork\u65f6\uff0c\u5c31\u5f97\u8001\u8001\u5b9e\u5b9e\u7684\u5206\u914d\u4e00\u4e2a\u4e00\u4e2a\u7684\u7269\u7406\u9875\u9762\uff0c\u5e76\u5c06\u9875\u9762\u7684\u5185\u5bb9\u62f7\u8d1d\u8fc7\u6765\uff09\u3002 2.6 copy_thread \u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\u8fdb\u7a0b\u7684\u7cfb\u7edf\u7a7a\u95f4\u4e3a\u4e24\u4e2a\u9875\u9762\u53738K\u7684\u7a7a\u95f4\uff0c\u5e95\u7aef\u4e3atask_struct\u7ed3\u6784\uff0ctask_struct\u7ed3\u6784\u4e4b\u4e0a\u4e3a\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u3002\u5176\u5b9e\uff0c\u5728\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e4b\u4e0a\u53738K\u7a7a\u95f4\u7684\u9876\u7aef\uff0c\u5b58\u653e\u7684\u662fpt_regs\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a pt_regs\u7ed3\u6784\u4fdd\u5b58\u7740\u8fdb\u5165\u5185\u6838\u524d\u5915CPU\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u8fd9\u53ef\u662f\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u7684\u91cd\u8981\u201c\u73b0\u573a\u201d\uff0c\u5bf9\u4e8e\u521a\u521a\u51fa\u751f\u7684\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u4e9b\u4fe1\u606f\u53ea\u80fd\u4ece\u7236\u8fdb\u7a0b\u62f7\u8d1d\u800c\u6765\uff0c\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u7236\u5b50\u8fdb\u7a0b\u624d\u53ef\u4ee5\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u7684\u540c\u4e00\u4e2a\u5730\u65b9\u3002 copy_thread\u7684\u4ee3\u7801\u6bd4\u8f83\u6709\u8da3\uff0c\u6211\u4eec\u6765\u770b\u770b\uff1a arch/kernel/process.c 529 int copy_thread(int nr, unsigned long clone_flags, unsigned long esp, 530 unsigned long unused, 531 struct task_struct * p, struct pt_regs * regs) 532 { 533 struct pt_regs * childregs; 534 535 childregs = ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) - 1; 536 struct_cpy(childregs, regs); 537 childregs- eax = 0; 538 childregs- esp = esp; 539 540 p- thread.esp = (unsigned long) childregs; 541 p- thread.esp0 = (unsigned long) (childregs+1); 542 543 p- thread.eip = (unsigned long) ret_from_fork; 544 545 savesegment(fs,p- thread.fs); 546 savesegment(gs,p- thread.gs); 547 548 unlazy_fpu(current); 549 struct_cpy( p- thread.i387, current- thread.i387); 550 551 return 0; 552 } \u53c2\u6570\u4e2d\u7684p\u6307\u5411\u65b0\u521b\u5efa\u7684\u5b50\u8fdb\u7a0b\uff1b\u800cregs\u5219\u6765\u81ea\u7236\u8fdb\u7a0b\uff1besp\u6307\u5411\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\u7684\u5806\u6808\u7684\u6808\u9876\uff0c\u5bf9fork\u4e0evfork\u800c\u8a00\uff0cesp\u6765\u81earegs.esp\u5373\u7236\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u5730\u5740\u7684\u6808\u9876\uff0c\u5bf9clone\u800c\u8a00\uff0c\u6808\u9876esp\u53ef\u6709\u8c03\u7528\u8005\u6307\u5b9a\u3002 \u9996\u5148\uff0c\u8981\u786e\u5b9a\u5728\u8fdb\u7a0b\u7684\u7cfb\u7edf\u7a7a\u95f4\u4e2dpt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\uff0c\u8fd9\u662f535\u884c\u7684\u4f5c\u7528\u3002\u9010\u6b65\u62c6\u89e3\u5982\u4e0b\uff1a (THREAD_SIZE + (unsigned long) p) \u5b9a\u4f4d\u5230\u5b50\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\uff088K\uff09\u7684\u4e0a\u8fb9\u754c\uff1b ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) \u5c06\u7cfb\u7edf\u7a7a\u95f4\u7684\u4e0a\u8fb9\u754c\u5f3a\u8f6c\u6210struct pt_regs\u7c7b\u578b\u7684\u6307\u9488\uff1b ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) \u2013 1\uff0c\u5728struct pt_regs\u7c7b\u578b\u7684\u6307\u9488\u7c7b\u578b\u7684\u6307\u9488\u4e0a\u6267\u884c\u51cf1\u64cd\u4f5c\uff0c\u6307\u9488\u540e\u79fbsizeof(struct pt_regs)\u4e2a\u5b58\u50a8\u5355\u5143\uff0c\u4e8e\u662f\u5b9a\u4f4d\u5230pt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\u3002 \u5176\u6b21\uff0c\u5b50\u8fdb\u7a0b\u7684pt_regs\u62f7\u8d1d\u81ea\u7236\u8fdb\u7a0b\uff08\u7b2c536\u884c\uff09\uff0c\u4f46\u4e5f\u8981\u8fdb\u884c\u4e9b\u201c\u4fee\u8865\u201d\u3002\u7b2c537\u884c\u4fee\u6539\u5b50\u8fdb\u7a0b\u5728\u7528\u6237\u7a7a\u95f4\u7684\u8fd4\u56de\u503c\u4e3a0\uff1b\u7b2c538\u884c\u4fee\u6539\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\u7684\u6808\u9876esp\u3002 \u53e6\u5916\uff0ctask_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2athread\u6210\u5458\uff0c\u5176\u4e3astruct thread_struct\u7c7b\u578b\uff0c\u91cc\u9762\u5b58\u653e\u7740\u8fdb\u7a0b\u5728\u5207\u6362\u65f6\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u6808\u9876esp\u3001\u4e0b\u4e00\u6761\u6307\u4ee4eip\uff08\u8fdb\u7a0b\u518d\u6b21\u88ab\u5207\u6362\u8fd0\u884c\u65f6\uff0c\u5c06\u4ece\u8fd9\u91cc\u5f00\u59cb\u8fd0\u884c\uff09\u7b49\u5173\u952e\u4fe1\u606f\u3002\u5728\u590d\u5236task_struct\u7ed3\u6784\u65f6\uff0c\u8fd9\u4e9b\u5185\u5bb9\u539f\u5c01\u4e0d\u52a8\u4ece\u7236\u8fdb\u7a0b\u62f7\u8d1d\u8fc7\u6765\uff0c\u73b0\u5728\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e86\uff0c\u6240\u4ee5\u8981\u9002\u5f53\u7684\u52a0\u4ee5\u8c03\u6574\u3002\u7b2c540\u884c\u5c06p- thread.esp\u8bbe\u7f6e\u6210pt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\uff08\u6ce8\u610f\u5806\u6808\u662f\u5411\u4e0b\u6269\u5c55\u7684\uff09\uff0c\u4ece\u8c03\u5ea6\u5668\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5c31\u597d\u50cf\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u4ee5\u524d\u66fe\u7ecf\u8fdb\u5165\u5185\u6838\u8fd0\u884c\u8fc7\uff0c\u800c\u5728\u5185\u6838\u4e2d\u7684\u4efb\u52a1\u5904\u7406\u5b8c\u6bd5\uff08\u56e0\u6b64\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u6062\u590d\u5e73\u8861\uff0c\u53d8\u6210\u201c\u7a7a\u201d\u5806\u6808\uff09\u51c6\u5907\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\u65f6\u88ab\u5207\u6362\u4e86\uff1b\u800cp- thread.esp0\u5219\u5e94\u6307\u5411\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u9876\u7aef\uff0c\u8868\u793a\u8fd9\u4e2a\u8fdb\u7a0b\u8fdb\u51650\u7ea7\uff08\u5185\u6838\u7a7a\u95f4\uff09\u8fd0\u884c\u65f6\uff0c\u5176\u5806\u6808\u7684\u4f4d\u7f6e\u3002\u7b2c543\u884c\uff0cp- thread.eip\u88ab\u8d4b\u503c\u4e3aret_from_fork\uff0c\u5f53\u5b50\u8fdb\u7a0b\u8c03\u5ea6\u8fd0\u884c\u65f6\uff08\u80af\u5b9a\u5148\u4ece\u7cfb\u7edf\u7a7a\u95f4\u8fd0\u884c\uff09\uff0c\u5c06\u4eceret_from_fork\u5904\u5f00\u59cb\u8fd0\u884c\u3002 2.7 vfork\u662f\u5982\u4f55\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\u7684 \u524d\u6587\u63d0\u5230\uff0cvfork\u4f1a\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u5728\u5b50\u8fdb\u7a0b\u6267\u884cexecve\u6216\u8005exit\u4e4b\u540e\uff0c\u7236\u8fdb\u7a0b\u624d\u53ef\u80fd\u88ab\u8c03\u5ea6\u8fd0\u884c\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u9700\u6c42\uff0ctask_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff08struct semaphore\uff09\u7c7b\u578b\u7684\u6307\u9488vfork_sem\u3002\u5728do_fork\u51fd\u6570\u5f00\u59cb\u4f4d\u7f6e\uff0c\u521d\u59cb\u5316\u4e86\u4e00\u4e2a\u5c40\u90e8\u4fe1\u53f7\u91cfsem\uff0c\u5e76\u5c06sem\u7684\u5730\u5740\u8d4b\u7ed9\u7236\u8fdb\u7a0b\u7684task_struct.vfork_sem\uff08\u6d41\u7a0b\u56fe\u4e2d\u9ec4\u8272\u6807\u6ce8\u7684\u90e8\u5206\uff09\u3002\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u8ba1\u6570\u4e3a0\uff0c\u610f\u5473\u7740\u6b64\u65f6\u5bf9\u4fe1\u53f7\u91cf\u6267\u884cdown\u64cd\u4f5c\uff0c\u8fdb\u7a0b\u5c06\u88ab\u963b\u585e\u3002do_fork\u5728\u5b8c\u6210\u5b50\u8fdb\u7a0b\u7684\u201c\u590d\u5236\u201d\u4ee5\u540e\uff0c\u8c03\u7528wake_up_process\u5524\u9192\u5b50\u8fdb\u7a0b\uff0c\u800c\u81ea\u5df1\u5219\u8c03\u7528down( sem)\u8fdb\u5165\u7761\u7720\u3002 \u5728\u5b50\u8fdb\u7a0b\u8c03\u7528exec\u6216\u8005exit\u65f6\uff0c\u90fd\u4f1a\u8c03\u7528mm_release\uff0c\u5728\u8be5\u51fd\u6570\u4e2d\uff0cup(tsk- p_opptr- vfork_sem)\u589e\u52a0\u4e86\u7236\u8fdb\u7a0bvfork_sem\u7684\u8ba1\u6570\uff0c\u4e8e\u662f\u7236\u8fdb\u7a0b\u88ab\u5524\u9192\u3002 void mm_release(void) { struct task_struct *tsk = current; /* notify parent sleeping on vfork() */ if (tsk- flags PF_VFORK) { tsk- flags = ~PF_VFORK; up(tsk- p_opptr- vfork_sem); } } \u4ed4\u7ec6\u60f3\u6765\uff0cvfork\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u4e0d\u89c1\u5f97\u662f\u5185\u6838\u201c\u7cbe\u5fc3\u201d\u4e3alinux\u7528\u6237\u5b9e\u73b0\u7684\u7279\u6027\uff0c\u5012\u50cf\u662f\u5185\u6838\u7684\u65e0\u5948\u4e4b\u4e3e\u3002\u6211\u4eec\u77e5\u9053vfork\u7cfb\u7edf\u8c03\u7528\uff0c\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\uff0c\u5b50\u8fdb\u7a0b\u5bf9\u7528\u6237\u7a7a\u95f4\u7684\u4fee\u6539\u4f1a\u53cd\u8fc7\u6765\u5f71\u54cd\u7236\u8fdb\u7a0b\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u5982\u679c\u8bf4\u7236\u5b50\u8fdb\u7a0b\u5404\u81ea\u4fee\u6539\u6570\u636e\u533a\u7684\u6570\u636e\u662f\u5371\u9669\u7684\u8bdd\uff0c\u90a3\u4e48\u4fee\u6539\u5806\u6808\u90a3\u5c31\u662f\u81f4\u547d\u7684\u4e86\u3002\u800c\u6070\u5de7\u5b50\u8fdb\u7a0b\u7d27\u63a5\u7740\u5c31\u4f1a\u8c03\u7528exec\uff08\u6216\u8005exit\uff09\uff0c\u800c\u51fd\u6570\u8c03\u7528\u6d89\u53ca\u5230\u4f20\u53c2\uff0c\u6d89\u53ca\u5230\u8bbe\u7f6e\u8fd4\u56de\u5730\u5740\u8fd9\u4e9b\u90fd\u4f1a\u4fee\u6539\u5806\u6808\u3002\u6240\u4ee5\u51b3\u4e0d\u80fd\u8ba9\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u56de\u5230\u7528\u6237\u7a7a\u95f4\u5e76\u53d1\u7684\u8fd0\u884c\uff0c\u5fc5\u987b\u6263\u7559\u5176\u4e2d\u7684\u4e00\u4e2a\uff0c\u800c\u53ea\u8ba9\u4e00\u4e2a\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u53bb\u8fd0\u884c\uff0c\u76f4\u5230\u4e24\u4e2a\u8fdb\u7a0b\u4e0d\u518d\u5171\u4eab\u7528\u6237\u7a7a\u95f4\uff08\u5b50\u8fdb\u7a0b\u6267\u884cexec\uff09\u6216\u8005\u5176\u4e2d\u4e4b\u4e00\u6d88\u4ea1\uff08\u5fc5\u7136\u662f\u5148\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\u7684\u5b50\u8fdb\u7a0b\uff09\u4e3a\u6b62\u3002 \u5373\u4f7f\u5982\u6b64\uff0c\u4e5f\u8fd8\u662f\u6709\u5371\u9669\uff0c\u5b50\u8fdb\u7a0b\u7edd\u5bf9\u4e0d\u80fd\u4ece\u8c03\u7528vfork\u7684\u90a3\u4e2a\u51fd\u6570\uff08caller\uff09\u4e2d\u8fd4\u56de\uff08\u6bd4\u5982vfork\u4e4b\u540e\u5b50\u8fdb\u7a0b\u8c03\u7528return\uff09\uff0c\u56e0\u4e3a\u51fd\u6570\u8fd4\u56de\u65f6\uff0c\u6808\u4f1a\u88ab\u6062\u590d\u5e73\u8861\uff0c\u4e4b\u524d\u7528\u6765\u5b58\u653ecaller\u7684\u51fd\u6570\u53c2\u6570\u548c\u51fd\u6570\u8fd4\u56de\u5730\u5740\u7684\u5185\u5b58\u5355\u5143\u88ab\u56de\u6536\uff0c\u4e4b\u540e\uff0c\u8fd9\u4e9b\u5185\u5b58\u5355\u5143\u53ef\u80fd\u88ab\u7528\u6765\u5b58\u653e\u5176\u4ed6\u7684\u5185\u5bb9\u3002\u7b49\u5230\u5b50\u8fdb\u7a0b\u53bb\u4e16\u7236\u8fdb\u7a0b\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u867d\u7136\u7236\u8fdb\u7a0b\u867d\u7136\u6709\u81ea\u5df1\u7684esp\uff08\u4fdd\u5b58\u5728pt_regs\u4e2d\uff09\uff0c\u4f46\u6808\u4e2d\u4fdd\u5b58\u7684caller\u7684\u8fd4\u56de\u5730\u5740\u88ab\u7834\u574f\u4e86\uff08esp\u4e4b\u4e0a\u7684\u5185\u5bb9\u90fd\u88ab\u7834\u574f\uff09\uff0c\u8fd9\u662f\u5f88\u5371\u9669\u7684\u3002\u6240\u4ee5vfork\u5b9e\u9645\u4e0a\u662f\u5efa\u7acb\u5728\u5b50\u8fdb\u7a0b\u5728\u521b\u5efa\u540e\u7acb\u5373\u5c31\u4f1a\u8c03\u7528execve\u7684\u524d\u63d0\u4e4b\u4e0a\u7684\u3002","title":"fork-vfork-clone"},{"location":"kernel/PSfork-vfork-clone/#1","text":"\u524d\u6587\u5df2\u5927\u81f4\u8bb2\u8fc7fork\u3001vfork\u4e0eclone\u7684\u533a\u522b\uff0c\u5148\u6765\u770b\u770b\u5b83\u4eec\u7684\u539f\u578b\uff1a pid_t fork(void); pid_t vfork(void); int clone(int (*fn)(void *), void *child_stack, int flags, void* arg, ...); fork\u662f\u5168\u9762\u7684\u590d\u5236\u3002 vfork\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u4e3b\u8981\u7528\u4f5c\u521b\u5efa\u8fdb\u7a0b\u7684\u4e2d\u95f4\u6b65\u9aa4\u3002\u65e2\u7136\u65b0\u7684\u8fdb\u7a0b\u6700\u7ec8\u8981\u8c03\u7528execve\u6267\u884c\u65b0\u7684\u76ee\u6807\u7a0b\u5e8f\uff0c\u5e76\u4e0e\u7236\u8fdb\u7a0b\u5206\u9053\u626c\u9573\uff0c\u90a3\u4e48\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\u5b8c\u5168\u662f\u591a\u4f59\u7684\uff0c\u4e8e\u662fvfork\u4fbf\u5e94\u8fd0\u800c\u751f\uff0c\u5176\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5e76\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff08\u8fd9\u4e9b\u8d44\u6e90\u4f1a\u5728execve\u4e2d\u88ab\u66ff\u6362\uff09\u3002 vfork\u4e0efork\u7684\u53e6\u4e00\u4e2a\u4e0d\u540c\u662f\uff0cvfork\u4f1a\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u5728\u5b50\u8fdb\u7a0b\u6267\u884cexecve\u6216\u8005exit\u4e4b\u540e\uff0c\u7236\u8fdb\u7a0b\u624d\u53ef\u80fd\u88ab\u8c03\u5ea6\u8fd0\u884c\u3002 clone\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5e76\u53ef\u4ee5\u6307\u5b9a\u5b50\u7ebf\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u5806\u6808\u7684\u8d77\u59cb\u4f4d\u7f6e\uff08child_stack\u53c2\u6570\uff09\u4ee5\u53ca\u81ea\u7ebf\u7a0b\u7684\u5165\u53e3\uff08\u53c2\u6570fn\uff09\u3002\u540c\u65f6clone\u4e5f\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u6709\u9009\u62e9\u6027\u7684\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff08\u7531\u53c2\u6570flag\u6765\u6307\u5b9a\uff09\u3002 \u8fd9\u51e0\u4e2a\u7cfb\u7edf\u8c03\u7528\u5728\u5185\u6838\u4e2d\u7684\u5b9e\u73b0\u5982\u4e0b\uff082.4.0\u5185\u6838\uff09 arch/kernel/process.c asmlinkage int sys_fork(struct pt_regs regs) { return do_fork(SIGCHLD, regs.esp, regs, 0); } asmlinkage int sys_clone(struct pt_regs regs) { unsigned long clone_flags; unsigned long newsp; clone_flags = regs.ebx; newsp = regs.ecx; if (!newsp) newsp = regs.esp; return do_fork(clone_flags, newsp, regs, 0); } asmlinkage int sys_vfork(struct pt_regs regs) { return do_fork(CLONE_VFORK | CLONE_VM | SIGCHLD, regs.esp, regs, 0); } \u53ef\u89c1\u8fd9\u51e0\u4e2a\u7cfb\u7edf\u8c03\u7528\u6700\u7ec8\u90fd\u662f\u4ee5\u4e0d\u540c\u7684\u53c2\u6570\u8c03\u7528do_fork\u3002\u8fd9\u4e09\u4e2a\u51fd\u6570\u53c2\u6570\u4e2d\u7684pt_regs\u7ed3\u6784\u662f\u7cfb\u7edf\u8c03\u7528\u9677\u5165\u5185\u6838\u7a7a\u95f4\u540e\uff0c\u5bf9\u7528\u6237\u7a7a\u95f4\u4e2dCPU\u5404\u901a\u7528\u5bc4\u5b58\u5668\u7684\u5907\u4efd\u3002\u5bf9sys_clone\u6765\u8bf4\uff0cregs.ebx\u4fdd\u5b58\u7684\u662fclone\u7684\u53c2\u6570flag(flag\u662f\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u4e0d\u662f\u5e94\u8be5\u4fdd\u5b58\u5728edx\u4e2d\u5417\uff1f)\uff0cregs.ecx\u4fdd\u5b58\u7684\u5c31\u662fclone\u7684\u53c2\u6570child_task\u3002 do_fork\u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a int do_fork(unsigned long clone_flags, unsigned long stack_start, struct pt_regs *regs, unsigned long stack_size); \u7b2c\u4e00\u4e2a\u53c2\u6570clone_flags\u5305\u542b\u4e24\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\u4e3a\u5176\u6700\u4f4e\u7684\u5b57\u8282\uff088bit\uff09\u8868\u793a\u4fe1\u53f7\u7c7b\u578b\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\u53bb\u4e16\u65f6\u5185\u6838\u5e94\u8be5\u7ed9\u5176\u7236\u8fdb\u7a0b\u53d1\u4ec0\u4e48\u4fe1\u53f7\u3002fork\u548cvfork\u8bbe\u7f6e\u7684\u4fe1\u53f7\u4e3aSIGCHILD\uff0c\u800cclone\u5219\u7531\u8c03\u7528\u8005\u51b3\u5b9a\u53d1\u4ec0\u4e48\u4fe1\u53f7\u3002 \u7b2c\u4e8c\u90e8\u5206\u662f\u4e00\u4e9b\u8868\u793a\u8d44\u6e90\u6216\u8005\u7279\u6027\u7684\u6807\u5fd7\u4f4d\uff0c\u8fd9\u4e9b\u6807\u5fd7\u4f4d\u5b9a\u4e49\u5728 \u6587\u4ef6\u4e2d\uff1a /* * cloning flags: */ #define CSIGNAL 0x000000ff /* signal mask to be sent at exit */ #define CLONE_VM 0x00000100 /* set if VM shared between processes */ #define CLONE_FS 0x00000200 /* set if fs info shared between processes */ #define CLONE_FILES 0x00000400 /* set if open files shared between processes */ #define CLONE_SIGHAND 0x00000800 /* set if signal handlers and blocked signals shared */ #define CLONE_PID 0x00001000 /* set if pid shared */ #define CLONE_PTRACE 0x00002000 /* set if we want to let tracing continue on the child too */ #define CLONE_VFORK 0x00004000 /* set if the parent wants the child to wake it up on mm_release */ #define CLONE_PARENT 0x00008000 /* set if we want to have the same parent as the cloner */ #define CLONE_THREAD 0x00010000 /* Same thread group? */ #define CLONE_SIGNAL (CLONE_SIGHAND | CLONE_THREAD) \u8fd9\u91cc\u7684\u6807\u5fd7\u4f4d\u5982\u679c\u4e3a1\u5219\u8868\u793a\u5bf9\u5e94\u7684\u8d44\u6e90\u901a\u8fc7\u6307\u9488\u62f7\u8d1d\uff08\u201c\u6d45\u62f7\u8d1d\u201d\uff09\u7684\u65b9\u5f0f\u4e0e\u7236\u8fdb\u7a0b\u5171\u4eab\uff0c\u53cd\u4e4b\u5982\u679c\u4e3a0\u5219\u8981\u8fdb\u884c\u6df1\u5ea6\u62f7\u8d1d\u4e86\u3002\u5176\u4e2dCLONE_PID\u6709\u7279\u6b8a\u7684\u7528\u9014\uff0c\u5b83\u8868\u793a\u7236\u5b50\u8fdb\u7a0b\u5171\u7528\u540c\u4e00\u8fdb\u7a0b\u53f7PID\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b50\u8fdb\u7a0b\u867d\u7136\u6709\u5176\u81ea\u5df1\u7684task_struct\u7ed3\u6784\uff0c\u5374\u4f7f\u7528\u7236\u8fdb\u7a0b\u7684PID\uff0c\u4f46\u662f\u53ea\u67090\u53f7\u8fdb\u7a0b\uff080\u53f7\u8fdb\u7a0b\u4e0d\u662finit\u8fdb\u7a0b\uff0cinit\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u53f7\u4e3a1\uff0c0\u53f7\u8fdb\u7a0b\u7a7a\u8f6c\u8fdb\u7a0b\u5373idle\u8fdb\u7a0b\uff09\u88ab\u5141\u8bb8\u5982\u6b64\u8c03\u7528clone\u3002 \u5bf9\u4e8efork\uff0c\u8fd9\u90e8\u5206\u5168\u4e3a0\uff0c\u8868\u793a\u6240\u6709\u7684\u8d44\u6e90\u90fd\u8981\u590d\u5236\uff08\u201c\u6df1\u62f7\u8d1d\u201d\uff09\uff1b\u800c\u5bf9vfork\uff0c\u5176\u8bbe\u7f6e\u4e86CLONE_VFORK\u548cCLONE_VM\u6807\u5fd7\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\uff08\u7ebf\u7a0b\uff09\u5171\u7528\u7236\u8fdb\u7a0b\uff08\u7528\u6237\u7a7a\u95f4\u7684\uff09\u865a\u5b58\u7a7a\u95f4\uff0c\u5e76\u4e14\u5f53\u5b50\u8fdb\u7a0b\u91ca\u653e\u5176\u865a\u5b58\u533a\u95f4\u65f6\uff0c\u8981\u901a\u77e5\u7236\u8fdb\u7a0b\uff1b\u81f3\u4e8eclone\uff0c\u8fd9\u4e00\u90e8\u5206\u4e5f\u7531\u8c03\u7528\u8005\u8bbe\u5b9a\u3002 \u4e0b\u9762\u5206\u6790\u4e0bdo_fork\u7684\u6d41\u7a0b\uff0c\u5982\u679c\u8bfb\u8005\u7406\u89e3\u6d45\u62f7\u8d1d\u548c\u6df1\u62f7\u8d1d\uff0c\u90a3\u4e48\u590d\u5236\u7684\u8fc7\u7a0b\u5f88\u597d\u7406\u89e3\u3002","title":"1 \u539f\u578b"},{"location":"kernel/PSfork-vfork-clone/#2-do_fork","text":"","title":"2 do_fork\u6d41\u7a0b"},{"location":"kernel/PSfork-vfork-clone/#21","text":"\u4e0b\u9762\u5bf9\u6d41\u7a0b\u4e2d\u7684\u91cd\u70b9\u51fd\u6570\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002","title":"2.1 \u603b\u4f53\u6d41\u7a0b\u56fe"},{"location":"kernel/PSfork-vfork-clone/#22-get_pid","text":"\u4e00\u822c\u6765\u8bb2\uff0c\u5c06\u4e0a\u4e00\u4e2a\u8fdb\u7a0b\u7684PID\u52a01\u5373\u53ef\u5f97\u5230\u65b0\u8fdb\u7a0b\u7684PID\uff0c\u4f46\u7cfb\u7edf\u4e2d\u89c4\u5b9aPID\u4e0d\u80fd\u2265PID_MAX\uff08PID_MAX \u5b9a\u4e49\u4e3a0x8000\uff0c\u53ef\u89c1\u6700\u5927\u7684PID\u53f7\u4e3a0x7fff\u537332767\uff09\u3002\u5982\u679cPID\u2265PID_MAX\uff0c\u5219\u8981\u56de\u8fc7\u5934\u53bb\u201c\u6361\u6f0f\u201d\uff1a\u67d0\u4e9b\u8fdb\u7a0b\u5df2\u7ecf\u53bb\u4e16\u4e86\uff0c\u4e4b\u524d\u5206\u914d\u7ed9\u4ed6\u4eec\u7684PID\u53ef\u4ee5\u91cd\u65b0\u5229\u7528\u4e86\u3002\u6ce8\u610f\u6361\u6f0f\u8981\u4ecePID\u4e3a300\u5f00\u59cb\u626b\u63cf\uff0c\u56e0\u4e3a300\u4ee5\u5185\uff080~299\uff09\u7684PID\u4fdd\u7559\u7ed9\u7cfb\u7edf\u8fdb\u7a0b\u4f7f\u7528\uff08\u5305\u62ec\u5185\u6838\u7ebf\u7a0b\u548c\u5404\u201c\u5b88\u62a4\u795e\u201d\u8fdb\u7a0b\uff09\u3002\u5982\u679c\u626b\u63cf\u53ea\u4e3a\u627e\u5230\u4e00\u4e2a\u53ef\u7528\u7684PID\uff0c\u663e\u7136\u4e0d\u5212\u7b97\uff0c\u6700\u597d\u662f\u80fd\u627e\u5230\u4e00\u4e2a\u53ef\u7528PID\u7684\u533a\u95f4\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u627e\u5230\u7b2c\u4e00\u4e2a\u53ef\u7528\u7684PID\uff09\u3002\u8fd9\u6837\u4e0b\u4e00\u6b21\u518d\u521b\u5efa\u8fdb\u7a0b\u65f6\uff0c\u76f4\u63a5\u4ece\u53ef\u7528PID\u533a\u95f4\u4e2d\u53d6\u4e0b\u4e00\u4e2aPID\u5373\u53ef\u3002","title":"2.2 get_pid"},{"location":"kernel/PSfork-vfork-clone/#23-copy_files","text":"task_struct\u7ed3\u6784\u6709\u4e00\u4e2afiles\u6210\u5458\uff0c\u5176\u4e3astruct files_struct\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u5411\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u7684\u4fe1\u606f\uff0ccopy_files\u51fd\u6570\u5b8c\u6210\u8be5\u6307\u9488\u7684\u6df1\u5ea6\u62f7\u8d1d\u3002files_struct\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a /* * Open file table structure */ struct files_struct { atomic_t count; rwlock_t file_lock; int max_fds; int max_fdset; int next_fd; struct file ** fd; /* current fd array */ fd_set *close_on_exec; fd_set *open_fds; fd_set close_on_exec_init; fd_set open_fds_init; struct file * fd_array[NR_OPEN_DEFAULT]; }; files_struct\u7ed3\u6784\u4e3b\u8981\u6709\u4e09\u4e2a\u90e8\u4ef6\uff1a\u5176\u4e00\u662f\u4e2a\u4f4d\u56fe\uff08\u6307\u9488\uff09close_on_exec\uff0c\u8868\u793a\u5728\u8fdb\u7a0b\u6267\u884cexce\u65f6\u9700\u8981close\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u4e2a\u6210\u5458close_on_exec_init\u7684\u5730\u5740\uff1b\u5176\u4e8c\u4e5f\u662f\u4e00\u4e2a\u4f4d\u56fe\uff08\u6307\u9488\uff09open_fds\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u6210\u5458open_fds_init\u7684\u5730\u5740\uff1b\u5176\u4e09\u4e3a\u6307\u5411\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u6307\u9488\u6570\u7ec4\u7684\u6307\u9488fd\uff0c\u6307\u5411\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u8868\u9879\u6570\u7ec4\uff0c\u521d\u59cb\u6307\u5411\u7ed3\u6784\u4f53\u4e2d\u53e6\u4e00\u6210\u5458fd_array\u7684\u5730\u5740\u3002\u7531\u4e8e\u4f4d\u56fe\uff08fd_set\uff09\u80fd\u591f\u8868\u793a\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a1024\uff08fd_set\u5171\u67091024\u4e2abit\uff09\uff0c\u800cfd_array\u6570\u7ec4\u7684\u5927\u5c0f\u56fa\u5b9a\u4e3aNR_OPEN_DEFAULT\uff0c\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u6570\u53ef\u80fd\u8d85\u8fc7NR_OPEN_DEFAULT\uff0c\u6216\u8005fd_set(1024\u4e2abit)\u5df2\u7ecf\u65e0\u6cd5\u5bb9\u7eb3\u6700\u5927\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u5bf9\u8fd9\u4e2a\u4e09\u4e2a\u90e8\u4ef6\u8fdb\u884c\u6269\u5c55\uff0c\u800c\u8fd9\u4e09\u4e2a\u6307\u9488\u5219\u6307\u5411\u7ed3\u6784\u4f53\u5916\u7684\u67d0\u4e2a\u5730\u5740\u3002 \u5982\u6709\u9700\u8981\uff08clone_flag\u4e2d\u5bf9\u5e94\u7684\u6807\u5fd7\u4f4d\u4e3a0\uff0c\u4e0b\u540c\uff09\uff0ccopy_files\u5c06\u6267\u884c\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\uff0c\u8fd9\u91cc\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u4e3b\u8981\u662f\u8fd9\u4e09\u4e2a\u90e8\u4ef6\u7684\u62f7\u8d1d\uff0c\u5728\u62f7\u8d1d\u65f6\u8981\u5224\u65ad\u7236\u8fdb\u7a0b\u7684\u4e09\u4e2a\u90e8\u4ef6\u662f\u5426\u5df2\u8fdb\u884c\u8fc7\u6269\u5c55\uff0c\u5982\u679c\u662f\u5219\u5b50\u8fdb\u7a0b\u7684\u4e09\u4e2a\u90e8\u4ef6\u4e5f\u8981\u8fdb\u884c\u6269\u5c55\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u6240\u8c13\u7684\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u53ea\u662f\u4e2d\u95f4\u5c42\u6b21\u7684\u201c\u6df1\u5ea6\u62f7\u8d1d\u201d\u3002\u4ee5fd\u4e3a\u4f8b\uff0cfd\u4e3a\u6307\u5411\u6307\u9488\u6570\u7ec4\u7684\u6307\u9488\uff0c\u62f7\u8d1d\u4e4b\u540e\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u4e00\u5757\u5b58\u50a8\u7a7a\u95f4\uff0c\u7528\u6765\u5b58\u653e\u6240\u6709\u7684\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u7684\u6307\u9488\uff0c\u4f46\u662f\u5e76\u672a\u6267\u884c\u66f4\u6df1\u5c42\u6b21\u7684\u62f7\u8d1d\uff0c\u5e76\u6ca1\u6709\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u8868\u9879\u6307\u9488\u6240\u6307\u5411\u7684\u6587\u4ef6\u8868\u9879\uff08struct file\uff09\u8fdb\u884c\u62f7\u8d1d\u3002\u7236\u5b50\u8fdb\u7a0b\u6bcf\u4e2a\u76f8\u540c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5171\u4eab\u540c\u4e00\u4e2a\u6587\u4ef6\u8868\u9879 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u53ef\u89c1\uff0cfork\u4e4b\u540e\uff0c\u5f53\u5b50\u8fdb\u7a0b\u901a\u8fc7lseek\u79fb\u52a8\u67d0\u4e2a\u6587\u4ef6\u7684\u201c\u5f53\u524d\u6587\u4ef6\u504f\u79fb\u91cf\u201d\u65f6\uff0c\u7531\u4e8e\u8fd9\u4e2a\u504f\u79fb\u91cf\u8bb0\u5f55\u5728\u6587\u4ef6\u8868\u9879file\u4e2d\uff0c\u7236\u8fdb\u7a0b\u4e2d\u5bf9\u5e94\u6587\u4ef6\u7684\u201c\u5f53\u524d\u6587\u4ef6\u504f\u79fb\u91cf\u201d\u4e5f\u4f1a\u88ab\u66f4\u65b0\uff0c\u8fd9\u5c31\u662f\u5728\u7236\u5b50\u8fdb\u7a0b\u4e2d\u540c\u65f6\u5f80\u6807\u51c6\u8f93\u51fa\u4e2d\u6253\u5370\u4fe1\u606f\u65f6\u4e0d\u4f1a\u91cd\u53e0\u7684\u539f\u56e0\u3002\u7f55\u89c1\u7684\uff0c\u300a\u60c5\u666f\u5206\u6790\u300b\u5173\u4e8e\u8fd9\u4e00\u70b9\u7684\u63cf\u8ff0\u6709\u8bef\u3002","title":"2.3 copy_files"},{"location":"kernel/PSfork-vfork-clone/#24-copy_sighand","text":"task_struct\u7ed3\u6784\u4e2d\u6709\u4e00sig\u6210\u5458\uff0c\u5176\u4e3astruct signal_struct\u7c7b\u578b\uff0c\u540e\u8005\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a struct signal_struct { atomic_t count; struct k_sigaction action[_NSIG]; spinlock_t siglock; }; \u5176\u6838\u5fc3\u6210\u5458action\u4e3a\u4e00\u6570\u7ec4\uff0c\u6307\u5b9a\u4e86\u5404\u4e2a\u4fe1\u53f7\u7684\u5904\u7406\u65b9\u5f0f\u3002_NSIG\u5373\u4e3a\u4fe1\u53f7\u7684\u6700\u5927\u503c64\u3002copy_sighand\u6240\u6267\u884c\u7684\u6df1\u5ea6\u62f7\u8d1d\u5c31\u662f\u5c06action\u6570\u7ec4\u62f7\u8d1d\u4e00\u4efd\u5230\u5b50\u8fdb\u7a0b\u3002","title":"2.4 copy_sighand"},{"location":"kernel/PSfork-vfork-clone/#25-copy_mm","text":"task_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2a\u6307\u9488mm\uff0c\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u5f88\u719f\u6089\u4e86\uff0c\u5176\u4e3amm_struct\u7ed3\u6784\u7c7b\u578b\uff0c\u4ee3\u8868\u4e86\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u3002mm_struct\u4e2d\u7528\u4e24\u4e2a\u91cd\u8981\u7684\u6210\u5458\uff0c\u5176\u4e00\u4e3avm_area_struct\u7c7b\u578b\u7684\u6307\u9488mmap\uff0c\u4ee3\u8868\u7740\u7528\u6237\u7a7a\u95f4\u7684\u6240\u6709\u201c\u865a\u5b58\u7a7a\u95f4\u201d\uff1b\u5176\u4e8c\u4e3apgd\uff0c\u9886\u8854\u7740\u201c\u865a\u5b58\u533a\u95f4\u201d\u7684\u9875\u9762\u6620\u5c04\u3002\u76f8\u5e94\u7684\uff0ccopy_mm\u6240\u6267\u884c\u7684\u6df1\u5ea6\u62f7\u8d1d\u4e5f\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u201c\u865a\u5b58\u533a\u95f4\u201d\u7684\u62f7\u8d1d\u548c\u9875\u9762\u8868\u7684\u62f7\u8d1d\u3002 \u6ce8\u610f\uff0c\u5728\u62f7\u8d1d\u9875\u8868\u65f6\uff0c\u53ea\u662f\u4e3a\u5b50\u8fdb\u7a0b\u7684\u9875\u8868\u5206\u914d\u4e86\u5b58\u50a8\u7a7a\u95f4\uff0c\u9875\u9762\u8868\u9879\uff08pte_t\uff09\u7684\u5185\u5bb9\u4e0e\u7236\u8fdb\u7a0b\u4e00\u81f4\u3002\u8fd9\u610f\u5473\u7740\u9488\u5bf9\u6bcf\u4e00\u4e2a\u9875\u9762\u8868\u9879\uff0c\u5b50\u8fdb\u7a0b\u5e76\u6ca1\u6709\u50cf\u6211\u4eec\u60f3\u8c61\u7684\u90a3\u6837\uff0c\u91cd\u65b0\u7533\u8bf7\u4e00\u4e2apage\uff0c\u4ece\u7236\u8fdb\u7a0b\u90a3\u91cc\u62f7\u8d1d\u4e00\u4e2apage\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5c06\u65b0page\u7684\u5730\u5740\u548c\u4fdd\u62a4\u5c5e\u6027\u5199\u5165\u9875\u9762\u8868\u9879\u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u505a\u6cd5\u662f\uff1a\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\u4ecd\u7136\u6307\u5411\u7236\u8fdb\u7a0b\u4e2d\u7684page\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2apage\u7684\u4fdd\u62a4\u5c5e\u6027\u8bbe\u7f6e\u6210\u201c\u53ea\u8bfb\u201d\uff0c\u5e76\u5c06\u4fdd\u62a4\u5c5e\u6027\u540c\u65f6\u8bbe\u7f6e\u8fdb\u7236\u3001\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\u4e2d\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5f53\u4e0d\u7ba1\u7236\u8fdb\u7a0b\u8fd8\u662f\u5b50\u8fdb\u7a0b\u4f01\u56fe\u5199\u5165\u8fd9\u4e2a\u9875\u9762\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1\u5f02\u5e38\u9875\u9762\u5f02\u5e38\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9875\u9762\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u4f1a\u91cd\u65b0\u5206\u914d\u4e00\u4e2apage\uff0c\u5e76\u628a\u5185\u5bb9\u590d\u5236\u8fc7\u6765\uff0c\u5e76\u66f4\u65b0\u7236\u5b50\u8fdb\u7a0b\u7684\u9875\u9762\u8868\u9879\uff08\u5c06\u4fdd\u62a4\u5c5e\u6027\u8bbe\u7f6e\u6210\u53ef\u5199\uff09\uff0c\u8ba9\u7236\u5b50\u8fdb\u7a0b\u62e5\u6709\u5404\u81ea\u7684\u7269\u7406page\u3002\u8fd9\u5c31\u662fcopy_on_write\u6280\u672f\u3002linux\u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u7684\u590d\u5236\u51fa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b8c\u5168\u5f52\u529f\u4e8ecopy on write\u6280\u672f\uff08\u5426\u5219\u7684\u8bdd\uff0c\u5728fork\u65f6\uff0c\u5c31\u5f97\u8001\u8001\u5b9e\u5b9e\u7684\u5206\u914d\u4e00\u4e2a\u4e00\u4e2a\u7684\u7269\u7406\u9875\u9762\uff0c\u5e76\u5c06\u9875\u9762\u7684\u5185\u5bb9\u62f7\u8d1d\u8fc7\u6765\uff09\u3002","title":"2.5 copy_mm"},{"location":"kernel/PSfork-vfork-clone/#26-copy_thread","text":"\u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\u8fdb\u7a0b\u7684\u7cfb\u7edf\u7a7a\u95f4\u4e3a\u4e24\u4e2a\u9875\u9762\u53738K\u7684\u7a7a\u95f4\uff0c\u5e95\u7aef\u4e3atask_struct\u7ed3\u6784\uff0ctask_struct\u7ed3\u6784\u4e4b\u4e0a\u4e3a\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u3002\u5176\u5b9e\uff0c\u5728\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e4b\u4e0a\u53738K\u7a7a\u95f4\u7684\u9876\u7aef\uff0c\u5b58\u653e\u7684\u662fpt_regs\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a pt_regs\u7ed3\u6784\u4fdd\u5b58\u7740\u8fdb\u5165\u5185\u6838\u524d\u5915CPU\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u8fd9\u53ef\u662f\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u7684\u91cd\u8981\u201c\u73b0\u573a\u201d\uff0c\u5bf9\u4e8e\u521a\u521a\u51fa\u751f\u7684\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u4e9b\u4fe1\u606f\u53ea\u80fd\u4ece\u7236\u8fdb\u7a0b\u62f7\u8d1d\u800c\u6765\uff0c\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u7236\u5b50\u8fdb\u7a0b\u624d\u53ef\u4ee5\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u7684\u540c\u4e00\u4e2a\u5730\u65b9\u3002 copy_thread\u7684\u4ee3\u7801\u6bd4\u8f83\u6709\u8da3\uff0c\u6211\u4eec\u6765\u770b\u770b\uff1a arch/kernel/process.c 529 int copy_thread(int nr, unsigned long clone_flags, unsigned long esp, 530 unsigned long unused, 531 struct task_struct * p, struct pt_regs * regs) 532 { 533 struct pt_regs * childregs; 534 535 childregs = ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) - 1; 536 struct_cpy(childregs, regs); 537 childregs- eax = 0; 538 childregs- esp = esp; 539 540 p- thread.esp = (unsigned long) childregs; 541 p- thread.esp0 = (unsigned long) (childregs+1); 542 543 p- thread.eip = (unsigned long) ret_from_fork; 544 545 savesegment(fs,p- thread.fs); 546 savesegment(gs,p- thread.gs); 547 548 unlazy_fpu(current); 549 struct_cpy( p- thread.i387, current- thread.i387); 550 551 return 0; 552 } \u53c2\u6570\u4e2d\u7684p\u6307\u5411\u65b0\u521b\u5efa\u7684\u5b50\u8fdb\u7a0b\uff1b\u800cregs\u5219\u6765\u81ea\u7236\u8fdb\u7a0b\uff1besp\u6307\u5411\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\u7684\u5806\u6808\u7684\u6808\u9876\uff0c\u5bf9fork\u4e0evfork\u800c\u8a00\uff0cesp\u6765\u81earegs.esp\u5373\u7236\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u5730\u5740\u7684\u6808\u9876\uff0c\u5bf9clone\u800c\u8a00\uff0c\u6808\u9876esp\u53ef\u6709\u8c03\u7528\u8005\u6307\u5b9a\u3002 \u9996\u5148\uff0c\u8981\u786e\u5b9a\u5728\u8fdb\u7a0b\u7684\u7cfb\u7edf\u7a7a\u95f4\u4e2dpt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\uff0c\u8fd9\u662f535\u884c\u7684\u4f5c\u7528\u3002\u9010\u6b65\u62c6\u89e3\u5982\u4e0b\uff1a (THREAD_SIZE + (unsigned long) p) \u5b9a\u4f4d\u5230\u5b50\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\uff088K\uff09\u7684\u4e0a\u8fb9\u754c\uff1b ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) \u5c06\u7cfb\u7edf\u7a7a\u95f4\u7684\u4e0a\u8fb9\u754c\u5f3a\u8f6c\u6210struct pt_regs\u7c7b\u578b\u7684\u6307\u9488\uff1b ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) \u2013 1\uff0c\u5728struct pt_regs\u7c7b\u578b\u7684\u6307\u9488\u7c7b\u578b\u7684\u6307\u9488\u4e0a\u6267\u884c\u51cf1\u64cd\u4f5c\uff0c\u6307\u9488\u540e\u79fbsizeof(struct pt_regs)\u4e2a\u5b58\u50a8\u5355\u5143\uff0c\u4e8e\u662f\u5b9a\u4f4d\u5230pt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\u3002 \u5176\u6b21\uff0c\u5b50\u8fdb\u7a0b\u7684pt_regs\u62f7\u8d1d\u81ea\u7236\u8fdb\u7a0b\uff08\u7b2c536\u884c\uff09\uff0c\u4f46\u4e5f\u8981\u8fdb\u884c\u4e9b\u201c\u4fee\u8865\u201d\u3002\u7b2c537\u884c\u4fee\u6539\u5b50\u8fdb\u7a0b\u5728\u7528\u6237\u7a7a\u95f4\u7684\u8fd4\u56de\u503c\u4e3a0\uff1b\u7b2c538\u884c\u4fee\u6539\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\u7684\u6808\u9876esp\u3002 \u53e6\u5916\uff0ctask_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2athread\u6210\u5458\uff0c\u5176\u4e3astruct thread_struct\u7c7b\u578b\uff0c\u91cc\u9762\u5b58\u653e\u7740\u8fdb\u7a0b\u5728\u5207\u6362\u65f6\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u6808\u9876esp\u3001\u4e0b\u4e00\u6761\u6307\u4ee4eip\uff08\u8fdb\u7a0b\u518d\u6b21\u88ab\u5207\u6362\u8fd0\u884c\u65f6\uff0c\u5c06\u4ece\u8fd9\u91cc\u5f00\u59cb\u8fd0\u884c\uff09\u7b49\u5173\u952e\u4fe1\u606f\u3002\u5728\u590d\u5236task_struct\u7ed3\u6784\u65f6\uff0c\u8fd9\u4e9b\u5185\u5bb9\u539f\u5c01\u4e0d\u52a8\u4ece\u7236\u8fdb\u7a0b\u62f7\u8d1d\u8fc7\u6765\uff0c\u73b0\u5728\u5b50\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u4e86\uff0c\u6240\u4ee5\u8981\u9002\u5f53\u7684\u52a0\u4ee5\u8c03\u6574\u3002\u7b2c540\u884c\u5c06p- thread.esp\u8bbe\u7f6e\u6210pt_regs\u7ed3\u6784\u7684\u8d77\u59cb\u5730\u5740\uff08\u6ce8\u610f\u5806\u6808\u662f\u5411\u4e0b\u6269\u5c55\u7684\uff09\uff0c\u4ece\u8c03\u5ea6\u5668\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5c31\u597d\u50cf\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u4ee5\u524d\u66fe\u7ecf\u8fdb\u5165\u5185\u6838\u8fd0\u884c\u8fc7\uff0c\u800c\u5728\u5185\u6838\u4e2d\u7684\u4efb\u52a1\u5904\u7406\u5b8c\u6bd5\uff08\u56e0\u6b64\u8fdb\u7a0b\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u6062\u590d\u5e73\u8861\uff0c\u53d8\u6210\u201c\u7a7a\u201d\u5806\u6808\uff09\u51c6\u5907\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\u65f6\u88ab\u5207\u6362\u4e86\uff1b\u800cp- thread.esp0\u5219\u5e94\u6307\u5411\u7cfb\u7edf\u7a7a\u95f4\u5806\u6808\u7684\u9876\u7aef\uff0c\u8868\u793a\u8fd9\u4e2a\u8fdb\u7a0b\u8fdb\u51650\u7ea7\uff08\u5185\u6838\u7a7a\u95f4\uff09\u8fd0\u884c\u65f6\uff0c\u5176\u5806\u6808\u7684\u4f4d\u7f6e\u3002\u7b2c543\u884c\uff0cp- thread.eip\u88ab\u8d4b\u503c\u4e3aret_from_fork\uff0c\u5f53\u5b50\u8fdb\u7a0b\u8c03\u5ea6\u8fd0\u884c\u65f6\uff08\u80af\u5b9a\u5148\u4ece\u7cfb\u7edf\u7a7a\u95f4\u8fd0\u884c\uff09\uff0c\u5c06\u4eceret_from_fork\u5904\u5f00\u59cb\u8fd0\u884c\u3002","title":"2.6 copy_thread"},{"location":"kernel/PSfork-vfork-clone/#27-vfork","text":"\u524d\u6587\u63d0\u5230\uff0cvfork\u4f1a\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u5728\u5b50\u8fdb\u7a0b\u6267\u884cexecve\u6216\u8005exit\u4e4b\u540e\uff0c\u7236\u8fdb\u7a0b\u624d\u53ef\u80fd\u88ab\u8c03\u5ea6\u8fd0\u884c\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u9700\u6c42\uff0ctask_struct\u7ed3\u6784\u4e2d\u6709\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff08struct semaphore\uff09\u7c7b\u578b\u7684\u6307\u9488vfork_sem\u3002\u5728do_fork\u51fd\u6570\u5f00\u59cb\u4f4d\u7f6e\uff0c\u521d\u59cb\u5316\u4e86\u4e00\u4e2a\u5c40\u90e8\u4fe1\u53f7\u91cfsem\uff0c\u5e76\u5c06sem\u7684\u5730\u5740\u8d4b\u7ed9\u7236\u8fdb\u7a0b\u7684task_struct.vfork_sem\uff08\u6d41\u7a0b\u56fe\u4e2d\u9ec4\u8272\u6807\u6ce8\u7684\u90e8\u5206\uff09\u3002\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u8ba1\u6570\u4e3a0\uff0c\u610f\u5473\u7740\u6b64\u65f6\u5bf9\u4fe1\u53f7\u91cf\u6267\u884cdown\u64cd\u4f5c\uff0c\u8fdb\u7a0b\u5c06\u88ab\u963b\u585e\u3002do_fork\u5728\u5b8c\u6210\u5b50\u8fdb\u7a0b\u7684\u201c\u590d\u5236\u201d\u4ee5\u540e\uff0c\u8c03\u7528wake_up_process\u5524\u9192\u5b50\u8fdb\u7a0b\uff0c\u800c\u81ea\u5df1\u5219\u8c03\u7528down( sem)\u8fdb\u5165\u7761\u7720\u3002 \u5728\u5b50\u8fdb\u7a0b\u8c03\u7528exec\u6216\u8005exit\u65f6\uff0c\u90fd\u4f1a\u8c03\u7528mm_release\uff0c\u5728\u8be5\u51fd\u6570\u4e2d\uff0cup(tsk- p_opptr- vfork_sem)\u589e\u52a0\u4e86\u7236\u8fdb\u7a0bvfork_sem\u7684\u8ba1\u6570\uff0c\u4e8e\u662f\u7236\u8fdb\u7a0b\u88ab\u5524\u9192\u3002 void mm_release(void) { struct task_struct *tsk = current; /* notify parent sleeping on vfork() */ if (tsk- flags PF_VFORK) { tsk- flags = ~PF_VFORK; up(tsk- p_opptr- vfork_sem); } } \u4ed4\u7ec6\u60f3\u6765\uff0cvfork\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\uff0c\u4e0d\u89c1\u5f97\u662f\u5185\u6838\u201c\u7cbe\u5fc3\u201d\u4e3alinux\u7528\u6237\u5b9e\u73b0\u7684\u7279\u6027\uff0c\u5012\u50cf\u662f\u5185\u6838\u7684\u65e0\u5948\u4e4b\u4e3e\u3002\u6211\u4eec\u77e5\u9053vfork\u7cfb\u7edf\u8c03\u7528\uff0c\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7528\u6237\u7a7a\u95f4\uff0c\u5b50\u8fdb\u7a0b\u5bf9\u7528\u6237\u7a7a\u95f4\u7684\u4fee\u6539\u4f1a\u53cd\u8fc7\u6765\u5f71\u54cd\u7236\u8fdb\u7a0b\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u5982\u679c\u8bf4\u7236\u5b50\u8fdb\u7a0b\u5404\u81ea\u4fee\u6539\u6570\u636e\u533a\u7684\u6570\u636e\u662f\u5371\u9669\u7684\u8bdd\uff0c\u90a3\u4e48\u4fee\u6539\u5806\u6808\u90a3\u5c31\u662f\u81f4\u547d\u7684\u4e86\u3002\u800c\u6070\u5de7\u5b50\u8fdb\u7a0b\u7d27\u63a5\u7740\u5c31\u4f1a\u8c03\u7528exec\uff08\u6216\u8005exit\uff09\uff0c\u800c\u51fd\u6570\u8c03\u7528\u6d89\u53ca\u5230\u4f20\u53c2\uff0c\u6d89\u53ca\u5230\u8bbe\u7f6e\u8fd4\u56de\u5730\u5740\u8fd9\u4e9b\u90fd\u4f1a\u4fee\u6539\u5806\u6808\u3002\u6240\u4ee5\u51b3\u4e0d\u80fd\u8ba9\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u56de\u5230\u7528\u6237\u7a7a\u95f4\u5e76\u53d1\u7684\u8fd0\u884c\uff0c\u5fc5\u987b\u6263\u7559\u5176\u4e2d\u7684\u4e00\u4e2a\uff0c\u800c\u53ea\u8ba9\u4e00\u4e2a\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u53bb\u8fd0\u884c\uff0c\u76f4\u5230\u4e24\u4e2a\u8fdb\u7a0b\u4e0d\u518d\u5171\u4eab\u7528\u6237\u7a7a\u95f4\uff08\u5b50\u8fdb\u7a0b\u6267\u884cexec\uff09\u6216\u8005\u5176\u4e2d\u4e4b\u4e00\u6d88\u4ea1\uff08\u5fc5\u7136\u662f\u5148\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\u7684\u5b50\u8fdb\u7a0b\uff09\u4e3a\u6b62\u3002 \u5373\u4f7f\u5982\u6b64\uff0c\u4e5f\u8fd8\u662f\u6709\u5371\u9669\uff0c\u5b50\u8fdb\u7a0b\u7edd\u5bf9\u4e0d\u80fd\u4ece\u8c03\u7528vfork\u7684\u90a3\u4e2a\u51fd\u6570\uff08caller\uff09\u4e2d\u8fd4\u56de\uff08\u6bd4\u5982vfork\u4e4b\u540e\u5b50\u8fdb\u7a0b\u8c03\u7528return\uff09\uff0c\u56e0\u4e3a\u51fd\u6570\u8fd4\u56de\u65f6\uff0c\u6808\u4f1a\u88ab\u6062\u590d\u5e73\u8861\uff0c\u4e4b\u524d\u7528\u6765\u5b58\u653ecaller\u7684\u51fd\u6570\u53c2\u6570\u548c\u51fd\u6570\u8fd4\u56de\u5730\u5740\u7684\u5185\u5b58\u5355\u5143\u88ab\u56de\u6536\uff0c\u4e4b\u540e\uff0c\u8fd9\u4e9b\u5185\u5b58\u5355\u5143\u53ef\u80fd\u88ab\u7528\u6765\u5b58\u653e\u5176\u4ed6\u7684\u5185\u5bb9\u3002\u7b49\u5230\u5b50\u8fdb\u7a0b\u53bb\u4e16\u7236\u8fdb\u7a0b\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u867d\u7136\u7236\u8fdb\u7a0b\u867d\u7136\u6709\u81ea\u5df1\u7684esp\uff08\u4fdd\u5b58\u5728pt_regs\u4e2d\uff09\uff0c\u4f46\u6808\u4e2d\u4fdd\u5b58\u7684caller\u7684\u8fd4\u56de\u5730\u5740\u88ab\u7834\u574f\u4e86\uff08esp\u4e4b\u4e0a\u7684\u5185\u5bb9\u90fd\u88ab\u7834\u574f\uff09\uff0c\u8fd9\u662f\u5f88\u5371\u9669\u7684\u3002\u6240\u4ee5vfork\u5b9e\u9645\u4e0a\u662f\u5efa\u7acb\u5728\u5b50\u8fdb\u7a0b\u5728\u521b\u5efa\u540e\u7acb\u5373\u5c31\u4f1a\u8c03\u7528execve\u7684\u524d\u63d0\u4e4b\u4e0a\u7684\u3002","title":"2.7 vfork\u662f\u5982\u4f55\u4fdd\u8bc1\u5b50\u8fdb\u7a0b\u5148\u8fd0\u884c\u7684"}]}